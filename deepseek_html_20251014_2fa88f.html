<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zahradníkovy Výzvy | Farmářská Hra</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: manipulation;
        }

        body {
            background: linear-gradient(135deg, #87CEEB, #98FB98);
            color: #2d5016;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
        }

        .container {
            max-width: 100%;
            width: 100%;
            text-align: center;
        }

        header {
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            color: #2d5016;
            text-shadow: 2px 2px 0 #a3d977;
        }

        .subtitle {
            font-size: 1rem;
            color: #4a7c1f;
            margin-bottom: 10px;
        }

        .season-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .season-icon {
            font-size: 1.5rem;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            margin-bottom: 15px;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
            background: #e8f5e9;
            padding: 10px;
            border-radius: 10px;
            border: 3px solid #a5d6a7;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 8px 12px;
            border-radius: 10px;
            min-width: 80px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .stat-label {
            font-size: 0.8rem;
            color: #4a7c1f;
            margin-bottom: 3px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2d5016;
        }

        .farm-container {
            background: #c8e6c9;
            border-radius: 10px;
            padding: 15px;
            border: 5px solid #8bc34a;
            margin: 0 auto 15px;
            max-width: 100%;
        }

        .farm {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin: 0 auto;
            max-width: 100%;
        }

        .plot {
            width: 65px;
            height: 65px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            transition: all 0.3s ease;
            background: #d7ccc8;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
            padding: 5px;
        }

        .plot:hover {
            transform: scale(1.05);
        }

        .plot.empty {
            background: #d7ccc8;
        }

        .plot.planted {
            background: #8bc34a;
        }

        .plot.ready {
            background: #ffd54f;
            animation: pulse 1s infinite;
        }

        .plot.withered {
            background: #795548;
        }

        .plot.new {
            background: #ffecb3;
            border: 2px dashed #ff9800;
        }

        .crops {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .crop-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 10px;
            border-radius: 10px;
            min-width: 90px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
            border: 2px solid #ffd54f;
            cursor: pointer;
            transition: all 0.2s;
        }

        .crop-item.selected {
            border-color: #e53935;
            background: #fff3e0;
            transform: scale(1.05);
        }

        .crop-item.locked {
            border-color: #9e9e9e;
            background: #f5f5f5;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .crop-item:hover:not(.locked) {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        }

        .crop-icon {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .crop-name {
            font-size: 0.85rem;
            font-weight: bold;
            color: #2d5016;
        }

        .crop-cost {
            font-size: 0.75rem;
            color: #e53935;
        }

        .crop-time {
            font-size: 0.75rem;
            color: #1976d2;
        }

        .crop-locked {
            font-size: 0.75rem;
            color: #757575;
            font-style: italic;
        }

        .animals {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .animal-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 10px;
            border-radius: 10px;
            min-width: 90px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
            border: 2px solid #81c784;
            cursor: pointer;
            transition: all 0.2s;
        }

        .animal-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        }

        .animal-icon {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .animal-name {
            font-size: 0.85rem;
            font-weight: bold;
            color: #2d5016;
        }

        .animal-cost {
            font-size: 0.75rem;
            color: #e53935;
        }

        .animal-income {
            font-size: 0.75rem;
            color: #43a047;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(135deg, #4caf50, #2e7d32);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
        }

        .market {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .upgrades {
            background: linear-gradient(135deg, #2196f3, #0d47a1);
        }

        .save {
            background: linear-gradient(135deg, #9c27b0, #673ab7);
        }

        .selected-crop {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            border: 2px dashed #4caf50;
            font-size: 0.9rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: modalAppear 0.4s ease;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #757575;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            background: #f5f5f5;
            color: #e53935;
        }

        .modal h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: #2d5016;
            padding-right: 30px;
        }

        .modal p {
            margin-bottom: 20px;
            font-size: 1.1rem;
            line-height: 1.5;
            color: #4a7c1f;
        }

        .instructions {
            background: #e8f5e9;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            text-align: left;
            font-size: 0.9rem;
            border: 2px dashed #81c784;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .instructions h3 {
            color: #2d5016;
            margin-bottom: 8px;
            text-align: center;
        }

        .instructions ul {
            list-style-type: none;
            padding-left: 0;
        }

        .instructions li {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .instructions li::before {
            content: "🌱";
            margin-right: 8px;
        }

        footer {
            margin-top: 20px;
            text-align: center;
            color: #2d5016;
            font-size: 0.8rem;
            width: 100%;
            max-width: 600px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: #4caf50;
            border-radius: 5px;
            transition: width 0.3s;
        }

        .xp-bar {
            width: 100%;
            height: 15px;
            background: #e0e0e0;
            border-radius: 10px;
            margin: 5px 0;
            overflow: hidden;
            position: relative;
        }

        .xp-progress {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .xp-text {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            color: #2d5016;
        }

        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            transform: translateY(100px);
            transition: transform 0.3s ease;
            z-index: 1000;
            display: none;
        }

        .save-indicator.show {
            transform: translateY(0);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes modalAppear {
            from { opacity: 0; transform: translateY(-30px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .season-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 8px;
        }

        .season-spring { background: #c8e6c9; color: #2e7d32; }
        .season-summer { background: #fff9c4; color: #f57f17; }
        .season-autumn { background: #ffcc80; color: #ef6c00; }
        .season-winter { background: #e3f2fd; color: #1565c0; }

        .farm-expansion {
            background: #fff8e1;
            padding: 8px;
            border-radius: 8px;
            margin: 5px 0;
            border: 2px solid #ffd54f;
            font-size: 0.9rem;
        }

        @media (max-width: 480px) {
            .farm {
                grid-template-columns: repeat(5, 1fr);
            }
            
            .plot {
                width: 55px;
                height: 55px;
                font-size: 1.4rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .crops, .animals {
                gap: 8px;
            }
            
            .crop-item, .animal-item {
                min-width: 80px;
                padding: 8px;
            }
            
            .controls {
                gap: 8px;
            }
            
            button {
                padding: 10px 15px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Zahradníkovy Výzvy <i class="fas fa-seedling"></i></h1>
            <p class="subtitle">Staň se mistrem zahradníkem! Pěstuj, sklízej a rozšiřuj svou zahradu.</p>
            <div class="season-info">
                <span>Roční období:</span>
                <span class="season-indicator" id="season">Načítání...</span>
                <span class="season-icon" id="season-icon">🌱</span>
            </div>
        </header>

        <div class="game-container">
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-label">PENÍZE</div>
                    <div class="stat-value" id="money">100</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">LEVEL</div>
                    <div class="stat-value" id="level">1</div>
                    <div class="xp-bar">
                        <div class="xp-progress" id="xp-progress" style="width: 0%"></div>
                        <div class="xp-text" id="xp-text">0/100 XP</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">DEN</div>
                    <div class="stat-value" id="day">1</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">POLE</div>
                    <div class="stat-value" id="farm-size">8</div>
                </div>
            </div>

            <div class="selected-crop">
                <strong>Vybrána plodina:</strong> 
                <span id="selected-crop-name">Žádná</span>
                <span id="selected-crop-icon"></span>
            </div>

            <div class="farm-expansion" id="farm-expansion-info">
                Na levelu 3 se zahrada rozšíří na 10 políček!
            </div>

            <h3><i class="fas fa-seedling"></i> Tvá Zahradní Pole</h3>
            <div class="farm-container">
                <div class="farm" id="farm"></div>
            </div>

            <h3><i class="fas fa-shopping-basket"></i> Semínka a Sazenice</h3>
            <div class="crops" id="crops"></div>

            <h3><i class="fas fa-paw"></i> Zvířecí pomocníci</h3>
            <div class="animals" id="animals"></div>

            <div class="controls">
                <button id="next-day">
                    <i class="fas fa-sun"></i> Další Den
                </button>
                <button id="market" class="market">
                    <i class="fas fa-store"></i> Tržiště
                </button>
                <button id="upgrades" class="upgrades">
                    <i class="fas fa-tools"></i> Nástroje
                </button>
                <button id="save-game" class="save">
                    <i class="fas fa-save"></i> Uložit
                </button>
            </div>
        </div>

        <div class="instructions">
            <h3>Jak hrát:</h3>
            <ul>
                <li>Nejprve vyber plodinu kliknutím na ni v obchodě</li>
                <li>Pak klikni na prázdné pole k vysazení vybrané plodiny</li>
                <li>Počkej, až plodina vyroste (ukazuje progress bar)</li>
                <li>Skliď zralé plodiny (žlutá pole) a prodej je na tržišti</li>
                <li>Pořizuj si zvířecí pomocníky pro pravidelný příjem</li>
                <li>Používej tlačítko "Další Den" k postupu v čase</li>
                <li><strong>Roční období ovlivňují růst plodin podle reálného času!</strong></li>
                <li><strong>Na levelu 3 se zahrada rozšíří na 10 políček!</strong></li>
            </ul>
        </div>
    </div>

    <div class="save-indicator" id="save-indicator">
        <i class="fas fa-check"></i> Hra uložena!
    </div>

    <div class="modal" id="market-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-store"></i> Zahradní Tržiště</h2>
            <p>Prodej své úrody a vydělej peníze!</p>
            <div id="market-items"></div>
            <button class="close-modal-btn">Zavřít</button>
        </div>
    </div>

    <div class="modal" id="upgrades-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-tools"></i> Zahradní Nástroje</h2>
            <p>Vylepši svou zahradu pro vyšší výnosy!</p>
            <div id="upgrade-items"></div>
            <button class="close-modal-btn">Zavřít</button>
        </div>
    </div>

    <div class="modal" id="level-up-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-trophy"></i> Level Up!</h2>
            <p>Gratulujeme! Postoupil jsi na level <span id="new-level">2</span>!</p>
            <p id="level-up-benefits"></p>
            <button class="close-modal-btn">Super!</button>
        </div>
    </div>

    <div class="modal" id="farm-expanded-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-expand-arrows-alt"></i> Zahrada Rozšířena!</h2>
            <p>🎉 Tvá zahrada se rozrostla na <strong>10 políček</strong>!</p>
            <p>Nyní můžeš pěstovat více plodin najednou.</p>
            <button class="close-modal-btn">Skvělé!</button>
        </div>
    </div>

    <div class="modal" id="load-game-modal">
        <div class="modal-content">
            <h2><i class="fas fa-folder-open"></i> Načíst Hru</h2>
            <p>Našli jsme uloženou hru. Chceš ji načíst?</p>
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                <button id="load-game-yes" style="background: #4caf50;">Ano, načíst</button>
                <button id="load-game-no" style="background: #f44336;">Ne, začít novou</button>
            </div>
        </div>
    </div>

    <footer>
        <p>Zahradníkovy Výzvy - Zahradnická strategie &copy; 2023</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Herní konstanty
            const INITIAL_FARM_SIZE = 8;
            const EXPANDED_FARM_SIZE = 10;
            const EXPANSION_LEVEL = 3;
            const SAVE_KEY = 'garden_challenge_save';

            // Reálná roční období podle měsíců
            const REAL_SEASONS = {
                0: { name: 'Zima', icon: '❄️', multiplier: 0.5, class: 'season-winter' },     // Leden
                1: { name: 'Zima', icon: '❄️', multiplier: 0.6, class: 'season-winter' },     // Únor
                2: { name: 'Jaro', icon: '🌱', multiplier: 1.2, class: 'season-spring' },     // Březen
                3: { name: 'Jaro', icon: '🌸', multiplier: 1.4, class: 'season-spring' },     // Duben
                4: { name: 'Jaro', icon: '🌼', multiplier: 1.5, class: 'season-spring' },     // Květen
                5: { name: 'Léto', icon: '☀️', multiplier: 1.8, class: 'season-summer' },     // Červen
                6: { name: 'Léto', icon: '🌞', multiplier: 2.0, class: 'season-summer' },     // Červenec
                7: { name: 'Léto', icon: '🔥', multiplier: 1.9, class: 'season-summer' },     // Srpen
                8: { name: 'Podzim', icon: '🍂', multiplier: 1.3, class: 'season-autumn' },   // Září
                9: { name: 'Podzim', icon: '🍁', multiplier: 1.1, class: 'season-autumn' },   // Říjen
                10: { name: 'Podzim', icon: '🌧️', multiplier: 0.9, class: 'season-autumn' },  // Listopad
                11: { name: 'Zima', icon: '⛄', multiplier: 0.7, class: 'season-winter' }     // Prosinec
            };

            // Stav hry
            let gameState = {
                money: 100,
                xp: 0,
                level: 1,
                day: 1,
                farm: [],
                inventory: {},
                animals: [],
                upgrades: [],
                selectedCrop: null,
                farmSize: INITIAL_FARM_SIZE,
                farmExpanded: false,
                currentSeason: getCurrentRealSeason()
            };

            // Dostupné plodiny
            const crops = [
                { id: 1, name: 'Mrkev', icon: '🥕', cost: 10, growTime: 3, sellPrice: 20, xp: 5, unlocked: true, unlockLevel: 1 },
                { id: 2, name: 'Brambory', icon: '🥔', cost: 15, growTime: 4, sellPrice: 30, xp: 8, unlocked: false, unlockLevel: 2 },
                { id: 3, name: 'Kukuřice', icon: '🌽', cost: 20, growTime: 5, sellPrice: 40, xp: 12, unlocked: false, unlockLevel: 3 },
                { id: 4, name: 'Jahody', icon: '🍓', cost: 25, growTime: 4, sellPrice: 50, xp: 15, unlocked: false, unlockLevel: 4 },
                { id: 5, name: 'Dýně', icon: '🎃', cost: 40, growTime: 6, sellPrice: 80, xp: 20, unlocked: false, unlockLevel: 5 }
            ];

            // Dostupná zvířata
            const animals = [
                { id: 1, name: 'Slepice', icon: '🐔', cost: 50, income: 5, xp: 10, unlocked: true, unlockLevel: 1 },
                { id: 2, name: 'Králík', icon: '🐇', cost: 80, income: 8, xp: 15, unlocked: false, unlockLevel: 2 },
                { id: 3, name: 'Ovce', icon: '🐑', cost: 120, income: 12, xp: 20, unlocked: false, unlockLevel: 3 },
                { id: 4, name: 'Koza', icon: '🐐', cost: 180, income: 15, xp: 25, unlocked: false, unlockLevel: 4 }
            ];

            // Funkce pro získání aktuálního reálného ročního období
            function getCurrentRealSeason() {
                const now = new Date();
                const month = now.getMonth();
                return REAL_SEASONS[month];
            }

            // DOM elementy
            const farmElement = document.getElementById('farm');
            const cropsElement = document.getElementById('crops');
            const animalsElement = document.getElementById('animals');
            const moneyElement = document.getElementById('money');
            const levelElement = document.getElementById('level');
            const dayElement = document.getElementById('day');
            const farmSizeElement = document.getElementById('farm-size');
            const xpProgressElement = document.getElementById('xp-progress');
            const xpTextElement = document.getElementById('xp-text');
            const selectedCropNameElement = document.getElementById('selected-crop-name');
            const selectedCropIconElement = document.getElementById('selected-crop-icon');
            const farmExpansionInfoElement = document.getElementById('farm-expansion-info');
            const saveIndicator = document.getElementById('save-indicator');
            const seasonElement = document.getElementById('season');
            const seasonIconElement = document.getElementById('season-icon');

            // Aktualizace zobrazení ročního období
            function updateSeasonDisplay() {
                const season = gameState.currentSeason;
                seasonElement.textContent = season.name;
                seasonElement.className = `season-indicator ${season.class}`;
                seasonIconElement.textContent = season.icon;
                
                // Přidat informaci o multiplikátoru
                const multiplierInfo = document.getElementById('season-multiplier') || document.createElement('small');
                multiplierInfo.id = 'season-multiplier';
                multiplierInfo.textContent = ` (${season.multiplier}x růst)`;
                multiplierInfo.style.fontSize = '0.8rem';
                multiplierInfo.style.color = '#666';
                
                if (!seasonElement.nextSibling || seasonElement.nextSibling.id !== 'season-multiplier') {
                    seasonElement.parentNode.insertBefore(multiplierInfo, seasonElement.nextSibling);
                }
            }

            // Inicializace hry
            function initGame() {
                const savedGame = loadGame();
                
                if (savedGame) {
                    document.getElementById('load-game-modal').style.display = 'flex';
                    
                    document.getElementById('load-game-yes').onclick = function() {
                        document.getElementById('load-game-modal').style.display = 'none';
                        loadSavedGame(savedGame);
                    };
                    
                    document.getElementById('load-game-no').onclick = function() {
                        document.getElementById('load-game-modal').style.display = 'none';
                        resetGameState();
                        createFarm();
                        renderFarm();
                        renderCrops();
                        renderAnimals();
                        updateDisplay();
                    };
                } else {
                    resetGameState();
                    createFarm();
                    renderFarm();
                    renderCrops();
                    renderAnimals();
                    updateDisplay();
                }

                setupEventListeners();
                updateSeasonDisplay();
            }

            // Zbytek kódu zůstává stejný, jen se změní reference na roční období
            function nextDay() {
                gameState.day++;
                
                // Každých 7 herních dní aktualizujeme reálné roční období
                if (gameState.day % 7 === 0) {
                    gameState.currentSeason = getCurrentRealSeason();
                    updateSeasonDisplay();
                }
                
                gameState.farm.forEach(plot => {
                    if (plot.state === 'planted') {
                        const crop = crops.find(c => c.id === plot.crop);
                        // Použijeme reálný multiplikátor ročního období
                        const growthMultiplier = gameState.currentSeason.multiplier;
                        plot.growth += growthMultiplier;
                        
                        if (plot.growth >= crop.growTime) {
                            plot.state = 'ready';
                        }
                    }
                });
                
                let animalIncome = 0;
                gameState.animals.forEach(animal => {
                    animalIncome += animal.income;
                });
                
                if (animalIncome > 0) {
                    gameState.money += animalIncome;
                }
                
                updateDisplay();
                renderFarm();
                saveGame();
            }

            // Nastavení event listenerů
            function setupEventListeners() {
                document.getElementById('next-day').addEventListener('click', nextDay);
                document.getElementById('market').addEventListener('click', openMarket);
                document.getElementById('upgrades').addEventListener('click', openUpgrades);
                document.getElementById('save-game').addEventListener('click', function() {
                    saveGame();
                    showSaveIndicator();
                });

                // Zavírání modalů
                document.querySelectorAll('.close-modal, .close-modal-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        document.querySelectorAll('.modal').forEach(modal => {
                            modal.style.display = 'none';
                        });
                    });
                });

                // Zavírání kliknutím mimo obsah
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', function(e) {
                        if (e.target === modal) {
                            modal.style.display = 'none';
                        }
                    });
                });
            }

            // Funkce pro ukládání hry
            function saveGame() {
                const saveData = {
                    money: gameState.money,
                    xp: gameState.xp,
                    level: gameState.level,
                    day: gameState.day,
                    farm: gameState.farm,
                    inventory: gameState.inventory,
                    animals: gameState.animals,
                    upgrades: gameState.upgrades,
                    selectedCrop: gameState.selectedCrop,
                    farmSize: gameState.farmSize,
                    farmExpanded: gameState.farmExpanded,
                    saveVersion: '2.0'
                };
                
                try {
                    localStorage.setItem(SAVE_KEY, JSON.stringify(saveData));
                } catch (e) {
                    console.error('Chyba při ukládání:', e);
                }
            }

            // Funkce pro načtení hry
            function loadGame() {
                try {
                    const savedData = localStorage.getItem(SAVE_KEY);
                    if (savedData) {
                        return JSON.parse(savedData);
                    }
                } catch (e) {
                    console.error('Chyba při načítání:', e);
                }
                return null;
            }

            // Zobrazení indikátoru uložení
            function showSaveIndicator() {
                saveIndicator.style.display = 'block';
                saveIndicator.classList.add('show');
                setTimeout(() => {
                    saveIndicator.classList.remove('show');
                    setTimeout(() => {
                        saveIndicator.style.display = 'none';
                    }, 300);
                }, 1500);
            }

            // Načtení uložené hry
            function loadSavedGame(savedData) {
                gameState.money = savedData.money;
                gameState.xp = savedData.xp;
                gameState.level = savedData.level;
                gameState.day = savedData.day;
                gameState.farm = savedData.farm;
                gameState.inventory = savedData.inventory;
                gameState.animals = savedData.animals;
                gameState.upgrades = savedData.upgrades;
                gameState.selectedCrop = savedData.selectedCrop;
                gameState.farmSize = savedData.farmSize;
                gameState.farmExpanded = savedData.farmExpanded;

                updateUnlockedContent();
                updateSelectedCropDisplay();
                renderFarm();
                renderCrops();
                renderAnimals();
                updateDisplay();
            }

            // Aktualizace odemčeného obsahu
            function updateUnlockedContent() {
                crops.forEach(crop => {
                    crop.unlocked = gameState.level >= crop.unlockLevel;
                });
                
                animals.forEach(animal => {
                    animal.unlocked = gameState.level >= animal.unlockLevel;
                });
            }

            // Resetování stavu hry
            function resetGameState() {
                gameState.money = 100;
                gameState.xp = 0;
                gameState.level = 1;
                gameState.day = 1;
                gameState.farm = [];
                gameState.inventory = {};
                gameState.animals = [];
                gameState.upgrades = [];
                gameState.selectedCrop = null;
                gameState.farmSize = INITIAL_FARM_SIZE;
                gameState.farmExpanded = false;
                gameState.currentSeason = getCurrentRealSeason();

                crops.forEach(crop => {
                    gameState.inventory[crop.id] = 0;
                });
                
                updateUnlockedContent();
                updateSelectedCropDisplay();
                updateFarmExpansionInfo();
            }

            // Vytvoření farmy
            function createFarm() {
                gameState.farm = [];
                for (let i = 0; i < gameState.farmSize; i++) {
                    gameState.farm.push({
                        id: i,
                        crop: null,
                        growth: 0,
                        state: 'empty',
                        isNew: i >= INITIAL_FARM_SIZE
                    });
                }
            }

            // Vykreslení farmy
            function renderFarm() {
                farmElement.innerHTML = '';
                
                gameState.farm.forEach(plot => {
                    const plotElement = document.createElement('div');
                    let plotClasses = `plot ${plot.state}`;
                    if (plot.isNew) {
                        plotClasses += ' new';
                    }
                    plotElement.className = plotClasses;
                    plotElement.dataset.id = plot.id;
                    
                    if (plot.state === 'empty') {
                        if (plot.isNew) {
                            plotElement.innerHTML = '<i class="fas fa-plus"></i><small>NOVÉ!</small>';
                        } else {
                            plotElement.innerHTML = '<i class="fas fa-plus"></i>';
                        }
                    } else if (plot.state === 'planted') {
                        const crop = crops.find(c => c.id === plot.crop);
                        const progressPercent = (plot.growth / crop.growTime) * 100;
                        plotElement.innerHTML = `
                            ${crop.icon}
                            <div class="progress-bar">
                                <div class="progress" style="width: ${progressPercent}%"></div>
                            </div>
                            <small>${Math.round(progressPercent)}%</small>
                        `;
                    } else if (plot.state === 'ready') {
                        const crop = crops.find(c => c.id === plot.crop);
                        plotElement.innerHTML = `
                            ${crop.icon}
                            <small>SKLIDIT!</small>
                        `;
                    } else if (plot.state === 'withered') {
                        plotElement.innerHTML = '💀<small>UVADLO</small>';
                    }
                    
                    plotElement.addEventListener('click', function() {
                        handlePlotClick(plot.id);
                    });
                    farmElement.appendChild(plotElement);
                });
                
                saveGame();
            }

            // Vykreslení plodin
            function renderCrops() {
                cropsElement.innerHTML = '';
                
                crops.forEach(crop => {
                    const cropElement = document.createElement('div');
                    
                    if (crop.unlocked) {
                        cropElement.className = 'crop-item';
                        if (gameState.selectedCrop && gameState.selectedCrop.id === crop.id) {
                            cropElement.classList.add('selected');
                        }
                        
                        cropElement.innerHTML = `
                            <div class="crop-icon">${crop.icon}</div>
                            <div class="crop-name">${crop.name}</div>
                            <div class="crop-cost">$${crop.cost}</div>
                            <div class="crop-time">${crop.growTime} dní</div>
                        `;
                        
                        cropElement.addEventListener('click', function() {
                            selectCrop(crop.id);
                        });
                    } else {
                        cropElement.className = 'crop-item locked';
                        cropElement.innerHTML = `
                            <div class="crop-icon">${crop.icon}</div>
                            <div class="crop-name">${crop.name}</div>
                            <div class="crop-locked">Level ${crop.unlockLevel}</div>
                        `;
                    }
                    
                    cropsElement.appendChild(cropElement);
                });
            }

            // Výběr plodiny
            function selectCrop(cropId) {
                const crop = crops.find(c => c.id === cropId);
                if (crop.unlocked) {
                    gameState.selectedCrop = crop;
                    updateSelectedCropDisplay();
                    renderCrops();
                    saveGame();
                }
            }

            // Aktualizace zobrazení vybrané plodiny
            function updateSelectedCropDisplay() {
                if (gameState.selectedCrop) {
                    selectedCropNameElement.textContent = gameState.selectedCrop.name;
                    selectedCropIconElement.textContent = gameState.selectedCrop.icon;
                } else {
                    selectedCropNameElement.textContent = "Žádná";
                    selectedCropIconElement.textContent = "";
                }
            }

            // Aktualizace informace o rozšíření farmy
            function updateFarmExpansionInfo() {
                if (gameState.level < EXPANSION_LEVEL) {
                    farmExpansionInfoElement.innerHTML = `Na levelu ${EXPANSION_LEVEL} se zahrada rozšíří na 10 políček!`;
                } else if (gameState.farmExpanded) {
                    farmExpansionInfoElement.innerHTML = `Zahrada rozšířena na ${EXPANDED_FARM_SIZE} políček!`;
                }
            }

            // Vykreslení zvířat
            function renderAnimals() {
                animalsElement.innerHTML = '';
                
                animals.forEach(animal => {
                    if (animal.unlocked) {
                        const animalElement = document.createElement('div');
                        animalElement.className = 'animal-item';
                        animalElement.innerHTML = `
                            <div class="animal-icon">${animal.icon}</div>
                            <div class="animal-name">${animal.name}</div>
                            <div class="animal-cost">$${animal.cost}</div>
                            <div class="animal-income">+$${animal.income}/den</div>
                        `;
                        
                        animalElement.addEventListener('click', function() {
                            buyAnimal(animal.id);
                        });
                        animalsElement.appendChild(animalElement);
                    }
                });
            }

            // Aktualizace zobrazení
            function updateDisplay() {
                moneyElement.textContent = gameState.money;
                levelElement.textContent = gameState.level;
                dayElement.textContent = gameState.day;
                farmSizeElement.textContent = gameState.farmSize;
                
                const xpNeeded = gameState.level * 100;
                const xpPercent = (gameState.xp / xpNeeded) * 100;
                xpProgressElement.style.width = `${xpPercent}%`;
                xpTextElement.textContent = `${gameState.xp}/${xpNeeded} XP`;
                
                updateFarmExpansionInfo();
            }

            // Zpracování kliknutí na pole
            function handlePlotClick(plotId) {
                const plot = gameState.farm[plotId];
                
                if (plot.state === 'empty') {
                    if (gameState.selectedCrop) {
                        plantCrop(plotId, gameState.selectedCrop.id);
                    }
                } else if (plot.state === 'ready') {
                    harvestCrop(plotId);
                } else if (plot.state === 'withered') {
                    plot.state = 'empty';
                    plot.crop = null;
                    plot.growth = 0;
                    renderFarm();
                }
            }

            // Výsadba plodiny
            function plantCrop(plotId, cropId) {
                const plot = gameState.farm[plotId];
                const crop = crops.find(c => c.id === cropId);
                
                if (gameState.money >= crop.cost) {
                    gameState.money -= crop.cost;
                    plot.crop = cropId;
                    plot.growth = 0;
                    plot.state = 'planted';
                    
                    updateDisplay();
                    renderFarm();
                }
            }

            // Sklizeň plodiny
            function harvestCrop(plotId) {
                const plot = gameState.farm[plotId];
                const crop = crops.find(c => c.id === plot.crop);
                
                gameState.inventory[crop.id] = (gameState.inventory[crop.id] || 0) + 1;
                gameState.xp += crop.xp;
                
                plot.state = 'empty';
                plot.crop = null;
                plot.growth = 0;
                
                checkLevelUp();
                updateDisplay();
                renderFarm();
            }

            // Koupit zvíře
            function buyAnimal(animalId) {
                const animal = animals.find(a => a.id === animalId);
                
                if (gameState.money >= animal.cost) {
                    gameState.money -= animal.cost;
                    gameState.animals.push({...animal});
                    gameState.xp += animal.xp;
                    
                    updateDisplay();
                    checkLevelUp();
                    renderAnimals();
                    saveGame();
                }
            }

            // Kontrola level up
            function checkLevelUp() {
                const xpNeeded = gameState.level * 100;
                
                if (gameState.xp >= xpNeeded) {
                    gameState.level++;
                    gameState.xp = 0;
                    
                    const benefits = unlockNewContent();
                    
                    document.getElementById('new-level').textContent = gameState.level;
                    document.getElementById('level-up-benefits').textContent = benefits;
                    document.getElementById('level-up-modal').style.display = 'flex';
                    
                    updateDisplay();
                    saveGame();
                }
            }

            // Odemknout nový obsah
            function unlockNewContent() {
                let benefits = [];
                
                if (gameState.level === EXPANSION_LEVEL && !gameState.farmExpanded) {
                    expandFarm();
                    benefits.push("Zahrada rozšířena na 10 políček!");
                }
                
                crops.forEach(crop => {
                    if (crop.unlockLevel === gameState.level) {
                        crop.unlocked = true;
                        benefits.push(`Odemčena ${crop.icon} ${crop.name}`);
                    }
                });
                
                animals.forEach(animal => {
                    if (animal.unlockLevel === gameState.level) {
                        animal.unlocked = true;
                        benefits.push(`Odemčeno ${animal.icon} ${animal.name}`);
                    }
                });
                
                renderCrops();
                renderAnimals();
                
                return benefits.join(", ");
            }

            // Rozšíření farmy
            function expandFarm() {
                gameState.farmSize = EXPANDED_FARM_SIZE;
                gameState.farmExpanded = true;
                createFarm();
                renderFarm();
                
                setTimeout(() => {
                    document.getElementById('farm-expanded-modal').style.display = 'flex';
                }, 500);
            }

            // Otevření trhu
            function openMarket() {
                const marketItems = document.getElementById('market-items');
                marketItems.innerHTML = '';
                
                let hasItems = false;
                
                Object.keys(gameState.inventory).forEach(cropId => {
                    const quantity = gameState.inventory[cropId];
                    if (quantity > 0) {
                        hasItems = true;
                        const crop = crops.find(c => c.id == cropId);
                        const itemElement = document.createElement('div');
                        itemElement.className = 'crop-item';
                        itemElement.innerHTML = `
                            <div class="crop-icon">${crop.icon}</div>
                            <div class="crop-name">${crop.name}</div>
                            <div>Množství: ${quantity}</div>
                            <div>Cena: $${crop.sellPrice} za kus</div>
                            <button class="sell-btn" data-crop="${crop.id}">Prodat vše za $${quantity * crop.sellPrice}</button>
                        `;
                        
                        marketItems.appendChild(itemElement);
                    }
                });
                
                if (!hasItems) {
                    marketItems.innerHTML = '<p>Nemáš žádné plodiny k prodeji.</p>';
                }
                
                document.querySelectorAll('.sell-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        const cropId = e.target.dataset.crop;
                        sellCrops(cropId);
                    });
                });
                
                document.getElementById('market-modal').style.display = 'flex';
            }

            // Prodej plodin
            function sellCrops(cropId) {
                const crop = crops.find(c => c.id == cropId);
                const quantity = gameState.inventory[cropId];
                const totalPrice = quantity * crop.sellPrice;
                
                gameState.money += totalPrice;
                gameState.inventory[cropId] = 0;
                
                updateDisplay();
                openMarket();
                saveGame();
            }

            // Otevření vylepšení
            function openUpgrades() {
                document.getElementById('upgrades-modal').style.display = 'flex';
            }

            // Spuštění hry
            initGame();
        });
    </script>
</body>
</html>