<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harvest Valley | Farm√°≈ôsk√° Hra</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: manipulation;
        }

        :root {
            --bg-primary: linear-gradient(135deg, #87CEEB, #98FB98);
            --bg-secondary: rgba(255, 255, 255, 0.95);
            --text-primary: #2d5016;
            --text-secondary: #4a7c1f;
            --accent-color: #a3d977;
            --border-color: #a5d6a7;
            --button-bg: linear-gradient(135deg, #4caf50, #2e7d32);
            --plot-bg: #d7ccc8;
            --plot-planted: #8bc34a;
            --plot-ready: #ffd54f;
            --plot-withered: #795548;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            
            /* Barvy pro rarity */
            --common: #9e9e9e;
            --uncommon: #4caf50;
            --rare: #2196f3;
            --legendary: #9c27b0;
            --mythical: #ff9800;
            --event: #f44336;
        }

        .dark-mode {
            --bg-primary: linear-gradient(135deg, #1a2f3f, #2d4a2d);
            --bg-secondary: rgba(40, 40, 40, 0.95);
            --text-primary: #c8e6c9;
            --text-secondary: #a5d6a7;
            --accent-color: #4a7c1f;
            --border-color: #4a7c1f;
            --button-bg: linear-gradient(135deg, #388e3c, #1b5e20);
            --plot-bg: #5d4037;
            --plot-planted: #689f38;
            --plot-ready: #fbc02d;
            --plot-withered: #4e342e;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 100%;
            width: 100%;
            text-align: center;
        }

        header {
            margin-bottom: 20px;
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            position: relative;
        }

        .theme-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-primary);
            transition: transform 0.3s ease;
        }

        .theme-toggle:hover {
            transform: rotate(30deg);
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            color: var(--text-primary);
            text-shadow: 2px 2px 0 var(--accent-color);
        }

        .subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .season-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .season-icon {
            font-size: 1.5rem;
        }

        .auto-time-info {
            background: #e3f2fd;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-top: 5px;
            border: 2px solid #2196f3;
        }

        .dark-mode .auto-time-info {
            background: #1a2f3f;
            border-color: #1976d2;
        }

        /* Daily Gifts info */
        .daily-gift-info {
            background: #fff3e0;
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-top: 5px;
            border: 2px solid #ffb300;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .daily-gift-info:hover {
            transform: scale(1.02);
        }

        .dark-mode .daily-gift-info {
            background: #5d4037;
            border-color: #ffb300;
        }

        .gift-icon {
            color: #ff9800;
        }

        .game-container {
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 15px;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
            background: #e8f5e9;
            padding: 10px;
            border-radius: 10px;
            border: 3px solid var(--border-color);
        }

        .dark-mode .stats {
            background: #2d4a2d;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 8px 12px;
            border-radius: 10px;
            min-width: 80px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .dark-mode .stat-item {
            background: #3a3a3a;
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 3px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .money-icon {
            color: #ffd700;
        }

        .farm-container {
            background: #c8e6c9;
            border-radius: 10px;
            padding: 15px;
            border: 5px solid #8bc34a;
            margin: 0 auto 15px;
            max-width: 100%;
        }

        .dark-mode .farm-container {
            background: #2d4a2d;
            border-color: #4a7c1f;
        }

        .farm {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 0 auto;
            max-width: 100%;
            justify-content: center;
        }

        .plot {
            width: 85px;
            height: 85px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            transition: all 0.3s ease;
            background: var(--plot-bg);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
            padding: 5px;
        }

        .plot:hover {
            transform: scale(1.05);
        }

        .plot.empty {
            background: var(--plot-bg);
        }

        .plot.planted {
            background: var(--plot-planted);
        }

        .plot.ready {
            background: var(--plot-ready);
            animation: pulse 1s infinite;
        }

        .plot.withered {
            background: var(--plot-withered);
        }

        .plot.new {
            background: #ffecb3;
            border: 2px dashed #ff9800;
        }

        .dark-mode .plot.new {
            background: #5d4037;
            border-color: #ff9800;
        }

        .crops {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .crop-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 10px;
            border-radius: 10px;
            min-width: 90px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
            border: 2px solid #ffd54f;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dark-mode .crop-item {
            background: #3a3a3a;
            color: var(--text-primary);
        }

        .crop-item.selected {
            border-color: #e53935;
            background: #fff3e0;
            transform: scale(1.05);
        }

        .dark-mode .crop-item.selected {
            background: #5d4037;
        }

        .crop-item.locked {
            border-color: #9e9e9e;
            background: #f5f5f5;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .dark-mode .crop-item.locked {
            background: #2a2a2a;
        }

        .crop-item:hover:not(.locked) {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        }

        .crop-icon {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .crop-name {
            font-size: 0.85rem;
            font-weight: bold;
            color: var(--text-primary);
        }

        .crop-cost {
            font-size: 0.75rem;
            color: #e53935;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .crop-time {
            font-size: 0.75rem;
            color: #1976d2;
        }

        .crop-locked {
            font-size: 0.75rem;
            color: #757575;
            font-style: italic;
        }

        /* P≈òID√ÅNO: Styly pro rarity */
        .rarity-common {
            color: var(--common);
            font-weight: bold;
        }
        
        .rarity-uncommon {
            color: var(--uncommon);
            font-weight: bold;
        }
        
        .rarity-rare {
            color: var(--rare);
            font-weight: bold;
        }
        
        .rarity-legendary {
            color: var(--legendary);
            font-weight: bold;
        }
        
        .rarity-mythical {
            color: var(--mythical);
            font-weight: bold;
        }
        
        .rarity-event {
            color: var(--event);
            font-weight: bold;
        }
        
        .rarity-badge {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-top: 3px;
        }
        
        .rarity-badge.common {
            background-color: var(--common);
            color: white;
        }
        
        .rarity-badge.uncommon {
            background-color: var(--uncommon);
            color: white;
        }
        
        .rarity-badge.rare {
            background-color: var(--rare);
            color: white;
        }
        
        .rarity-badge.legendary {
            background-color: var(--legendary);
            color: white;
        }
        
        .rarity-badge.mythical {
            background-color: var(--mythical);
            color: white;
        }
        
        .rarity-badge.event {
            background-color: var(--event);
            color: white;
        }

        /* P≈òID√ÅNO: Styly pro obl√≠ben√© plodiny */
        .favorite-toggle {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #ccc;
            transition: all 0.3s ease;
            margin-top: 5px;
        }

        .favorite-toggle.favorited {
            color: #ffd700;
        }

        .favorite-toggle:hover {
            transform: scale(1.2);
        }

        .crop-item.favorited {
            border-color: #ffd700;
            background: #fffde7;
        }

        .dark-mode .crop-item.favorited {
            background: #5d4037;
        }

        .animals {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .animal-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 10px;
            border-radius: 10px;
            min-width: 90px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
            border: 2px solid #81c784;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dark-mode .animal-item {
            background: #3a3a3a;
            color: var(--text-primary);
        }

        .animal-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        }

        .animal-icon {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .animal-name {
            font-size: 0.85rem;
            font-weight: bold;
            color: var(--text-primary);
        }

        .animal-cost {
            font-size: 0.75rem;
            color: #e53935;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .animal-income {
            font-size: 0.75rem;
            color: #43a047;
        }

        /* P≈òID√ÅNO: Styly pro prodej zv√≠≈ôat */
        .animal-actions {
            display: flex;
            gap: 5px;
            margin-top: 5px;
            flex-wrap: wrap;
        }

        .animal-actions button {
            padding: 5px 8px;
            font-size: 0.7rem;
        }

        .sell-animal {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .animal-count {
            font-size: 0.7rem;
            color: #1976d2;
            margin-top: 2px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 16px;
            border: none;
            border-radius: 20px;
            background: var(--button-bg);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            white-space: nowrap;
            min-width: fit-content;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .market {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .upgrades {
            background: linear-gradient(135deg, #2196f3, #0d47a1);
        }

        .save {
            background: linear-gradient(135deg, #9c27b0, #673ab7);
        }

        .economy {
            background: linear-gradient(135deg, #ff5722, #d84315);
        }

        .reset {
            background: linear-gradient(135deg, #f44336, #b71c1c);
        }

        /* P≈òID√ÅNO: Styly pro ƒçasovaƒç */
        .timer-button {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            width: 150px;
            justify-content: center;
        }

        .timer-button:disabled {
            background: linear-gradient(135deg, #757575, #616161);
        }

        .selected-crop {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            border: 2px dashed #4caf50;
            font-size: 0.9rem;
        }

        .dark-mode .selected-crop {
            background: #2d4a2d;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: modalAppear 0.4s ease;
            position: relative;
            overflow-y: auto;
        }

        .dark-mode .modal-content {
            background: #3a3a3a;
            color: var(--text-primary);
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #757575;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            background: #f5f5f5;
            color: #e53935;
        }

        .dark-mode .close-modal:hover {
            background: #4a4a4a;
        }

        .modal h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: var(--text-primary);
            padding-right: 30px;
        }

        .modal p {
            margin-bottom: 20px;
            font-size: 1.1rem;
            line-height: 1.5;
            color: var(--text-secondary);
        }

        /* P≈òID√ÅNO: Styly pro invent√°≈ô */
        .inventory-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .inventory-filter {
            padding: 6px 12px;
            border: 2px solid #ff9800;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .inventory-filter.active {
            background: #ff9800;
            color: white;
        }

        .dark-mode .inventory-filter {
            background: #3a3a3a;
            color: var(--text-primary);
        }

        .dark-mode .inventory-filter.active {
            background: #ff9800;
            color: white;
        }

        .inventory-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: white;
            padding: 10px 12px;
            border-radius: 10px;
            margin: 8px 0;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
            border: 2px solid #ff9800;
            flex-wrap: wrap;
        }

        .dark-mode .inventory-item {
            background: #3a3a3a;
            border-color: #ff9800;
        }

        .inventory-item-info {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .inventory-icon {
            font-size: 1.6rem;
        }

        .inventory-details {
            text-align: left;
            flex: 1;
        }

        .inventory-name {
            font-weight: bold;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .inventory-description {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .inventory-actions {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        /* P≈òID√ÅNO: Styly pro profily */
        .profiles-container {
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 15px;
            box-shadow: var(--shadow);
            margin-bottom: 15px;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .profiles {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .profile-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 12px;
            border-radius: 10px;
            min-width: 140px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
            border: 2px solid #9c27b0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dark-mode .profile-item {
            background: #3a3a3a;
            color: var(--text-primary);
        }

        .profile-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        }

        .profile-item.active {
            border-color: #4caf50;
            background: #e8f5e9;
        }

        .dark-mode .profile-item.active {
            background: #2d4a2d;
        }

        .profile-item.locked {
            border-color: #9e9e9e;
            background: #f5f5f5;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .dark-mode .profile-item.locked {
            background: #2a2a2a;
        }

        .profile-icon {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }

        .profile-name {
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .profile-info {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 5px;
        }

        .profile-cost {
            font-size: 0.75rem;
            color: #e53935;
            margin-top: 3px;
        }

        /* P≈òID√ÅNO: Styly pro boxy v invent√°≈ôi */
        .box-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 12px;
            border-radius: 10px;
            min-width: 110px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
            border: 2px solid #ff9800;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dark-mode .box-item {
            background: #3a3a3a;
            border-color: #ff9800;
        }

        .box-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        }

        .box-icon {
            font-size: 2.2rem;
            margin-bottom: 8px;
        }

        .box-name {
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .box-description {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 5px;
        }

        .box-cost {
            font-size: 0.85rem;
            color: #e53935;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .box-count {
            font-size: 0.75rem;
            color: #1976d2;
            margin-top: 5px;
        }

        /* P≈òID√ÅNO: Styly pro obchod s boxy */
        .box-shop-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
            border: 2px solid #ff9800;
            transition: all 0.2s;
        }

        .dark-mode .box-shop-item {
            background: #3a3a3a;
            border-color: #ff9800;
        }

        .box-shop-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        }

        .box-shop-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .box-shop-name {
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 5px;
            font-size: 1rem;
        }

        .box-shop-description {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 10px;
        }

        .box-shop-cost {
            font-size: 0.9rem;
            color: #e53935;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .box-shop-rewards {
            font-size: 0.75rem;
            color: #4caf50;
            text-align: center;
            margin-bottom: 10px;
        }

        /* P≈òID√ÅNO: Styly pro creator button */
        .creator-button {
            background: linear-gradient(135deg, #9c27b0, #673ab7);
            margin-top: 10px;
        }

        .instructions {
            background: #e8f5e9;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            text-align: left;
            font-size: 0.85rem;
            border: 2px dashed #81c784;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .dark-mode .instructions {
            background: #2d4a2d;
        }

        .instructions h3 {
            color: var(--text-primary);
            margin-bottom: 8px;
            text-align: center;
            font-size: 1.1rem;
        }

        .instructions ul {
            list-style-type: none;
            padding-left: 0;
        }

        .instructions li {
            margin-bottom: 8px;
            display: flex;
            align-items: flex-start;
            font-size: 0.8rem;
        }

        .instructions li::before {
            content: "üå±";
            margin-right: 8px;
            margin-top: 2px;
        }

        footer {
            margin-top: 20px;
            text-align: center;
            color: var(--text-primary);
            font-size: 0.75rem;
            width: 100%;
            max-width: 600px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }

        .dark-mode .progress-bar {
            background: #4a4a4a;
        }

        .progress {
            height: 100%;
            background: #4caf50;
            border-radius: 5px;
            transition: width 0.3s;
        }

        .xp-bar {
            width: 100%;
            height: 15px;
            background: #e0e0e0;
            border-radius: 10px;
            margin: 5px 0;
            overflow: hidden;
            position: relative;
        }

        .dark-mode .xp-bar {
            background: #4a4a4a;
        }

        .xp-progress {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .xp-text {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: bold;
            color: var(--text-primary);
        }

        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            transform: translateY(100px);
            transition: transform 0.3s ease;
            z-index: 1000;
            display: none;
        }

        .save-indicator.show {
            transform: translateY(0);
        }

        .time-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(33, 150, 243, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
        }

        .time-indicator.show {
            display: block;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes modalAppear {
            from { opacity: 0; transform: translateY(-30px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .season-indicator {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 6px;
            font-size: 0.9rem;
        }

        .season-spring { background: #c8e6c9; color: #2e7d32; }
        .season-summer { background: #fff9c4; color: #f57f17; }
        .season-autumn { background: #ffcc80; color: #ef6c00; }
        .season-winter { background: #e3f2fd; color: #1565c0; }

        .dark-mode .season-spring { background: #2d4a2d; color: #c8e6c9; }
        .dark-mode .season-summer { background: #5d4037; color: #ffd54f; }
        .dark-mode .season-autumn { background: #5d4037; color: #ffb74d; }
        .dark-mode .season-winter { background: #1a2f3f; color: #bbdefb; }

        .upgrade-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
            border: 2px solid #2196f3;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dark-mode .upgrade-item {
            background: #3a3a3a;
            color: var(--text-primary);
        }

        .upgrade-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        }

        .upgrade-item.purchased {
            border-color: #4caf50;
            background: #e8f5e9;
        }

        .dark-mode .upgrade-item.purchased {
            background: #2d4a2d;
        }

        .upgrade-icon {
            font-size: 1.6rem;
            margin-bottom: 5px;
        }

        .upgrade-name {
            font-size: 0.85rem;
            font-weight: bold;
            color: var(--text-primary);
        }

        .upgrade-cost {
            font-size: 0.75rem;
            color: #e53935;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .upgrade-description {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-align: center;
            margin: 5px 0;
        }

        .upgrade-stats {
            font-size: 0.65rem;
            color: #666;
            margin-top: 3px;
        }

        .dark-mode .upgrade-stats {
            color: #aaa;
        }

        .economy-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
            border: 2px solid #ff5722;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dark-mode .economy-item {
            background: #3a3a3a;
            color: var(--text-primary);
        }

        .economy-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        }

        .economy-item.purchased {
            border-color: #4caf50;
            background: #e8f5e9;
        }

        .dark-mode .economy-item.purchased {
            background: #2d4a2d;
        }

        .economy-icon {
            font-size: 1.6rem;
            margin-bottom: 5px;
        }

        .economy-name {
            font-size: 0.85rem;
            font-weight: bold;
            color: var(--text-primary);
        }

        .economy-cost {
            font-size: 0.75rem;
            color: #e53935;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .economy-description {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-align: center;
            margin: 5px 0;
        }

        .economy-income {
            font-size: 0.65rem;
            color: #43a047;
            margin-top: 3px;
        }

        .code-input-container {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .code-input {
            flex: 1;
            padding: 10px;
            border: 2px solid #ff9800;
            border-radius: 10px;
            font-size: 0.9rem;
        }

        .submit-code {
            padding: 10px 15px;
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .used-codes {
            margin-top: 20px;
            text-align: left;
        }

        .used-codes h3 {
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .code-item {
            padding: 8px;
            margin: 5px 0;
            background: #f5f5f5;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
        }

        .dark-mode .code-item {
            background: #3a3a3a;
        }

        .code-name {
            font-weight: bold;
        }

        .code-reward {
            color: #4caf50;
        }

        .profile-actions {
            display: flex;
            gap: 5px;
            margin-top: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .profile-actions button {
            padding: 5px 8px;
            font-size: 0.7rem;
        }

        .rename-profile {
            background: linear-gradient(135deg, #2196f3, #0d47a1);
        }

        .delete-profile {
            background: linear-gradient(135deg, #f44336, #b71c1c);
        }

        .shared-inventory-notice {
            background: #e3f2fd;
            padding: 8px;
            border-radius: 10px;
            margin: 10px 0;
            border: 2px solid #2196f3;
            font-size: 0.8rem;
        }

        .dark-mode .shared-inventory-notice {
            background: #1a2f3f;
            border-color: #1976d2;
        }

        @media (max-width: 480px) {
            .farm {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .plot {
                width: 70px;
                height: 70px;
                font-size: 1.2rem;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .crops, .animals {
                gap: 6px;
            }
            
            .crop-item, .animal-item {
                min-width: 70px;
                padding: 6px;
                font-size: 0.8rem;
            }
            
            .crop-icon, .animal-icon {
                font-size: 1.4rem;
            }
            
            .controls {
                gap: 6px;
            }
            
            button {
                padding: 8px 12px;
                font-size: 0.75rem;
                gap: 4px;
            }
            
            .timer-button {
                width: 120px;
            }
            
            .modal-content {
                max-width: 95%;
                padding: 15px;
            }
            
            .time-indicator {
                left: 10px;
                bottom: 10px;
                font-size: 0.7rem;
                padding: 8px 12px;
            }
            
            .profiles {
                gap: 8px;
            }
            
            .profile-item {
                min-width: 110px;
                padding: 10px;
            }
            
            .inventory-filters {
                gap: 6px;
            }
            
            .inventory-filter {
                padding: 5px 10px;
                font-size: 0.75rem;
            }
            
            .code-input-container {
                flex-direction: column;
            }
        }

        @media (max-width: 360px) {
            .plot {
                width: 65px;
                height: 65px;
            }
            
            button {
                padding: 6px 10px;
                font-size: 0.7rem;
            }
            
            .crop-item, .animal-item {
                min-width: 65px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button class="theme-toggle" id="theme-toggle">
                <i class="fas fa-moon"></i>
            </button>
            <h1>Harvest Valley <i class="fas fa-tractor"></i></h1>
            <p class="subtitle">Sta≈à se mistrem farm√°≈ôem! Pƒõstuj, skl√≠zej a roz≈°i≈ôuj svou farmu.</p>
            <div class="season-info">
                <span>Roƒçn√≠ obdob√≠:</span>
                <span class="season-indicator" id="season">Naƒç√≠t√°n√≠...</span>
                <span class="season-icon" id="season-icon">üå±</span>
            </div>
            <div class="auto-time-info">
                <i class="fas fa-clock"></i> Ka≈æd√Ωch 10 minut automaticky ubƒõhne den
            </div>
            <!-- Daily Gifts info -->
            <div class="daily-gift-info" id="daily-gift-info">
                <i class="fas fa-gift gift-icon"></i>
                <span id="gift-status">Daily Box: Dnes dostupn√Ω!</span>
            </div>
        </header>

        <div class="game-container">
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-label">PEN√çZE</div>
                    <div class="stat-value" id="money">100 <span class="money-icon">üí∏</span></div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">LEVEL</div>
                    <div class="stat-value" id="level">1</div>
                    <div class="xp-bar">
                        <div class="xp-progress" id="xp-progress" style="width: 0%"></div>
                        <div class="xp-text" id="xp-text">0/100 XP</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">DEN</div>
                    <div class="stat-value" id="day">1</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">POLE</div>
                    <div class="stat-value" id="farm-size">9</div>
                </div>
            </div>

            <div class="selected-crop">
                <strong>Vybr√°na plodina:</strong> 
                <span id="selected-crop-name">≈Ω√°dn√°</span>
                <span id="selected-crop-icon"></span>
            </div>

            <!-- Tlaƒç√≠tka -->
            <div class="controls">
                <!-- ƒåasovaƒç m√≠sto tlaƒç√≠tka Dal≈°√≠ Den -->
                <button id="next-day-timer" class="timer-button">
                    <i class="fas fa-hourglass-half"></i> <span id="timer-text">Dal≈°√≠ Den (1s)</span>
                </button>
                <button id="inventory" class="market">
                    <i class="fas fa-box-open"></i> Invent√°≈ô
                </button>
                <button id="upgrades" class="upgrades">
                    <i class="fas fa-tools"></i> N√°stroje
                </button>
                <button id="economy" class="economy">
                    <i class="fas fa-chart-line"></i> Ekonomika
                </button>
                <!-- Tlaƒç√≠tko pro obchod s boxy -->
                <button id="box-shop" class="market" style="background: linear-gradient(135deg, #ff4081, #e91e63);">
                    <i class="fas fa-gift"></i> Obchod s boxy
                </button>
            </div>

            <!-- Tlaƒç√≠tko pro k√≥dy -->
            <div class="controls" style="margin-top: 10px;">
                <button id="codes" class="codes-button" style="background: linear-gradient(135deg, #ff4081, #e91e63);">
                    <i class="fas fa-key"></i> K√≥dy
                </button>
            </div>

            <h3><i class="fas fa-seedling"></i> Tv√° Farm√°≈ôsk√° Pole</h3>
            <div class="farm-container">
                <div class="farm" id="farm"></div>
            </div>

            <h3><i class="fas fa-shopping-basket"></i> Sem√≠nka a Sazenice</h3>
            <div class="crops" id="crops"></div>

            <h3><i class="fas fa-paw"></i> Zv√≠≈ôec√≠ pomocn√≠ci</h3>
            <div class="animals" id="animals"></div>
        </div>

        <!-- Sekce Profily -->
        <div class="profiles-container">
            <h3><i class="fas fa-user"></i> Profily</h3>
            <div class="shared-inventory-notice" id="shared-inventory-notice" style="display: none;">
                <i class="fas fa-users"></i> SD√çLEN√ù INVENT√Å≈ò AKTIVN√ç - V≈°echny profily sd√≠l√≠ invent√°≈ô!
            </div>
            <div class="profiles" id="profiles"></div>
        </div>

        <div class="instructions">
            <h3>Jak hr√°t:</h3>
            <ul>
                <li>Nejprve vyber plodinu kliknut√≠m na ni v obchodƒõ</li>
                <li>Pak klikni na pr√°zdn√© pole k vysazen√≠ vybran√© plodiny</li>
                <li>Poƒçkej, a≈æ plodina vyroste (ukazuje progress bar)</li>
                <li>Skliƒè zral√© plodiny (≈ælut√° pole) a prodej je na tr≈æi≈°ti</li>
                <li>Obl√≠ben√© plodiny nelze prod√°vat!</li>
                <li>Po≈ôizuj si zv√≠≈ôec√≠ pomocn√≠ky pro pravideln√Ω p≈ô√≠jem</li>
                <li>Investuj do ekonomick√Ωch aktivit pro pasivn√≠ p≈ô√≠jem</li>
                <li><strong>Poƒçkej 1 vte≈ôinu na ƒçasovaƒçi pro dal≈°√≠ den</strong></li>
                <li><strong>Ka≈æd√Ωch 10 minut automaticky ubƒõhl den (online i offline)!</strong></li>
                <li><strong>Roƒçn√≠ obdob√≠ ovliv≈àuj√≠ r≈Øst plodin podle re√°ln√©ho ƒçasu!</strong></li>
                <li><strong>Ka≈æd√Ω den dostane≈° DAILY BOX do invent√°≈ôe!</strong></li>
                <li><strong>Nav≈°tiv Obchod s boxy pro r≈Øzn√© typy box≈Ø!</strong></li>
                <li><strong>Prod√°vej plodiny pouze na Tr≈æi≈°ti v invent√°≈ôi!</strong></li>
                <li><strong>SD√çLEN√ù INVENT√Å≈ò: Po zakoupen√≠ v ekonomice sd√≠lej√≠ v≈°echny profily invent√°≈ô!</strong></li>
            </ul>
            <!-- Tlaƒç√≠tko Tv≈Ørce -->
            <button id="creator-button" class="creator-button" style="width: 100%; margin-top: 15px;">
                <i class="fas fa-code"></i> Tv≈Ørce
            </button>
        </div>
    </div>

    <div class="save-indicator" id="save-indicator">
        <i class="fas fa-check"></i> Hra ulo≈æena!
    </div>

    <div class="time-indicator" id="time-indicator">
        <i class="fas fa-clock"></i> Automaticky ubƒõhl den!
    </div>

    <!-- Modal pro Invent√°≈ô -->
    <div class="modal" id="inventory-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-box-open"></i> Invent√°≈ô</h2>
            <div class="inventory-filters" id="inventory-filters">
                <button class="inventory-filter" data-filter="all">V≈†E</button>
                <button class="inventory-filter" data-filter="favorites">OBL√çBEN√â</button>
                <button class="inventory-filter" data-filter="market">TR≈ΩI≈†Tƒö</button>
                <button class="inventory-filter" data-filter="boxes">BOXY</button>
            </div>
            <div id="inventory-items"></div>
            <button class="close-modal-btn">Zav≈ô√≠t</button>
        </div>
    </div>

    <!-- Modal pro obchod s boxy -->
    <div class="modal" id="box-shop-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-gift"></i> Obchod s boxy</h2>
            <p>Kup boxy pro z√≠sk√°n√≠ speci√°ln√≠ch odmƒõn!</p>
            <div id="box-shop-items"></div>
            <button class="close-modal-btn">Zav≈ô√≠t</button>
        </div>
    </div>

    <div class="modal" id="upgrades-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-tools"></i> Farm√°≈ôsk√© N√°stroje</h2>
            <p>Vylep≈°i svou farmu pro vy≈°≈°√≠ v√Ωnosy!</p>
            <div id="upgrade-items"></div>
            <button class="close-modal-btn">Zav≈ô√≠t</button>
        </div>
    </div>

    <div class="modal" id="economy-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-chart-line"></i> Ekonomick√© Investice</h2>
            <p>Investuj do ekonomick√Ωch aktivit pro pasivn√≠ p≈ô√≠jem!</p>
            <div id="economy-items"></div>
            <button class="close-modal-btn">Zav≈ô√≠t</button>
        </div>
    </div>

    <div class="modal" id="level-up-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-trophy"></i> Level Up!</h2>
            <p>Gratulujeme! Postoupil jsi na level <span id="new-level">2</span>!</p>
            <p id="level-up-benefits"></p>
            <button class="close-modal-btn">Super!</button>
        </div>
    </div>

    <!-- Modal pro Tv≈Ørce -->
    <div class="modal" id="creator-modal">
        <div class="modal-content">
            <h2><i class="fas fa-code"></i> Tv≈Ørce</h2>
            <p>Chcete se pod√≠vat na web tv≈Ørce t√©to hry?</p>
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                <button id="creator-yes" style="background: #4caf50;">Ano, p≈ôej√≠t na web</button>
                <button id="creator-no" style="background: #f44336;">Ne, z≈Østat zde</button>
            </div>
        </div>
    </div>

    <!-- Modal pro k√≥dy -->
    <div class="modal" id="codes-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-key"></i> Speci√°ln√≠ K√≥dy</h2>
            <p>Zadej k√≥d pro z√≠sk√°n√≠ speci√°ln√≠ odmƒõny:</p>
            
            <div class="code-input-container">
                <input type="text" class="code-input" id="code-input" placeholder="Zadej k√≥d...">
                <button id="submit-code" class="submit-code">
                    <i class="fas fa-key"></i> Aktivovat K√≥d
                </button>
            </div>
            
            <div class="used-codes">
                <h3>Ji≈æ pou≈æit√© k√≥dy:</h3>
                <div id="used-codes-list"></div>
            </div>
            
            <button class="close-modal-btn">Zav≈ô√≠t</button>
        </div>
    </div>

    <!-- Modal pro otev≈ôen√≠ boxu -->
    <div class="modal" id="open-box-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2 id="box-title"><i class="fas fa-gift"></i> Otev√≠r√°≈° box...</h2>
            <div id="box-content" style="text-align: center; padding: 20px;">
                <div id="box-reward" style="font-size: 3rem; margin: 20px 0;"></div>
                <h3 id="box-message"></h3>
                <p id="box-details"></p>
            </div>
            <button class="close-modal-btn">Super!</button>
        </div>
    </div>

    <!-- Modal pro p≈ôejmenov√°n√≠ profilu -->
    <div class="modal" id="rename-profile-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-edit"></i> P≈ôejmenovat profil</h2>
            <p>Zadej nov√© jm√©no pro profil:</p>
            <input type="text" class="code-input" id="profile-name-input" placeholder="Nov√© jm√©no profilu...">
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                <button id="rename-confirm" style="background: #4caf50;">Potvrdit</button>
                <button id="rename-cancel" style="background: #f44336;">Zru≈°it</button>
            </div>
        </div>
    </div>

    <footer>
        <p>Harvest Valley - Farm√°≈ôsk√° strategie &copy; 2023</p>
        <p><small>Hra funguje offline a automaticky ukl√°d√° postup</small></p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Hern√≠ konstanty
            const INITIAL_FARM_SIZE = 9;
            const SAVE_KEY_PREFIX = 'harvest_valley_profile_';
            const THEME_KEY = 'harvest_valley_theme';
            const AUTO_DAY_INTERVAL = 10 * 60 * 1000;
            const MAX_SECRET_SEEDS = 999999;
            const DAY_TIMER_DURATION = 1000; // 1 sekunda
            const CODES_KEY = 'harvest_valley_used_codes';
            const UNLIMITED_CODES_KEY = 'harvest_valley_unlimited_codes';
            const DAILY_GIFT_SETTINGS_KEY = 'harvest_valley_daily_gifts';
            const MAX_PROFILES = 3;
            const PROFILE_COST = 1000000000; // 1 miliarda üí∏
            const SHARED_INVENTORY_COST = 15000000000; // 15 miliard üí∏
            const INVENTORY_FILTER_KEY = 'harvest_valley_inventory_filter';
            const SHARED_INVENTORY_KEY = 'harvest_valley_shared_inventory';
            const PROFILE_NAMES_KEY = 'harvest_valley_profile_names';

            // Re√°ln√° roƒçn√≠ obdob√≠
            const REAL_SEASONS = {
                0: { name: 'Leden', icon: '‚ùÑÔ∏è', multiplier: 1.0, class: 'season-winter' },
                1: { name: '√önor', icon: '‚ùÑÔ∏è', multiplier: 1.0, class: 'season-winter' },
                2: { name: 'B≈ôezen', icon: 'üå±', multiplier: 1.0, class: 'season-spring' },
                3: { name: 'Duben', icon: 'üå∏', multiplier: 1.4, class: 'season-spring' },
                4: { name: 'Kvƒõten', icon: 'üåº', multiplier: 1.5, class: 'season-spring' },
                5: { name: 'ƒåerven', icon: '‚òÄÔ∏è', multiplier: 1.8, class: 'season-summer' },
                6: { name: 'ƒåervenec', icon: 'üåû', multiplier: 2.0, class: 'season-summer' },
                7: { name: 'Srpen', icon: 'üî•', multiplier: 1.9, class: 'season-summer' },
                8: { name: 'Z√°≈ô√≠', icon: 'üçÇ', multiplier: 1.3, class: 'season-autumn' },
                9: { name: '≈ò√≠jen', icon: 'üçÅ', multiplier: 1.1, class: 'season-autumn' },
                10: { name: 'Listopad', icon: 'üåßÔ∏è', multiplier: 1.0, class: 'season-autumn' },
                11: { name: 'Prosinec', icon: '‚õÑ', multiplier: 1.0, class: 'season-winter' }
            };

            // Speci√°ln√≠ k√≥dy
            const SPECIAL_CODES = {
                'Level12studio': {
                    name: 'Level12studio',
                    reward: 'P≈ôid√° 12 level≈Ø',
                    apply: function(gameState) {
                        for (let i = 0; i < 12; i++) {
                            gameState.level++;
                            gameState.xp = 0;
                        }
                        return 'Z√≠skal jsi +12 level≈Ø!';
                    }
                },
                'MoneyTree3': {
                    name: 'MoneyTree3',
                    reward: 'P≈ôid√° upgrade Strom penƒõz',
                    apply: function(gameState) {
                        if (!gameState.upgrades.includes(16)) {
                            gameState.upgrades.push(16);
                            gameState.sellMultiplier += 1.0;
                            return 'Z√≠skal jsi upgrade Strom penƒõz (+100% cena prodeje)!';
                        } else {
                            return 'Tento upgrade u≈æ m√°≈°!';
                        }
                    }
                },
                'DoPlo12': {
                    name: 'DoPlo12',
                    reward: 'P≈ôid√° 12000 üí∏',
                    apply: function(gameState) {
                        gameState.money += 12000;
                        return 'Z√≠skal jsi 12,000 üí∏!';
                    }
                },
                'FastFood_123_Event': {
                    name: 'FastFood_123_Event',
                    reward: 'P≈ôid√° v≈°echny event plodiny 1x',
                    apply: function(gameState) {
                        [50, 51, 52].forEach(cropId => {
                            if (!gameState.inventory[cropId]) {
                                gameState.inventory[cropId] = 0;
                            }
                            gameState.inventory[cropId] += 1;
                        });
                        return 'Z√≠skal jsi v≈°echny event plodiny (1x ka≈æd√°)!';
                    }
                },
                '2012DoPlo12': {
                    name: 'DoPlo12 speci√°ln√≠ k√≥d',
                    reward: 'D√° 1 miliardu level≈Ø, 1 bilion üí∏, nekoneƒçn√© k√≥dy a 10 DAILY BOX≈Æ DENNƒö NAV≈ΩDY',
                    apply: function(gameState) {
                        gameState.level = 1000000000;
                        gameState.xp = 0;
                        gameState.money += 1000000000000;
                        gameState.unlimitedCodes = true;
                        localStorage.setItem(UNLIMITED_CODES_KEY, 'true');
                        
                        const savedGiftSettings = loadDailyGiftSettings();
                        savedGiftSettings.giftsPerDay = 10;
                        savedGiftSettings.specialGiftActive = true;
                        saveDailyGiftSettings(savedGiftSettings);
                        
                        return 'Z√≠skal jsi 1,000,000,000 level≈Ø, 1,000,000,000,000 üí∏, nekoneƒçn√© k√≥dy a 10 DAILY BOX≈Æ DENNƒö NAV≈ΩDY!';
                    }
                },
                'Harvest_Valley_Love': {
                    name: 'Harvest_Valley_Love',
                    reward: 'D√° level 100 a 15000000 üí∏',
                    apply: function(gameState) {
                        const levelsToAdd = 100 - gameState.level;
                        if (levelsToAdd > 0) {
                            gameState.level = 100;
                            gameState.xp = 0;
                        }
                        gameState.money += 15000000;
                        return 'Level zv√Ω≈°en na 100 a z√≠skal jsi 15,000,000 üí∏!';
                    }
                }
            };

            // Typy box≈Ø s individu√°ln√≠mi ikonami
            const BOX_TYPES = {
                commonBox: {
                    name: 'Common Box',
                    icon: 'üì¶',
                    description: '90% Common, 10% Uncommon plodiny',
                    cost: 100,
                    rarity: 'common'
                },
                uncommonBox: {
                    name: 'Uncommon Box',
                    icon: 'üì´',
                    description: '80% Uncommon, 10% Common, 10% Rare',
                    cost: 500,
                    rarity: 'uncommon'
                },
                rareBox: {
                    name: 'Rare Box',
                    icon: 'üíé',
                    description: '83% Rare, 10% Uncommon, 5% Common, 3% Legendary',
                    cost: 2000,
                    rarity: 'rare'
                },
                legendaryBox: {
                    name: 'Legendary Box',
                    icon: 'üèÜ',
                    description: '85% Legendary, 10% Rare, 5% Mythical',
                    cost: 5000,
                    rarity: 'legendary'
                },
                mythicalBox: {
                    name: 'Mythical Box',
                    icon: '‚ú®',
                    description: '94% Mythical, 5% Legendary, 1% Event',
                    cost: 50000,
                    rarity: 'mythical'
                },
                eventBox: {
                    name: 'Event Box',
                    icon: 'üéÅ',
                    description: '60% Event, 20% Mythical, 15% Legendary, 5% Rare',
                    cost: 250000,
                    rarity: 'event'
                },
                dailyBox: {
                    name: 'Daily Box',
                    icon: 'üéÅ',
                    description: 'Ka≈ædodenn√≠ d√°rek - r≈Øzn√© odmƒõny',
                    cost: 0,
                    rarity: 'special'
                }
            };

            // Rarity syst√©my
            const RARITY = {
                COMMON: 'common',
                UNCOMMON: 'uncommon', 
                RARE: 'rare',
                LEGENDARY: 'legendary',
                MYTHICAL: 'mythical',
                EVENT: 'event'
            };

            // Stav hry
            let gameState = {
                money: 100,
                xp: 0,
                level: 1,
                day: 1,
                farm: [],
                inventory: {},
                animals: [],
                upgrades: [],
                economy: [],
                selectedCrop: null,
                farmSize: INITIAL_FARM_SIZE,
                currentSeason: getCurrentRealSeason(),
                lastPlayed: Date.now(),
                growthMultiplier: 1.0,
                lastAutoDay: Date.now(),
                sellMultiplier: 1.0,
                currentProfile: 1,
                eventSeedsPlanted: 0,
                eventSeedsBought: 0,
                favoriteCrops: [],
                animalCounts: {},
                animalIncomeMultiplier: 1.0,
                usedCodes: [],
                unlimitedCodes: false,
                hasSharedInventory: false,
                pendingDailyBoxes: 0
            };

            // Daily Gifts stav
            let dailyGiftSettings = {
                enabled: true,
                lastClaimedDate: null,
                giftsPerDay: 1,
                specialGiftActive: false,
                pendingBoxes: 0
            };

            // Sd√≠len√Ω invent√°≈ô
            let sharedInventory = {
                enabled: false,
                items: {}
            };

            // Jm√©na profil≈Ø
            let profileNames = ['Profil 1', 'Profil 2', 'Profil 3'];

            // ƒåasovaƒçov√© promƒõnn√©
            let dayTimer = null;
            let dayTimerEndTime = null;
            let dayTimerRemaining = DAY_TIMER_DURATION;

            // Posledn√≠ otev≈ôen√Ω filtr invent√°≈ôe
            let lastInventoryFilter = 'all';

            // Plodiny s nov√Ωm syst√©mem rarity
            const crops = [
                // Common
                { id: 1, name: 'Mrkev', icon: 'ü•ï', cost: 10, growTime: 3, sellPrice: 20, xp: 5, unlocked: true, unlockLevel: 1, rarity: RARITY.COMMON },
                { id: 2, name: 'Brambory', icon: 'ü•î', cost: 15, growTime: 4, sellPrice: 30, xp: 8, unlocked: false, unlockLevel: 2, rarity: RARITY.COMMON },
                { id: 3, name: 'Kuku≈ôice', icon: 'üåΩ', cost: 20, growTime: 5, sellPrice: 40, xp: 12, unlocked: false, unlockLevel: 3, rarity: RARITY.COMMON },
                { id: 4, name: 'Jahody', icon: 'üçì', cost: 25, growTime: 4, sellPrice: 50, xp: 15, unlocked: false, unlockLevel: 4, rarity: RARITY.UNCOMMON },
                { id: 5, name: 'D√Ωnƒõ', icon: 'üéÉ', cost: 40, growTime: 6, sellPrice: 80, xp: 20, unlocked: false, unlockLevel: 5, rarity: RARITY.UNCOMMON },
                { id: 6, name: 'Brokolice', icon: 'ü•¶', cost: 45, growTime: 6, sellPrice: 90, xp: 25, unlocked: false, unlockLevel: 6, rarity: RARITY.UNCOMMON },
                { id: 7, name: 'Papriky', icon: 'ü´ë', cost: 50, growTime: 7, sellPrice: 100, xp: 28, unlocked: false, unlockLevel: 7, rarity: RARITY.RARE },
                { id: 8, name: 'Meloun', icon: 'üçâ', cost: 60, growTime: 8, sellPrice: 120, xp: 30, unlocked: false, unlockLevel: 8, rarity: RARITY.RARE },
                { id: 9, name: 'Ananas', icon: 'üçç', cost: 80, growTime: 10, sellPrice: 200, xp: 40, unlocked: false, unlockLevel: 9, rarity: RARITY.RARE },
                { id: 10, name: 'Draƒç√≠ ovoce', icon: 'üêâ', cost: 500, growTime: 15, sellPrice: 1000, xp: 30, unlocked: false, unlockLevel: 10, rarity: RARITY.LEGENDARY },
                { id: 11, name: '≈òepa', icon: 'ü´ú', cost: 1000, growTime: 20, sellPrice: 2500, xp: 50, unlocked: false, unlockLevel: 12, rarity: RARITY.LEGENDARY },
                { id: 12, name: 'K≈ôi≈°≈•√°lov√© jablko', icon: 'üçé', cost: 5000, growTime: 30, sellPrice: 75000, xp: 75, unlocked: false, unlockLevel: 15, rarity: RARITY.LEGENDARY },
                { id: 13, name: 'Mandarinka', icon: 'üçä', cost: 10000, growTime: 50, sellPrice: 20000, xp: 100, unlocked: false, unlockLevel: 50, rarity: RARITY.LEGENDARY },
                { id: 14, name: 'Kiwi', icon: 'ü•ù', cost: 50000, growTime: 70, sellPrice: 50000, xp: 500, unlocked: false, unlockLevel: 100, rarity: RARITY.LEGENDARY },
                { id: 15, name: 'Mango', icon: 'ü•≠', cost: 100000, growTime: 100, sellPrice: 200000, xp: 1000, unlocked: false, unlockLevel: 150, rarity: RARITY.LEGENDARY },
                { id: 16, name: 'Magick√© sem√≠nko', icon: 'üîÆ', cost: 500000, growTime: 200, sellPrice: 100000, xp: 2000, unlocked: false, unlockLevel: 200, rarity: RARITY.MYTHICAL },
                { id: 17, name: 'Zlat√° mrkev', icon: 'ü•ï', cost: 1000000, growTime: 300, sellPrice: 1500000, xp: 3000, unlocked: false, unlockLevel: 300, rarity: RARITY.MYTHICAL },
                { id: 18, name: 'Zlat√© brambory', icon: 'ü•î', cost: 1500000, growTime: 400, sellPrice: 2500000, xp: 4000, unlocked: false, unlockLevel: 400, rarity: RARITY.MYTHICAL },
                { id: 50, name: 'Halloweensk√° lebka', icon: '‚ò†Ô∏è', cost: 50000, growTime: 20, sellPrice: 100000, xp: 5, unlocked: true, unlockLevel: 1, rarity: RARITY.EVENT, isSecret: true },
                { id: 51, name: 'V√°noƒçn√≠ stromeƒçek', icon: 'üéÑ', cost: 50000, growTime: 20, sellPrice: 100000, xp: 5, unlocked: true, unlockLevel: 1, rarity: RARITY.EVENT, isSecret: true },
                { id: 52, name: 'Silvestrovsk√© rachejtle', icon: 'üß®', cost: 50000, growTime: 20, sellPrice: 100000, xp: 5, unlocked: true, unlockLevel: 1, rarity: RARITY.EVENT, isSecret: true },
                { id: 53, name: 'Plodina dobr√© n√°lady', icon: 'üòÄ', cost: 50000, growTime: 20, sellPrice: 100000, xp:5, unlocked: true, unlockLevel: 1, rarity: RARITY.EVENT, isSecret: false }
            ];

            // Zv√≠≈ôata
            const animals = [
                { id: 1, name: 'Slepice', icon: 'üêî', cost: 50, income: 5, xp: 1, unlocked: true, unlockLevel: 1 },
                { id: 2, name: 'Kr√°l√≠k', icon: 'üêá', cost: 80, income: 8, xp: 1, unlocked: false, unlockLevel: 2 },
                { id: 3, name: 'Ovce', icon: 'üêë', cost: 120, income: 12, xp: 1, unlocked: false, unlockLevel: 3 },
                { id: 4, name: 'Koza', icon: 'üêê', cost: 180, income: 15, xp: 2, unlocked: false, unlockLevel: 4 },
                { id: 5, name: 'Kr√°va', icon: 'üêÑ', cost: 250, income: 20, xp: 3, unlocked: false, unlockLevel: 5 },
                { id: 6, name: 'Prase', icon: 'üêñ', cost: 200, income: 18, xp: 4, unlocked: false, unlockLevel: 6 },
                { id: 7, name: 'K≈Ø≈à', icon: 'üêé', cost: 400, income: 25, xp: 5, unlocked: false, unlockLevel: 7 },
                { id: 8, name: 'Velbloud', icon: 'üê´', cost: 500, income: 30, xp: 8, unlocked: false, unlockLevel: 8 },
                { id: 9, name: 'Slon', icon: 'üêò', cost: 1000, income: 50, xp: 15, unlocked: false, unlockLevel: 9 },
                { id: 10, name: 'Jednoro≈æec', icon: 'ü¶Ñ', cost: 5000, income: 200, xp: 30, unlocked: false, unlockLevel: 10 },
                { id: 11, name: 'F√©nix', icon: 'üî•', cost: 10000, income: 500, xp: 60, unlocked: false, unlockLevel: 12 },
                { id: 12, name: 'Drak', icon: 'üê≤', cost: 50000, income: 2000, xp: 80, unlocked: false, unlockLevel: 15 },
                { id: 13, name: 'Zlat√° slepice', icon: 'ü•ö', cost: 100000, income: 5000, xp: 100, unlocked: false, unlockLevel: 50 },
                { id: 14, name: 'Zlat√Ω kr√°l√≠k', icon: 'üê∞', cost: 500000, income: 20000, xp: 200, unlocked: false, unlockLevel: 100 },
                { id: 15, name: 'Zlat√° ovce', icon: 'üêë', cost: 1000000, income: 50000, xp: 300, unlocked: false, unlockLevel: 150 },
                { id: 16, name: 'Zlat√° koza', icon: 'üêê', cost: 1500000, income: 100000, xp: 400, unlocked: false, unlockLevel: 200 }
            ];

            // Vylep≈°en√≠
            const upgrades = [
                { id: 1, name: 'Lep≈°√≠ konve', icon: 'üö∞', cost: 100, description: 'Rychlej≈°√≠ r≈Øst plodin o 10%', effect: 'growthBoost', value: 0.1, purchased: false },
                { id: 2, name: 'Kvalitn√≠ hnojivo', icon: 'üí©', cost: 200, description: 'Zvy≈°uje cenu prodeje o 15%', effect: 'sellBoost', value: 0.15, purchased: false },
                { id: 3, name: 'Automatick√° z√°vlaha', icon: 'üöø', cost: 300, description: 'Rychlej≈°√≠ r≈Øst plodin o 20%', effect: 'growthBoost', value: 0.2, purchased: false },
                { id: 4, name: 'Sklen√≠k', icon: 'üè≠', cost: 500, description: 'Rychlej≈°√≠ r≈Øst plodin o 30%', effect: 'growthBoost', value: 0.3, purchased: false },
                { id: 5, name: 'Rychlorostouc√≠ semena', icon: '‚ö°', cost: 400, description: 'Rychlej≈°√≠ r≈Øst plodin o 25%', effect: 'growthBoost', value: 0.25, purchased: false },
                { id: 6, name: 'Lep≈°√≠ krmivo', icon: 'ü•ó', cost: 300, description: 'Zvy≈°uje p≈ô√≠jem od zv√≠≈ôat o 25%', effect: 'animalBoost', value: 0.25, purchased: false },
                { id: 7, name: 'Pokroƒçil√© hnojivo', icon: 'üß™', cost: 600, description: 'Rychlej≈°√≠ r≈Øst plodin o 35%', effect: 'growthBoost', value: 0.35, purchased: false },
                { id: 8, name: 'Zahradn√≠ sk≈ô√≠tci', icon: 'üßö', cost: 800, description: 'Rychlej≈°√≠ r≈Øst plodin o 40%', effect: 'growthBoost', value: 0.4, purchased: false },
                { id: 9, name: 'Z√°zraƒçn√° voda', icon: 'üíß', cost: 1000, description: 'Rychlej≈°√≠ r≈Øst plodin o 50%', effect: 'growthBoost', value: 0.5, purchased: false },
                { id: 10, name: 'Expertn√≠ zemƒõdƒõlec', icon: 'üë®‚Äçüåæ', cost: 1200, description: 'Zvy≈°uje cenu prodeje o 25%', effect: 'sellBoost', value: 0.25, purchased: false },
                { id: 11, name: 'Pr√©miov√© krmivo', icon: 'ü•ï', cost: 1300, description: 'Zvy≈°uje p≈ô√≠jem od zv√≠≈ôat o 50%', effect: 'animalBoost', value: 0.5, purchased: false },
                { id: 12, name: 'Pr√©miov√° semena', icon: 'üå∞', cost: 1500, description: 'Rychlej≈°√≠ r≈Øst plodin o 60%', effect: 'growthBoost', value: 0.6, purchased: false },
                { id: 13, name: 'Robotick√Ω farm√°≈ô', icon: 'ü§ñ', cost: 2000, description: 'Rychlej≈°√≠ r≈Øst plodin o 75%', effect: 'growthBoost', value: 0.75, purchased: false },
                { id: 14, name: 'Modern√≠ hnojivo', icon: 'üü¢', cost: 50000, description: 'Zvy≈°uje cenu prodeje o 50%', effect: 'sellBoost', value: 0.5, purchased: false },
                { id: 15, name: 'Magick√° p≈Øda', icon: '‚ú®', cost: 100000, description: 'INSTANTN√ç r≈Øst plodin!', effect: 'instantGrowth', value: 0, purchased: false },
                { id: 16, name: 'Strom penƒõz', icon: 'üí≤', cost: 100000, description: 'Zvy≈°uje cenu prodeje o 100%', effect: 'sellBoost', value: 1.0, purchased: false },
                { id: 17, name: 'Zlat√© krmivo', icon: 'üü°', cost: 100000, description: 'Zvy≈°uje p≈ô√≠jem od zv√≠≈ôat o 100%', effect: 'animalBoost', value: 1.0, purchased: false }
            ];

            // Ekonomick√© investice
            const economyItems = [
                { id: 1, name: 'St√°nek s limon√°dou', icon: 'üçã', cost: 200, income: 10, xp: 20, description: 'Mal√Ω p≈ô√≠jem z prodeje limon√°dy', purchased: false },
                { id: 2, name: 'Farm√°≈ôsk√Ω trh', icon: 'üõí', cost: 500, income: 25, xp: 40, description: 'St√°l√Ω p≈ô√≠jem z prodeje na trhu', purchased: false },
                { id: 3, name: 'Zahradn√≠ kav√°rna', icon: '‚òï', cost: 1000, income: 50, xp: 60, description: 'P≈ô√≠jem z posezen√≠ v kav√°rnƒõ', purchased: false },
                { id: 4, name: 'Agroturistika', icon: 'üè°', cost: 2000, income: 100, xp: 80, description: 'P≈ô√≠jem z turist≈Ø na farmƒõ', purchased: false },
                { id: 5, name: 'Bioobchod', icon: 'üè™', cost: 4000, income: 200, xp: 120, description: 'P≈ô√≠jem z prodeje bio produkt≈Ø', purchased: false },
                { id: 6, name: 'Zemƒõdƒõlsk√° firma', icon: 'üè¢', cost: 8000, income: 400, xp: 200, description: 'Velk√Ω p≈ô√≠jem z velkoobchodu', purchased: false },
                { id: 7, name: 'Sd√≠len√Ω invent√°≈ô', icon: 'ü§ù', cost: SHARED_INVENTORY_COST, income: 0, xp: 1000, description: 'V≈°echny profily sd√≠lej√≠ invent√°≈ô!', purchased: false }
            ];

            // DOM elementy
            const moneyElement = document.getElementById('money');
            const levelElement = document.getElementById('level');
            const dayElement = document.getElementById('day');
            const xpProgressElement = document.getElementById('xp-progress');
            const xpTextElement = document.getElementById('xp-text');
            const farmElement = document.getElementById('farm');
            const cropsElement = document.getElementById('crops');
            const animalsElement = document.getElementById('animals');
            const selectedCropNameElement = document.getElementById('selected-crop-name');
            const selectedCropIconElement = document.getElementById('selected-crop-icon');
            const farmSizeElement = document.getElementById('farm-size');
            const seasonElement = document.getElementById('season');
            const seasonIconElement = document.getElementById('season-icon');
            const themeToggle = document.getElementById('theme-toggle');
            const saveIndicator = document.getElementById('save-indicator');
            const timeIndicator = document.getElementById('time-indicator');
            const nextDayTimerButton = document.getElementById('next-day-timer');
            const timerTextElement = document.getElementById('timer-text');
            const inventoryButton = document.getElementById('inventory');
            const upgradesButton = document.getElementById('upgrades');
            const economyButton = document.getElementById('economy');
            const boxShopButton = document.getElementById('box-shop');
            const codesButton = document.getElementById('codes');
            const creatorButton = document.getElementById('creator-button');
            const inventoryModal = document.getElementById('inventory-modal');
            const boxShopModal = document.getElementById('box-shop-modal');
            const upgradesModal = document.getElementById('upgrades-modal');
            const economyModal = document.getElementById('economy-modal');
            const levelUpModal = document.getElementById('level-up-modal');
            const creatorModal = document.getElementById('creator-modal');
            const codesModal = document.getElementById('codes-modal');
            const openBoxModal = document.getElementById('open-box-modal');
            const renameProfileModal = document.getElementById('rename-profile-modal');
            const creatorYesButton = document.getElementById('creator-yes');
            const creatorNoButton = document.getElementById('creator-no');
            const codeInput = document.getElementById('code-input');
            const submitCodeButton = document.getElementById('submit-code');
            const usedCodesList = document.getElementById('used-codes-list');
            const giftStatusElement = document.getElementById('gift-status');
            const dailyGiftInfoElement = document.getElementById('daily-gift-info');
            const profilesElement = document.getElementById('profiles');
            const inventoryItemsElement = document.getElementById('inventory-items');
            const inventoryFiltersElement = document.getElementById('inventory-filters');
            const boxShopItemsElement = document.getElementById('box-shop-items');
            const sharedInventoryNotice = document.getElementById('shared-inventory-notice');
            const profileNameInput = document.getElementById('profile-name-input');
            const renameConfirmButton = document.getElementById('rename-confirm');
            const renameCancelButton = document.getElementById('rename-cancel');

            // Promƒõnn√© pro p≈ôejmenov√°n√≠ profilu
            let profileToRename = null;

            // Inicializace hry
            function initGame() {
                loadTheme();
                loadProfileNames();
                loadGame();
                loadDailyGiftSettings();
                loadSharedInventory();
                loadLastInventoryFilter();
                updateUI();
                renderFarm();
                renderCrops();
                renderAnimals();
                renderProfiles();
                updateSeason();
                setupEventListeners();
                checkUnlocks();
                updateSharedInventoryNotice();
                
                setInterval(autoSave, 30000);
                setInterval(collectIncome, 60000);
                setInterval(autoNextDay, AUTO_DAY_INTERVAL);
                checkElapsedTime();
                startDayTimer();
                
                loadUsedCodes();
                loadUnlimitedCodes();
                
                // Automatick√° kontrola daily box≈Ø p≈ôi startu
                checkAndClaimDailyBox();
            }

            // Naƒçten√≠ t√©matu
            function loadTheme() {
                const savedTheme = localStorage.getItem(THEME_KEY);
                if (savedTheme === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                }
            }

            // Naƒçten√≠ jmen profil≈Ø
            function loadProfileNames() {
                const savedNames = localStorage.getItem(PROFILE_NAMES_KEY);
                if (savedNames) {
                    try {
                        const parsed = JSON.parse(savedNames);
                        if (Array.isArray(parsed) && parsed.length === 3) {
                            profileNames = parsed;
                        }
                    } catch (e) {
                        console.error('Chyba p≈ôi naƒç√≠t√°n√≠ jmen profil≈Ø:', e);
                    }
                }
            }

            // Ulo≈æen√≠ jmen profil≈Ø
            function saveProfileNames() {
                localStorage.setItem(PROFILE_NAMES_KEY, JSON.stringify(profileNames));
            }

            // Naƒçten√≠ hry
            function loadGame() {
                const saveKey = SAVE_KEY_PREFIX + gameState.currentProfile;
                const savedGame = localStorage.getItem(saveKey);
                
                if (!savedGame) {
                    initializeNewProfile(gameState.currentProfile);
                    return;
                }
                
                try {
                    const parsedGame = JSON.parse(savedGame);
                    
                    if (parsedGame && typeof parsedGame.money === 'number') {
                        // Zkontrolovat a doplnit chybƒõj√≠c√≠ vlastnosti
                        const defaultGameState = initializeNewProfile(gameState.currentProfile, true);
                        gameState = { ...defaultGameState, ...parsedGame };
                        
                        // Zajistit, ≈æe pole inventory obsahuje boxy
                        Object.keys(BOX_TYPES).forEach(boxType => {
                            if (!gameState.inventory[boxType]) gameState.inventory[boxType] = 0;
                        });
                        
                        // Zajistit, ≈æe v≈°echny plodiny maj√≠ spr√°vn√© unlocked stavy
                        checkUnlocks();
                    } else {
                        initializeNewProfile(gameState.currentProfile);
                    }
                } catch (e) {
                    console.error('Chyba p≈ôi naƒç√≠t√°n√≠ hry:', e);
                    initializeNewProfile(gameState.currentProfile);
                }
            }

            // Inicializace nov√©ho profilu
            function initializeNewProfile(profileId, returnOnly = false) {
                const newGameState = {
                    money: 100,
                    xp: 0,
                    level: 1,
                    day: 1,
                    farm: Array(INITIAL_FARM_SIZE).fill().map(() => ({ state: 'empty', progress: 0 })),
                    inventory: {},
                    animals: [],
                    upgrades: [],
                    economy: [],
                    selectedCrop: null,
                    farmSize: INITIAL_FARM_SIZE,
                    currentSeason: getCurrentRealSeason(),
                    lastPlayed: Date.now(),
                    growthMultiplier: 1.0,
                    lastAutoDay: Date.now(),
                    sellMultiplier: 1.0,
                    currentProfile: profileId,
                    eventSeedsPlanted: 0,
                    eventSeedsBought: 0,
                    favoriteCrops: [],
                    animalCounts: {},
                    animalIncomeMultiplier: 1.0,
                    usedCodes: [],
                    unlimitedCodes: false,
                    hasSharedInventory: false,
                    pendingDailyBoxes: 0
                };
                
                // Inicializovat inventory s boxy
                Object.keys(BOX_TYPES).forEach(boxType => {
                    newGameState.inventory[boxType] = 0;
                });
                
                if (!returnOnly) {
                    gameState = newGameState;
                    saveGame();
                }
                
                return newGameState;
            }

            // Naƒçten√≠ daily gifts nastaven√≠
            function loadDailyGiftSettings() {
                const savedSettings = localStorage.getItem(DAILY_GIFT_SETTINGS_KEY);
                if (savedSettings) {
                    try {
                        const parsed = JSON.parse(savedSettings);
                        Object.assign(dailyGiftSettings, parsed);
                        
                        // Pokud je k√≥d 2012DoPlo12 aktivn√≠, nastavit 10 daily box≈Ø dennƒõ
                        if (gameState.usedCodes.includes('2012DoPlo12')) {
                            dailyGiftSettings.giftsPerDay = 10;
                            dailyGiftSettings.specialGiftActive = true;
                        }
                    } catch (e) {
                        console.error('Chyba p≈ôi naƒç√≠t√°n√≠ daily gift nastaven√≠:', e);
                    }
                }
                return dailyGiftSettings;
            }

            // Ulo≈æen√≠ daily gifts nastaven√≠
            function saveDailyGiftSettings(settings = dailyGiftSettings) {
                localStorage.setItem(DAILY_GIFT_SETTINGS_KEY, JSON.stringify(settings));
            }

            // Naƒçten√≠ sd√≠len√©ho invent√°≈ôe
            function loadSharedInventory() {
                const savedSharedInventory = localStorage.getItem(SHARED_INVENTORY_KEY);
                if (savedSharedInventory) {
                    try {
                        const parsed = JSON.parse(savedSharedInventory);
                        Object.assign(sharedInventory, parsed);
                        
                        // Pokud je sd√≠len√Ω invent√°≈ô aktivn√≠, nastavit ve v≈°ech profilech
                        if (sharedInventory.enabled) {
                            gameState.hasSharedInventory = true;
                        }
                    } catch (e) {
                        console.error('Chyba p≈ôi naƒç√≠t√°n√≠ sd√≠len√©ho invent√°≈ôe:', e);
                    }
                }
            }

            // Ulo≈æen√≠ sd√≠len√©ho invent√°≈ôe
            function saveSharedInventory() {
                localStorage.setItem(SHARED_INVENTORY_KEY, JSON.stringify(sharedInventory));
            }

            // Naƒçten√≠ posledn√≠ho filtru invent√°≈ôe
            function loadLastInventoryFilter() {
                const savedFilter = localStorage.getItem(INVENTORY_FILTER_KEY);
                if (savedFilter && ['all', 'favorites', 'market', 'boxes'].includes(savedFilter)) {
                    lastInventoryFilter = savedFilter;
                }
            }

            // Ulo≈æen√≠ posledn√≠ho filtru invent√°≈ôe
            function saveLastInventoryFilter(filter) {
                lastInventoryFilter = filter;
                localStorage.setItem(INVENTORY_FILTER_KEY, filter);
            }

            // Kontrola daily box≈Ø
            function checkDailyGifts() {
                const today = new Date().toDateString();
                const lastClaimed = dailyGiftSettings.lastClaimedDate ? 
                    new Date(dailyGiftSettings.lastClaimedDate).toDateString() : null;
                
                return lastClaimed !== today;
            }

            // Kontrola a p≈ôid√°n√≠ Daily Box≈Ø
            function checkAndClaimDailyBox() {
                const today = new Date().toDateString();
                const lastClaimed = dailyGiftSettings.lastClaimedDate ? 
                    new Date(dailyGiftSettings.lastClaimedDate).toDateString() : null;
                
                if (lastClaimed !== today) {
                    // Spoƒç√≠tat kolik dn√≠ ubƒõhlo
                    let daysPassed = 1;
                    if (lastClaimed) {
                        const lastDate = new Date(dailyGiftSettings.lastClaimedDate);
                        const todayDate = new Date();
                        const diffTime = Math.abs(todayDate - lastDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        daysPassed = Math.min(diffDays, 30); // Maxim√°lnƒõ 30 dn√≠ zpƒõtnƒõ
                    }
                    
                    // P≈ôidat boxy do ƒçekaj√≠c√≠ch
                    const boxesToAdd = daysPassed * dailyGiftSettings.giftsPerDay;
                    dailyGiftSettings.pendingBoxes += boxesToAdd;
                    dailyGiftSettings.lastClaimedDate = Date.now();
                    
                    saveDailyGiftSettings();
                    updateDailyGiftUI();
                    saveGame();
                    
                    if (boxesToAdd > 0) {
                        showSaveIndicator(`M√°≈° ${boxesToAdd} ƒçekaj√≠c√≠ch Daily Box≈Ø! Klikni na Daily Box v headeru pro vyzvednut√≠.`);
                    }
                } else {
                    updateDailyGiftUI();
                }
            }

            // Vyzvednut√≠ ƒçekaj√≠c√≠ch Daily Box≈Ø
            function claimPendingDailyBoxes() {
                if (dailyGiftSettings.pendingBoxes > 0) {
                    if (!gameState.inventory.dailyBox) gameState.inventory.dailyBox = 0;
                    gameState.inventory.dailyBox += dailyGiftSettings.pendingBoxes;
                    
                    const claimedBoxes = dailyGiftSettings.pendingBoxes;
                    dailyGiftSettings.pendingBoxes = 0;
                    
                    updateUI();
                    saveGame();
                    saveDailyGiftSettings();
                    updateDailyGiftUI();
                    
                    showSaveIndicator(`Vyzvedl jsi ${claimedBoxes} Daily Box≈Ø!`);
                    
                    // Znovu vykreslit invent√°≈ô pokud je otev≈ôen√Ω
                    if (inventoryModal.style.display === 'flex') {
                        renderInventory(lastInventoryFilter);
                    }
                } else {
                    showSaveIndicator('Nem√°≈° ≈æ√°dn√© ƒçekaj√≠c√≠ Daily Boxy!', true);
                }
            }

            // Generov√°n√≠ odmƒõny pro Daily Box
            function generateDailyBoxReward() {
                const random = Math.random() * 100;
                
                // 60% ≈°ance na pen√≠ze (m√°lo)
                if (random < 60) {
                    const baseAmount = Math.floor(Math.random() * 100) + 10;
                    const levelBonus = Math.floor(gameState.level * 2);
                    const totalAmount = baseAmount + levelBonus;
                    
                    return {
                        type: 'money',
                        amount: totalAmount,
                        isSpecial: false,
                        message: `Z√≠skal jsi ${totalAmount.toLocaleString()} üí∏`
                    };
                } 
                // 25% ≈°ance na bƒõ≈ænou plodinu
                else if (random < 85) {
                    const availableCrops = crops.filter(crop => crop.unlocked && 
                        (crop.rarity === RARITY.COMMON || crop.rarity === RARITY.UNCOMMON));
                    if (availableCrops.length === 0) {
                        availableCrops.push(crops[0]);
                    }
                    const randomCrop = availableCrops[Math.floor(Math.random() * availableCrops.length)];
                    const quantity = Math.floor(Math.random() * 2) + 1;
                    
                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: false,
                        message: `Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                } 
                // 10% ≈°ance na level up
                else if (random < 95) {
                    const levelUps = 1;
                    
                    return {
                        type: 'level',
                        amount: levelUps,
                        isSpecial: false,
                        message: `Z√≠skal jsi 1 LEVEL UP!`
                    };
                }
                // 5% ≈°ance na event plodinu
                else {
                    const eventCrops = crops.filter(crop => crop.rarity === RARITY.EVENT);
                    if (eventCrops.length > 0) {
                        const randomCrop = eventCrops[Math.floor(Math.random() * eventCrops.length)];
                        const quantity = 1;
                        
                        return {
                            type: 'crop',
                            cropId: randomCrop.id,
                            cropName: randomCrop.name,
                            cropIcon: randomCrop.icon,
                            quantity: quantity,
                            isSpecial: true,
                            message: `SPECI√ÅLN√ç D√ÅREK! Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                        };
                    } else {
                        const baseAmount = Math.floor(Math.random() * 200) + 50;
                        return {
                            type: 'money',
                            amount: baseAmount,
                            isSpecial: false,
                            message: `Z√≠skal jsi ${baseAmount.toLocaleString()} üí∏`
                        };
                    }
                }
            }

            // Generov√°n√≠ odmƒõny pro Common Box
            function generateCommonBoxReward() {
                const random = Math.random() * 100;
                
                // 90% Common
                if (random < 90) {
                    const commonCrops = crops.filter(crop => crop.rarity === RARITY.COMMON);
                    const randomCrop = commonCrops[Math.floor(Math.random() * commonCrops.length)];
                    const quantity = Math.floor(Math.random() * 3) + 1; // 1-3 ks
    
                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: false,
                        message: `Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                }
                // 10% Uncommon
                else {
                    const uncommonCrops = crops.filter(crop => crop.rarity === RARITY.UNCOMMON);
                    const randomCrop = uncommonCrops[Math.floor(Math.random() * uncommonCrops.length)];
                    const quantity = Math.floor(Math.random() * 2) + 1; // 1-2 ks
                    
                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: false,
                        message: `Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                }
            }

            // Generov√°n√≠ odmƒõny pro Uncommon Box
            function generateUncommonBoxReward() {
                const random = Math.random() * 100;
                
                // 80% Uncommon
                if (random < 80) {
                    const uncommonCrops = crops.filter(crop => crop.rarity === RARITY.UNCOMMON);
                    const randomCrop = uncommonCrops[Math.floor(Math.random() * uncommonCrops.length)];
                    const quantity = Math.floor(Math.random() * 3) + 1; // 1-3 ks
    
                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: false,
                        message: `Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                }
                // 10% Common
                else if (random < 90) {
                    const commonCrops = crops.filter(crop => crop.rarity === RARITY.COMMON);
                    const randomCrop = commonCrops[Math.floor(Math.random() * commonCrops.length)];
                    const quantity = Math.floor(Math.random() * 2) + 1; // 1-2 ks
                    
                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: false,
                        message: `Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                }
                // 10% Rare
                else {
                    const rareCrops = crops.filter(crop => crop.rarity === RARITY.RARE);
                    const randomCrop = rareCrops[Math.floor(Math.random() * rareCrops.length)];
                    const quantity = 1; // v≈ædy jen 1
                    
                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: true,
                        message: `VZ√ÅCN√â! Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                }
            }

            // Generov√°n√≠ odmƒõny pro Rare Box
            function generateRareBoxReward() {
                const random = Math.random() * 100;
                
                // 83% Rare
                if (random < 83) {
                    const rareCrops = crops.filter(crop => crop.rarity === RARITY.RARE);
                    const randomCrop = rareCrops[Math.floor(Math.random() * rareCrops.length)];
                    const quantity = Math.floor(Math.random() * 2) + 1; // 1-2 ks
    
                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: true,
                        message: `VZ√ÅCN√â! Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                }
                // 10% Uncommon
                else if (random < 93) {
                    const uncommonCrops = crops.filter(crop => crop.rarity === RARITY.UNCOMMON);
                    const randomCrop = uncommonCrops[Math.floor(Math.random() * uncommonCrops.length)];
                    const quantity = Math.floor(Math.random() * 3) + 1; // 1-3 ks
                    
                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: false,
                        message: `Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                }
                // 5% Common
                else if (random < 98) {
                    const commonCrops = crops.filter(crop => crop.rarity === RARITY.COMMON);
                    const randomCrop = commonCrops[Math.floor(Math.random() * commonCrops.length)];
                    const quantity = Math.floor(Math.random() * 4) + 2; // 2-5 ks
                    
                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: false,
                        message: `Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                }
                // 3% Legendary
                else {
                    const legendaryCrops = crops.filter(crop => crop.rarity === RARITY.LEGENDARY);
                    const randomCrop = legendaryCrops[Math.floor(Math.random() * legendaryCrops.length)];
                    const quantity = 1; // v≈ædy jen 1
                    
                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: true,
                        message: `LEGENDARY! Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                }
            }

            // Generov√°n√≠ odmƒõny pro Legendary Box
            function generateLegendaryBoxReward() {
                const random = Math.random() * 100;
                
                // 85% Legendary
                if (random < 85) {
                    const legendaryCrops = crops.filter(crop => crop.rarity === RARITY.LEGENDARY);
                    const randomCrop = legendaryCrops[Math.floor(Math.random() * legendaryCrops.length)];
                    const quantity = 1; // v≈ædy jen 1
    
                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: true,
                        message: `LEGENDARY! Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                }
                // 10% Rare
                else if (random < 95) {
                    const rareCrops = crops.filter(crop => crop.rarity === RARITY.RARE);
                    const randomCrop = rareCrops[Math.floor(Math.random() * rareCrops.length)];
                    const quantity = Math.floor(Math.random() * 2) + 1; // 1-2 ks
                    
                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: true,
                        message: `VZ√ÅCN√â! Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                }
                // 5% Mythical
                else {
                    const mythicalCrops = crops.filter(crop => crop.rarity === RARITY.MYTHICAL);
                    const randomCrop = mythicalCrops[Math.floor(Math.random() * mythicalCrops.length)];
                    const quantity = 1; // v≈ædy jen 1
                    
                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: true,
                        message: `MYTHICAL! Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                }
            }

            // Generov√°n√≠ odmƒõny pro Mythical Box
            function generateMythicalBoxReward() {
                const random = Math.random() * 100;
                
                // 94% Mythical
                if (random < 94) {
                    const mythicalCrops = crops.filter(crop => crop.rarity === RARITY.MYTHICAL);
                    const randomCrop = mythicalCrops[Math.floor(Math.random() * mythicalCrops.length)];
                    const quantity = 1; // v≈ædy jen 1
    
                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: true,
                        message: `MYTHICAL! Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                }
                // 5% Legendary
                else if (random < 99) {
                    const legendaryCrops = crops.filter(crop => crop.rarity === RARITY.LEGENDARY);
                    const randomCrop = legendaryCrops[Math.floor(Math.random() * legendaryCrops.length)];
                    const quantity = 1; // v≈ædy jen 1
                    
                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: true,
                        message: `LEGENDARY! Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                }
                // 1% Event
                else {
                    const eventCrops = crops.filter(crop => crop.rarity === RARITY.EVENT);
                    const randomCrop = eventCrops[Math.floor(Math.random() * eventCrops.length)];
                    const quantity = 1; // v≈ædy jen 1
                    
                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: true,
                        message: `EVENT! Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                }
            }

            // Generov√°n√≠ odmƒõny pro Event Box
            function generateEventBoxReward() {
                const random = Math.random() * 100;
                
                // 60% Event
                if (random < 60) {
                    const eventCrops = crops.filter(crop => crop.rarity === RARITY.EVENT);
                    const randomCrop = eventCrops[Math.floor(Math.random() * eventCrops.length)];
                    const quantity = 1; // v≈ædy jen 1

                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: true,
                        message: `EVENT! Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                }
                // 20% Mythical
                else if (random < 80) {
                    const mythicalCrops = crops.filter(crop => crop.rarity === RARITY.MYTHICAL);
                    const randomCrop = mythicalCrops[Math.floor(Math.random() * mythicalCrops.length)];
                    const quantity = 1; // v≈ædy jen 1

                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: true,
                        message: `MYTHICAL! Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                }
                // 15% Legendary
                else if (random < 95) {
                    const legendaryCrops = crops.filter(crop => crop.rarity === RARITY.LEGENDARY);
                    const randomCrop = legendaryCrops[Math.floor(Math.random() * legendaryCrops.length)];
                    const quantity = 1; // v≈ædy jen 1

                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: true,
                        message: `LEGENDARY! Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                }
                // 5% Rare
                else {
                    const rareCrops = crops.filter(crop => crop.rarity === RARITY.RARE);
                    const randomCrop = rareCrops[Math.floor(Math.random() * rareCrops.length)];
                    const quantity = Math.floor(Math.random() * 2) + 1; // 1-2 ks

                    return {
                        type: 'crop',
                        cropId: randomCrop.id,
                        cropName: randomCrop.name,
                        cropIcon: randomCrop.icon,
                        quantity: quantity,
                        isSpecial: true,
                        message: `VZ√ÅCN√â! Z√≠skal jsi ${quantity}x ${randomCrop.name}`
                    };
                }
            }

            // Aplikov√°n√≠ odmƒõny
            function applyReward(reward) {
                switch (reward.type) {
                    case 'crop':
                        if (!gameState.inventory[reward.cropId]) {
                            gameState.inventory[reward.cropId] = 0;
                        }
                        gameState.inventory[reward.cropId] += reward.quantity;
                        
                        const crop = crops.find(c => c.id === reward.cropId);
                        if (crop && !crop.unlocked) {
                            crop.unlocked = true;
                        }
                        break;
                        
                    case 'money':
                        gameState.money += reward.amount;
                        break;
                        
                    case 'level':
                        for (let i = 0; i < reward.amount; i++) {
                            gameState.level++;
                            gameState.xp = 0;
                        }
                        break;
                }
                
                // Pokud je aktivn√≠ sd√≠len√Ω invent√°≈ô, ulo≈æit odmƒõnu i do nƒõj
                if (sharedInventory.enabled && reward.type === 'crop') {
                    if (!sharedInventory.items[reward.cropId]) {
                        sharedInventory.items[reward.cropId] = 0;
                    }
                    sharedInventory.items[reward.cropId] += reward.quantity;
                    saveSharedInventory();
                }
            }

            // Otev≈ôen√≠ boxu
            function openBox(boxType) {
                if (!gameState.inventory[boxType] || gameState.inventory[boxType] <= 0) {
                    showSaveIndicator('Nem√°≈° tento box!', true);
                    return;
                }
                
                gameState.inventory[boxType]--;
                
                let reward;
                let boxTitle;
                
                switch(boxType) {
                    case 'commonBox':
                        reward = generateCommonBoxReward();
                        boxTitle = 'Common Box';
                        break;
                    case 'uncommonBox':
                        reward = generateUncommonBoxReward();
                        boxTitle = 'Uncommon Box';
                        break;
                    case 'rareBox':
                        reward = generateRareBoxReward();
                        boxTitle = 'Rare Box';
                        break;
                    case 'legendaryBox':
                        reward = generateLegendaryBoxReward();
                        boxTitle = 'Legendary Box';
                        break;
                    case 'mythicalBox':
                        reward = generateMythicalBoxReward();
                        boxTitle = 'Mythical Box';
                        break;
                    case 'eventBox':
                        reward = generateEventBoxReward();
                        boxTitle = 'Event Box';
                        break;
                    case 'dailyBox':
                        reward = generateDailyBoxReward();
                        boxTitle = 'Daily Box';
                        break;
                    default:
                        reward = generateCommonBoxReward();
                        boxTitle = 'Box';
                }
                
                applyReward(reward);
                
                // Zobrazen√≠ odmƒõny
                document.getElementById('box-title').innerHTML = `<i class="fas fa-gift"></i> ${boxTitle}`;
                document.getElementById('box-reward').textContent = reward.type === 'crop' ? reward.cropIcon : 
                    reward.type === 'money' ? 'üí∞' : '‚≠ê';
                document.getElementById('box-message').textContent = reward.message;
                document.getElementById('box-details').textContent = reward.type === 'crop' ? 
                    `${reward.quantity}x ${reward.cropName}` : 
                    reward.type === 'money' ? `${reward.amount} üí∏` : `${reward.amount} level≈Ø`;
                
                openBoxModal.style.display = 'flex';
                updateUI();
                saveGame();
                checkUnlocks();
            }

            // Koupit box
            function buyBox(boxType) {
                const box = BOX_TYPES[boxType];
                
                if (gameState.money >= box.cost) {
                    gameState.money -= box.cost;
                    if (!gameState.inventory[boxType]) gameState.inventory[boxType] = 0;
                    gameState.inventory[boxType]++;
                    
                    updateUI();
                    saveGame();
                    showSaveIndicator(`Zakoupen ${box.name} za ${box.cost.toLocaleString()} üí∏!`);
                    
                    // Zav≈ô√≠t modal obchodu
                    boxShopModal.style.display = 'none';
                } else {
                    showSaveIndicator(`Nem√°≈° dostatek üí∏! Pot≈ôebuje≈° ${box.cost.toLocaleString()}`, true);
                }
            }

            // Zobrazen√≠ obchodu s boxy
            function renderBoxShop() {
                boxShopItemsElement.innerHTML = '';
                
                Object.keys(BOX_TYPES).forEach(boxType => {
                    const box = BOX_TYPES[boxType];
                    // Skr√Ωt dailyBox z obchodu (ten je jen jako denn√≠ odmƒõna)
                    if (boxType === 'dailyBox') return;
                    
                    const canAfford = gameState.money >= box.cost;
                    
                    let rewardsInfo = '';
                    switch(boxType) {
                        case 'commonBox':
                            rewardsInfo = '90% Common, 10% Uncommon plodiny';
                            break;
                        case 'uncommonBox':
                            rewardsInfo = '80% Uncommon, 10% Common, 10% Rare';
                            break;
                        case 'rareBox':
                            rewardsInfo = '83% Rare, 10% Uncommon, 5% Common, 3% Legendary';
                            break;
                        case 'legendaryBox':
                            rewardsInfo = '85% Legendary, 10% Rare, 5% Mythical';
                            break;
                        case 'mythicalBox':
                            rewardsInfo = '94% Mythical, 5% Legendary, 1% Event';
                            break;
                        case 'eventBox':
                            rewardsInfo = '60% Event, 20% Mythical, 15% Legendary, 5% Rare';
                            break;
                        case 'dailyBox':
                            rewardsInfo = 'R≈Øzn√© odmƒõny - pen√≠ze, plodiny, levely, event plodiny';
                            break;
                    }
                    
                    const itemElement = document.createElement('div');
                    itemElement.className = 'box-shop-item';
                    
                    itemElement.innerHTML = `
                        <div class="box-shop-icon">${box.icon}</div>
                        <div class="box-shop-name">${box.name}</div>
                        <div class="box-shop-description">${box.description}</div>
                        <div class="box-shop-rewards">${rewardsInfo}</div>
                        <div class="box-shop-cost">${box.cost > 0 ? `${box.cost.toLocaleString()} <span>üí∏</span>` : 'ZDARMA (denn√≠ odmƒõna)'}</div>
                        ${box.cost > 0 ? `<button class="buy-box-button" style="margin-top: 10px; background: #4caf50;" ${!canAfford ? 'disabled' : ''}>
                            Koupit
                        </button>` : ''}
                    `;
                    
                    if (box.cost > 0) {
                        const buyButton = itemElement.querySelector('.buy-box-button');
                        buyButton.addEventListener('click', () => {
                            buyBox(boxType);
                        });
                    }
                    
                    boxShopItemsElement.appendChild(itemElement);
                });
            }

            // Zobrazen√≠ invent√°≈ôe
            function renderInventory(filter = lastInventoryFilter) {
                inventoryItemsElement.innerHTML = '';
                
                // Ulo≈æit aktu√°ln√≠ filtr
                saveLastInventoryFilter(filter);
                
                // Filtry
                document.querySelectorAll('.inventory-filter').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`.inventory-filter[data-filter="${filter}"]`).classList.add('active');
                
                let hasItems = false;
                
                // V≈†E
                if (filter === 'all') {
                    // Zobrazit boxy
                    Object.keys(BOX_TYPES).forEach(boxType => {
                        if (gameState.inventory[boxType] > 0) {
                            hasItems = true;
                            const boxElement = createBoxElement(boxType, gameState.inventory[boxType]);
                            inventoryItemsElement.appendChild(boxElement);
                        }
                    });
                    
                    // Zobrazit plodiny
                    Object.keys(gameState.inventory).forEach(key => {
                        const quantity = gameState.inventory[key];
                        
                        // P≈ôeskoƒçit boxy (u≈æ jsou zobrazeny)
                        if (Object.keys(BOX_TYPES).includes(key)) return;
                        
                        if (quantity > 0) {
                            const cropId = parseInt(key);
                            const crop = crops.find(c => c.id === cropId);
                            
                            if (!crop) return;
                            
                            hasItems = true;
                            
                            const itemElement = document.createElement('div');
                            itemElement.className = 'inventory-item';
                            
                            const isFavorited = gameState.favoriteCrops.includes(cropId);
                            const rarityClass = `rarity-${crop.rarity}`;
                            const rarityBadgeClass = `rarity-badge ${crop.rarity}`;
                            const rarityText = getRarityText(crop.rarity);
                            
                            itemElement.innerHTML = `
                                <div class="inventory-item-info">
                                    <div class="inventory-icon">${crop.icon} ${isFavorited ? '‚≠ê' : ''}</div>
                                    <div class="inventory-details">
                                        <div class="inventory-name ${rarityClass}">${crop.name}</div>
                                        <div class="inventory-description">Mno≈æstv√≠: ${quantity}</div>
                                        <div class="${rarityBadgeClass}">${rarityText}</div>
                                    </div>
                                </div>
                                <div class="inventory-actions">
                                    <button class="favorite-button" style="background: #2196f3;">${isFavorited ? 'Odebrat z obl√≠ben√Ωch' : 'P≈ôidat do obl√≠ben√Ωch'}</button>
                                </div>
                            `;
                            
                            const favoriteButton = itemElement.querySelector('.favorite-button');
                            
                            favoriteButton.addEventListener('click', () => {
                                toggleFavoriteCrop(cropId);
                                renderInventory(filter);
                            });
                            
                            inventoryItemsElement.appendChild(itemElement);
                        }
                    });
                }
                
                // OBL√çBEN√â
                else if (filter === 'favorites') {
                    gameState.favoriteCrops.forEach(cropId => {
                        const quantity = gameState.inventory[cropId] || 0;
                        
                        if (quantity > 0) {
                            const crop = crops.find(c => c.id === cropId);
                            if (!crop) return;
                            
                            hasItems = true;
                            
                            const itemElement = document.createElement('div');
                            itemElement.className = 'inventory-item';
                            
                            const rarityClass = `rarity-${crop.rarity}`;
                            const rarityBadgeClass = `rarity-badge ${crop.rarity}`;
                            const rarityText = getRarityText(crop.rarity);
                            
                            itemElement.innerHTML = `
                                <div class="inventory-item-info">
                                    <div class="inventory-icon">${crop.icon} ‚≠ê</div>
                                    <div class="inventory-details">
                                        <div class="inventory-name ${rarityClass}">${crop.name}</div>
                                        <div class="inventory-description">Mno≈æstv√≠: ${quantity}</div>
                                        <div class="${rarityBadgeClass}">${rarityText}</div>
                                    </div>
                                </div>
                                <div class="inventory-actions">
                                    <button class="unfavorite-button" style="background: #ff9800;">Odebrat z obl√≠ben√Ωch</button>
                                </div>
                            `;
                            
                            const unfavoriteButton = itemElement.querySelector('.unfavorite-button');
                            
                            unfavoriteButton.addEventListener('click', () => {
                                toggleFavoriteCrop(cropId);
                                renderInventory(filter);
                            });
                            
                            inventoryItemsElement.appendChild(itemElement);
                        }
                    });
                }
                
                // TR≈ΩI≈†Tƒö
                else if (filter === 'market') {
                    Object.keys(gameState.inventory).forEach(key => {
                        const quantity = gameState.inventory[key];
                        
                        // P≈ôeskoƒçit boxy v re≈æimu TR≈ΩI≈†Tƒö
                        if (Object.keys(BOX_TYPES).includes(key)) return;
                        
                        if (quantity > 0) {
                            const cropId = parseInt(key);
                            const crop = crops.find(c => c.id === cropId);
                            
                            if (!crop) return;
                            
                            // P≈ôeskoƒçit obl√≠ben√© plodiny
                            if (gameState.favoriteCrops.includes(cropId)) {
                                return;
                            }
                            
                            hasItems = true;
                            
                            const sellPrice = Math.round(crop.sellPrice * gameState.sellMultiplier);
                            const totalPrice = sellPrice * quantity;
                            const rarityClass = `rarity-${crop.rarity}`;
                            const rarityBadgeClass = `rarity-badge ${crop.rarity}`;
                            const rarityText = getRarityText(crop.rarity);
                            
                            const itemElement = document.createElement('div');
                            itemElement.className = 'inventory-item';
                            
                            itemElement.innerHTML = `
                                <div class="inventory-item-info">
                                    <div class="inventory-icon">${crop.icon}</div>
                                    <div class="inventory-details">
                                        <div class="inventory-name ${rarityClass}">${crop.name}</div>
                                        <div class="inventory-description">Mno≈æstv√≠: ${quantity} | Cena: ${sellPrice} za kus</div>
                                        <div class="${rarityBadgeClass}">${rarityText}</div>
                                    </div>
                                </div>
                                <div class="inventory-actions">
                                    <button class="sell-button" style="background: #4caf50;">Prodat v≈°echny (${totalPrice} üí∏)</button>
                                    <button class="sell-one-button" style="background: #2196f3;">Prodat 1 (${sellPrice} üí∏)</button>
                                </div>
                            `;
                            
                            const sellButton = itemElement.querySelector('.sell-button');
                            const sellOneButton = itemElement.querySelector('.sell-one-button');
                            
                            sellButton.addEventListener('click', () => {
                                const totalSellPrice = sellPrice * quantity;
                                gameState.money += totalSellPrice;
                                delete gameState.inventory[key];
                                updateUI();
                                renderInventory(filter);
                                showSaveIndicator(`Prod√°no: ${quantity}x ${crop.name} za ${totalSellPrice.toLocaleString()} üí∏`);
                                saveGame();
                            });
                            
                            sellOneButton.addEventListener('click', () => {
                                if (quantity > 1) {
                                    gameState.inventory[key] = quantity - 1;
                                    gameState.money += sellPrice;
                                    showSaveIndicator(`Prod√°no: 1x ${crop.name} za ${sellPrice} üí∏`);
                                } else {
                                    gameState.money += sellPrice;
                                    delete gameState.inventory[key];
                                    showSaveIndicator(`Prod√°no: 1x ${crop.name} za ${sellPrice} üí∏`);
                                }
                                updateUI();
                                renderInventory(filter);
                                saveGame();
                            });
                            
                            inventoryItemsElement.appendChild(itemElement);
                        }
                    });
                }
                
                // BOXY
                else if (filter === 'boxes') {
                    Object.keys(BOX_TYPES).forEach(boxType => {
                        if (gameState.inventory[boxType] > 0) {
                            hasItems = true;
                            const boxElement = createBoxElement(boxType, gameState.inventory[boxType]);
                            inventoryItemsElement.appendChild(boxElement);
                        }
                    });
                    
                    if (!hasItems) {
                        inventoryItemsElement.innerHTML = '<p style="text-align: center; padding: 20px;">Nem√°≈° ≈æ√°dn√© boxy. Nav≈°tiv Obchod s boxy!</p>';
                    }
                }
                
                if (!hasItems && filter !== 'boxes') {
                    let message = '';
                    if (filter === 'all') message = 'Invent√°≈ô je pr√°zdn√Ω.';
                    else if (filter === 'favorites') message = 'Nem√°≈° ≈æ√°dn√© obl√≠ben√© polo≈æky.';
                    else if (filter === 'market') message = 'Nem√°≈° ≈æ√°dn√© polo≈æky k prodeji.';
                    
                    inventoryItemsElement.innerHTML = `<p style="text-align: center; padding: 20px;">${message}</p>`;
                }
            }

            // Z√≠sk√°n√≠ textu pro rarity
            function getRarityText(rarity) {
                switch(rarity) {
                    case RARITY.COMMON: return 'COMMON';
                    case RARITY.UNCOMMON: return 'UNCOMMON';
                    case RARITY.RARE: return 'RARE';
                    case RARITY.LEGENDARY: return 'LEGENDARY';
                    case RARITY.MYTHICAL: return 'MYTHICAL';
                    case RARITY.EVENT: return 'EVENT';
                    default: return 'COMMON';
                }
            }

            // Vytvo≈ôen√≠ elementu boxu
            function createBoxElement(boxType, count) {
                const box = BOX_TYPES[boxType];
                const element = document.createElement('div');
                element.className = 'box-item';
                
                element.innerHTML = `
                    <div class="box-icon">${box.icon}</div>
                    <div class="box-name">${box.name}</div>
                    <div class="box-description">${box.description}</div>
                    <div class="box-count">M√°≈°: ${count}</div>
                    <button class="open-box-button" style="margin-top: 10px; background: #ff9800;">Otev≈ô√≠t</button>
                `;
                
                const openButton = element.querySelector('.open-box-button');
                openButton.addEventListener('click', () => {
                    openBox(boxType);
                    // Z≈Østat ve stejn√© sekci po otev≈ôen√≠ boxu
                    setTimeout(() => {
                        renderInventory(lastInventoryFilter);
                    }, 100);
                });
                
                return element;
            }

            // Vykreslen√≠ profil≈Ø
            function renderProfiles() {
                profilesElement.innerHTML = '';
                
                for (let i = 1; i <= MAX_PROFILES; i++) {
                    const isActive = gameState.currentProfile === i;
                    const isUnlocked = true; // V≈ædy odemƒçeno - pouze 3 profily
                    const profileKey = SAVE_KEY_PREFIX + i;
                    const savedGame = localStorage.getItem(profileKey);
                    
                    let profileInfo = 'Pr√°zdn√Ω profil';
                    if (savedGame) {
                        try {
                            const gameData = JSON.parse(savedGame);
                            profileInfo = `Level ${gameData.level}, ${gameData.money.toLocaleString()} üí∏`;
                        } catch (e) {
                            profileInfo = 'Po≈°kozen√Ω profil';
                        }
                    }
                    
                    const profileElement = document.createElement('div');
                    profileElement.className = `profile-item ${isActive ? 'active' : ''}`;
                    profileElement.dataset.profile = i;
                    
                    profileElement.innerHTML = `
                        <div class="profile-icon"><i class="fas fa-user"></i></div>
                        <div class="profile-name">${profileNames[i-1]}</div>
                        <div class="profile-info">${profileInfo}</div>
                        ${isActive ? '<div style="color: #4caf50; font-weight: bold; margin-top: 5px; font-size: 0.7rem;">AKTIVN√ç</div>' : ''}
                        <div class="profile-actions">
                            ${!isActive ? '<button class="switch-profile" style="background: #4caf50;">P≈ôepnout</button>' : ''}
                            ${savedGame ? '<button class="rename-profile rename-profile-btn">P≈ôejmenovat</button>' : ''}
                            ${savedGame && !isActive ? '<button class="delete-profile delete-profile-btn">Smazat</button>' : ''}
                        </div>
                    `;
                    
                    const switchButton = profileElement.querySelector('.switch-profile');
                    const renameButton = profileElement.querySelector('.rename-profile-btn');
                    const deleteButton = profileElement.querySelector('.delete-profile-btn');
                    
                    if (switchButton) {
                        switchButton.addEventListener('click', (e) => {
                            e.stopPropagation();
                            switchProfile(i);
                        });
                    }
                    
                    if (renameButton) {
                        renameButton.addEventListener('click', (e) => {
                            e.stopPropagation();
                            openRenameProfileModal(i);
                        });
                    }
                    
                    if (deleteButton) {
                        deleteButton.addEventListener('click', (e) => {
                            e.stopPropagation();
                            deleteProfile(i);
                        });
                    }
                    
                    profileElement.addEventListener('click', () => {
                        if (!isActive) {
                            switchProfile(i);
                        }
                    });
                    
                    profilesElement.appendChild(profileElement);
                }
            }

            // P≈ôepnut√≠ profilu
            function switchProfile(profileId) {
                if (profileId === gameState.currentProfile) return;
                
                // Ulo≈æit aktu√°ln√≠ hru
                saveGame();
                
                // Naƒç√≠st nov√Ω profil
                gameState.currentProfile = profileId;
                loadGame();
                
                updateUI();
                renderFarm();
                renderCrops();
                renderAnimals();
                renderProfiles();
                updateSeason();
                checkUnlocks();
                updateDailyGiftUI();
                
                showSaveIndicator(`P≈ôepnuto na ${profileNames[profileId-1]}`);
            }

            // Smazat profil
            function deleteProfile(profileId) {
                if (profileId === gameState.currentProfile) {
                    showSaveIndicator('Nem≈Ø≈æe≈° smazat aktu√°lnƒõ aktivn√≠ profil!', true);
                    return;
                }
                
                if (confirm(`Opravdu chce≈° smazat profil "${profileNames[profileId-1]}"? Tato akce je nevratn√°!`)) {
                    localStorage.removeItem(SAVE_KEY_PREFIX + profileId);
                    
                    renderProfiles();
                    showSaveIndicator(`Profil ${profileNames[profileId-1]} byl smaz√°n.`);
                }
            }

            // Otev≈ôen√≠ modalu pro p≈ôejmenov√°n√≠ profilu
            function openRenameProfileModal(profileId) {
                profileToRename = profileId;
                profileNameInput.value = profileNames[profileId-1];
                renameProfileModal.style.display = 'flex';
            }

            // P≈ôejmenov√°n√≠ profilu
            function renameProfile() {
                if (!profileToRename) return;
                
                const newName = profileNameInput.value.trim();
                if (!newName) {
                    showSaveIndicator('Jm√©no profilu nem≈Ø≈æe b√Ωt pr√°zdn√©!', true);
                    return;
                }
                
                if (newName.length > 20) {
                    showSaveIndicator('Jm√©no profilu je p≈ô√≠li≈° dlouh√©!', true);
                    return;
                }
                
                // Aktualizovat jm√©no
                profileNames[profileToRename-1] = newName;
                saveProfileNames();
                
                renderProfiles();
                renameProfileModal.style.display = 'none';
                showSaveIndicator(`Profil p≈ôejmenov√°n na "${newName}"`);
                
                profileToRename = null;
            }

            // Aktualizace UI pro daily gifts
            function updateDailyGiftUI() {
                const pendingBoxes = dailyGiftSettings.pendingBoxes;
                
                if (pendingBoxes > 0) {
                    giftStatusElement.textContent = `ƒåek√° ${pendingBoxes} Daily Box≈Ø! (Klikni pro vyzvednut√≠)`;
                    dailyGiftInfoElement.style.background = '#fff3e0';
                    dailyGiftInfoElement.style.borderColor = '#ffb300';
                    dailyGiftInfoElement.style.cursor = 'pointer';
                    
                    // P≈ôidat event listener pro kliknut√≠
                    dailyGiftInfoElement.onclick = claimPendingDailyBoxes;
                } else {
                    const today = new Date().toDateString();
                    const lastClaimed = dailyGiftSettings.lastClaimedDate ? 
                        new Date(dailyGiftSettings.lastClaimedDate).toDateString() : null;
                    
                    if (lastClaimed === today) {
                        giftStatusElement.textContent = 'Dnes ji≈æ z√≠sk√°no!';
                        dailyGiftInfoElement.style.background = '#e8f5e9';
                        dailyGiftInfoElement.style.borderColor = '#4caf50';
                    } else {
                        giftStatusElement.textContent = 'Dnes dostupn√Ω!';
                        dailyGiftInfoElement.style.background = '#fff3e0';
                        dailyGiftInfoElement.style.borderColor = '#ffb300';
                    }
                    dailyGiftInfoElement.onclick = null;
                    dailyGiftInfoElement.style.cursor = 'default';
                }
                
                if (document.body.classList.contains('dark-mode')) {
                    if (pendingBoxes > 0) {
                        dailyGiftInfoElement.style.background = '#5d4037';
                    } else {
                        const today = new Date().toDateString();
                        const lastClaimed = dailyGiftSettings.lastClaimedDate ? 
                            new Date(dailyGiftSettings.lastClaimedDate).toDateString() : null;
                        
                        if (lastClaimed === today) {
                            dailyGiftInfoElement.style.background = '#2d4a2d';
                        } else {
                            dailyGiftInfoElement.style.background = '#5d4037';
                        }
                    }
                }
            }

            // Aktualizace upozornƒõn√≠ na sd√≠len√Ω invent√°≈ô
            function updateSharedInventoryNotice() {
                if (sharedInventory.enabled) {
                    sharedInventoryNotice.style.display = 'block';
                } else {
                    sharedInventoryNotice.style.display = 'none';
                }
            }

            // Spu≈°tƒõn√≠ ƒçasovaƒçe
            function startDayTimer() {
                clearInterval(dayTimer);
                
                dayTimerRemaining = DAY_TIMER_DURATION;
                dayTimerEndTime = Date.now() + DAY_TIMER_DURATION;
                
                updateTimerButton();
                nextDayTimerButton.disabled = true;
                
                dayTimer = setInterval(updateTimer, 100);
            }

            // Aktualizace ƒçasovaƒçe
            function updateTimer() {
                const now = Date.now();
                dayTimerRemaining = Math.max(0, dayTimerEndTime - now);
                
                updateTimerButton();
                
                if (dayTimerRemaining <= 0) {
                    clearInterval(dayTimer);
                    nextDayTimerButton.disabled = false;
                    timerTextElement.textContent = 'Dal≈°√≠ Den';
                    
                    nextDayTimerButton.onclick = () => {
                        nextDay();
                        startDayTimer();
                        showSaveIndicator('Manu√°lnƒõ ubƒõhl den!');
                    };
                }
            }

            // Aktualizace tlaƒç√≠tka ƒçasovaƒçe
            function updateTimerButton() {
                if (dayTimerRemaining > 0) {
                    const seconds = Math.ceil(dayTimerRemaining / 1000);
                    timerTextElement.textContent = `Dal≈°√≠ Den (${seconds}s)`;
                    
                    const progress = 100 - (dayTimerRemaining / DAY_TIMER_DURATION * 100);
                    nextDayTimerButton.style.background = `linear-gradient(90deg, #ff9800 ${progress}%, #f57c00 ${progress}%)`;
                } else {
                    timerTextElement.textContent = 'Dal≈°√≠ Den';
                    nextDayTimerButton.style.background = 'linear-gradient(135deg, #ff9800, #f57c00)';
                }
            }

            // Z√≠sk√°n√≠ aktu√°ln√≠ho roƒçn√≠ho obdob√≠
            function getCurrentRealSeason() {
                const now = new Date();
                const month = now.getMonth();
                return REAL_SEASONS[month];
            }

            // Aktualizace roƒçn√≠ho obdob√≠
            function updateSeason() {
                const season = getCurrentRealSeason();
                gameState.currentSeason = season;
                seasonElement.textContent = season.name;
                seasonElement.className = `season-indicator ${season.class}`;
                seasonIconElement.textContent = season.icon;
            }

            // Vykreslen√≠ farmy
            function renderFarm() {
                farmElement.innerHTML = '';
                for (let i = 0; i < gameState.farmSize; i++) {
                    const plot = document.createElement('div');
                    plot.className = `plot ${gameState.farm[i]?.state || 'empty'}`;
                    plot.dataset.index = i;
                    
                    if (gameState.farm[i]?.state === 'empty') {
                        plot.innerHTML = '<i class="fas fa-seedling"></i>';
                    } else if (gameState.farm[i]?.state === 'planted') {
                        const crop = crops.find(c => c.id === gameState.farm[i].cropId);
                        plot.innerHTML = `
                            <div>${crop?.icon || 'üå±'}</div>
                            <div class="progress-bar">
                                <div class="progress" style="width: ${gameState.farm[i].progress}%"></div>
                            </div>
                        `;
                    } else if (gameState.farm[i]?.state === 'ready') {
                        const crop = crops.find(c => c.id === gameState.farm[i].cropId);
                        plot.innerHTML = `<div>${crop?.icon || 'üå±'}</div><small>SKLIDIT</small>`;
                    } else if (gameState.farm[i]?.state === 'withered') {
                        plot.innerHTML = '<div>üåµ</div><small>USCHL√â</small>';
                    }
                    
                    plot.addEventListener('click', () => handlePlotClick(i));
                    farmElement.appendChild(plot);
                }
            }

            // Kliknut√≠ na pole
            function handlePlotClick(index) {
                const plot = gameState.farm[index];
                
                if (plot.state === 'empty' && gameState.selectedCrop) {
                    const crop = crops.find(c => c.id === gameState.selectedCrop);
                    
                    if (crop.rarity === RARITY.EVENT && crop.id === 50) {
                        // Lebka nem√° ≈æ√°dn√Ω limit n√°kupu
                    }
                    
                    if (gameState.money >= crop.cost) {
                        gameState.money -= crop.cost;
                        plot.state = 'planted';
                        plot.cropId = crop.id;
                        plot.progress = 0;
                        
                        if (crop.rarity === RARITY.EVENT) {
                            gameState.eventSeedsPlanted++;
                            gameState.eventSeedsBought++;
                        }
                        
                        const baseGrowTime = crop.growTime;
                        const seasonMultiplier = gameState.currentSeason.multiplier;
                        const upgradeMultiplier = gameState.growthMultiplier;
                        const totalMultiplier = seasonMultiplier * upgradeMultiplier;
                        
                        const hasMagicalSoil = gameState.upgrades.includes(15);
                        
                        if (crop.rarity === RARITY.EVENT) {
                            plot.growTime = Math.max(1, Math.round(baseGrowTime / totalMultiplier));
                        } else if (hasMagicalSoil) {
                            plot.growTime = 1;
                            plot.progress = 99;
                        } else {
                            plot.growTime = Math.max(1, Math.round(baseGrowTime / totalMultiplier));
                        }
                        
                        plot.daysPlanted = gameState.day;
                        
                        updateUI();
                        renderFarm();
                        renderCrops();
                        showSaveIndicator(`Vysazeno: ${crop.name}`);
                        saveGame();
                    } else {
                        showSaveIndicator('Nem√°≈° dostatek penƒõz!', true);
                    }
                } else if (plot.state === 'ready') {
                    const crop = crops.find(c => c.id === plot.cropId);
                    if (crop) {
                        if (!gameState.inventory[crop.id]) {
                            gameState.inventory[crop.id] = 0;
                        }
                        gameState.inventory[crop.id]++;
                        
                        // Pokud je aktivn√≠ sd√≠len√Ω invent√°≈ô, ulo≈æit i do nƒõj
                        if (sharedInventory.enabled) {
                            if (!sharedInventory.items[crop.id]) {
                                sharedInventory.items[crop.id] = 0;
                            }
                            sharedInventory.items[crop.id]++;
                            saveSharedInventory();
                        }
                        
                        addXP(crop.xp);
                        
                        if (crop.rarity === RARITY.EVENT) {
                            gameState.eventSeedsPlanted--;
                        }
                        
                        plot.state = 'empty';
                        plot.progress = 0;
                        delete plot.cropId;
                        
                        updateUI();
                        renderFarm();
                        showSaveIndicator(`Sklizeno: ${crop.name}`);
                        saveGame();
                    }
                } else if (plot.state === 'withered') {
                    const crop = crops.find(c => c.id === plot.cropId);
                    
                    if (crop && crop.rarity === RARITY.EVENT) {
                        gameState.eventSeedsPlanted--;
                    }
                    
                    plot.state = 'empty';
                    plot.progress = 0;
                    delete plot.cropId;
                    updateUI();
                    renderFarm();
                    showSaveIndicator('Uschl√° plodina odstranƒõna');
                    saveGame();
                }
            }

            // P≈ôechod na dal≈°√≠ den
            function nextDay() {
                gameState.day++;
                gameState.lastAutoDay = Date.now();
                
                if (gameState.day % 30 === 0) {
                    updateSeason();
                }
                
                let anyGrowth = false;
                gameState.farm.forEach(plot => {
                    if (plot.state === 'planted') {
                        const crop = crops.find(c => c.id === plot.cropId);
                        if (crop) {
                            const hasMagicalSoil = gameState.upgrades.includes(15);
                            
                            if (crop.rarity === RARITY.EVENT) {
                                const baseGrowthRate = 100 / plot.growTime;
                                const seasonMultiplier = gameState.currentSeason.multiplier;
                                const upgradeMultiplier = gameState.growthMultiplier;
                                const totalMultiplier = seasonMultiplier * upgradeMultiplier;
                                const growthRate = baseGrowthRate * totalMultiplier;
                                
                                plot.progress += growthRate;
                            } else if (hasMagicalSoil) {
                                plot.progress = 100;
                                plot.state = 'ready';
                                anyGrowth = true;
                            } else {
                                const baseGrowthRate = 100 / plot.growTime;
                                const seasonMultiplier = gameState.currentSeason.multiplier;
                                const upgradeMultiplier = gameState.growthMultiplier;
                                const totalMultiplier = seasonMultiplier * upgradeMultiplier;
                                const growthRate = baseGrowthRate * totalMultiplier;
                                
                                plot.progress += growthRate;
                            }
                            
                            if (plot.progress >= 100) {
                                plot.state = 'ready';
                                plot.progress = 100;
                            }
                            
                            if (plot.state === 'ready' && gameState.day - plot.daysPlanted > plot.growTime + 3) {
                                plot.state = 'withered';
                            }
                            
                            anyGrowth = true;
                        }
                    }
                });
                
                collectIncome();
                
                updateUI();
                renderFarm();
                
                autoSave();
            }

            // P≈ôid√°n√≠ XP
            function addXP(amount) {
                gameState.xp += amount;
                const xpNeeded = gameState.level * 100;
                
                if (gameState.xp >= xpNeeded) {
                    gameState.level++;
                    gameState.xp = gameState.xp - xpNeeded;
                    showLevelUpModal();
                }
                
                updateUI();
                checkUnlocks();
            }

            // Zobrazen√≠ modalu pro level up
            function showLevelUpModal() {
                const newLevelElement = document.getElementById('new-level');
                const benefitsElement = document.getElementById('level-up-benefits');
                
                newLevelElement.textContent = gameState.level;
                
                let benefits = '';
                if (gameState.level === 2) {
                    benefits = 'Odemkl jsi brambory a kr√°l√≠ky!';
                } else if (gameState.level === 3) {
                    benefits = 'Odemkl jsi kuku≈ôici a ovce!';
                } else if (gameState.level === 4) {
                    benefits = 'Odemkl jsi jahody a kozy!';
                } else if (gameState.level === 5) {
                    benefits = 'Odemkl jsi d√Ωnƒõ a kr√°vu!';
                } else if (gameState.level === 6) {
                    benefits = 'Odemkl jsi brokolici a prase!';
                } else if (gameState.level === 7) {
                    benefits = 'Odemkl jsi papriky a konƒõ!';
                } else if (gameState.level === 8) {
                    benefits = 'Odemkl jsi meloun a velblouda!';
                } else if (gameState.level === 9) {
                    benefits = 'Odemkl jsi ananas a slona!';
                } else if (gameState.level === 10) {
                    benefits = 'Odemkl jsi draƒç√≠ ovoce a jednoro≈æce!';
                } else if (gameState.level === 12) {
                    benefits = 'Odemkl jsi zlatou ≈ôepu a f√©nixa!';
                } else if (gameState.level === 15) {
                    benefits = 'Odemkl jsi k≈ôi≈°≈•√°lov√© jablko a draka!';
                } else if (gameState.level === 50) {
                    benefits = 'Odemkl jsi zlatou slepici a mandarinku!';
                } else if (gameState.level === 100) {
                    benefits = 'Odemkl jsi zlat√©ho kr√°l√≠ka a kiwi!';
                } else if (gameState.level === 150) {
                    benefits = 'Odemkl jsi zlatou ovci a mango!';
                } else if (gameState.level === 200) {
                    benefits = 'Odemkl jsi MAGICK√â SEM√çNKO a zlatou kozu!';
                } else if (gameState.level === 300) {
                    benefits = 'Odemkl jsi ZLATOU MRKEV!';
                } else if (gameState.level === 400) {
                    benefits = 'Odemkl jsi ZLAT√â BRAMBORY!';
                } else {
                    benefits = 'Z√≠sk√°v√°≈° bonusov√© pen√≠ze a nov√© mo≈ænosti!';
                }
                
                benefitsElement.textContent = benefits;
                levelUpModal.style.display = 'flex';
            }

            // Kontrola odemƒçen√≠ plodin a zv√≠≈ôat
            function checkUnlocks() {
                crops.forEach(crop => {
                    crop.unlocked = gameState.level >= crop.unlockLevel;
                });
                
                animals.forEach(animal => {
                    animal.unlocked = gameState.level >= animal.unlockLevel;
                });
                
                renderCrops();
                renderAnimals();
            }

            // Vykreslen√≠ plodin
            function renderCrops() {
                cropsElement.innerHTML = '';
                crops.forEach(crop => {
                    // Upraven√° logika pro event plodiny s isSecret
                    if (crop.isSecret && gameState.level < 1000000000) {
                        return;
                    }
                    
                    const cropElement = document.createElement('div');
                    const isFavorited = gameState.favoriteCrops.includes(crop.id);
                    const rarityClass = `rarity-${crop.rarity}`;
                    const rarityBadgeClass = `rarity-badge ${crop.rarity}`;
                    const rarityText = getRarityText(crop.rarity);
                    
                    cropElement.className = `crop-item ${crop.unlocked ? '' : 'locked'} ${gameState.selectedCrop === crop.id ? 'selected' : ''} ${isFavorited ? 'favorited' : ''}`;
                    
                    if (crop.unlocked) {
                        const canBuyEvent = crop.rarity !== RARITY.EVENT || (crop.rarity === RARITY.EVENT && crop.id === 50) || (crop.rarity === RARITY.EVENT && gameState.eventSeedsBought < MAX_SECRET_SEEDS);
                        const canPlantEvent = crop.rarity !== RARITY.EVENT || (crop.rarity === RARITY.EVENT && crop.id === 50) || (crop.rarity === RARITY.EVENT && gameState.eventSeedsPlanted < MAX_SECRET_SEEDS);
                        
                        cropElement.innerHTML = `
                            <div class="crop-icon">${crop.icon}</div>
                            <div class="crop-name ${rarityClass}">${crop.name}</div>
                            <div class="crop-cost">${crop.cost} <span>üí∏</span></div>
                            <div class="crop-time">${crop.growTime} dn√≠</div>
                            <div class="${rarityBadgeClass}">${rarityText}</div>
                            ${crop.rarity === RARITY.EVENT && crop.id === 50 ? `<div class="crop-locked">SPECI√ÅLN√ç EVENT</div>` : ''}
                            <button class="favorite-toggle ${isFavorited ? 'favorited' : ''}">
                                <i class="fas ${isFavorited ? 'fa-star' : 'fa-star'}"></i>
                            </button>
                        `;
                        
                        if (canBuyEvent && canPlantEvent) {
                            cropElement.addEventListener('click', (e) => {
                                if (!e.target.closest('.favorite-toggle')) {
                                    selectCrop(crop.id);
                                }
                            });
                            
                            const favoriteButton = cropElement.querySelector('.favorite-toggle');
                            favoriteButton.addEventListener('click', (e) => {
                                e.stopPropagation();
                                toggleFavoriteCrop(crop.id);
                            });
                        } else {
                            cropElement.classList.add('locked');
                            cropElement.style.cursor = 'not-allowed';
                            if (crop.rarity === RARITY.EVENT && crop.id !== 50) {
                                cropElement.title = `M≈Ø≈æe≈° koupit maxim√°lnƒõ ${MAX_SECRET_SEEDS} event sem√≠nek za celou hru`;
                            }
                        }
                    } else {
                        cropElement.innerHTML = `
                            <div class="crop-icon">${crop.icon}</div>
                            <div class="crop-name ${rarityClass}">${crop.name}</div>
                            <div class="${rarityBadgeClass}">${rarityText}</div>
                            <div class="crop-locked">Level ${crop.unlockLevel}</div>
                        `;
                    }
                    
                    cropsElement.appendChild(cropElement);
                });
            }

            // P≈ôepnut√≠ obl√≠ben√© plodiny
            function toggleFavoriteCrop(cropId) {
                const index = gameState.favoriteCrops.indexOf(cropId);
                if (index === -1) {
                    gameState.favoriteCrops.push(cropId);
                    showSaveIndicator('P≈ôid√°no do obl√≠ben√Ωch');
                } else {
                    gameState.favoriteCrops.splice(index, 1);
                    showSaveIndicator('Odebr√°no z obl√≠ben√Ωch');
                }
                renderCrops();
                saveGame();
            }

            // V√Ωbƒõr plodiny
            function selectCrop(cropId) {
                gameState.selectedCrop = cropId;
                const crop = crops.find(c => c.id === cropId);
                selectedCropNameElement.textContent = crop.name;
                selectedCropIconElement.textContent = crop.icon;
                renderCrops();
            }

            // Vykreslen√≠ zv√≠≈ôat
            function renderAnimals() {
                animalsElement.innerHTML = '';
                animals.forEach(animal => {
                    const animalElement = document.createElement('div');
                    const animalCount = gameState.animalCounts[animal.id] || 0;
                    const canSell = animalCount > 0;
                    const boostedIncome = Math.round(animal.income * gameState.animalIncomeMultiplier);
                    
                    animalElement.className = `animal-item ${animal.unlocked ? '' : 'locked'}`;
                    
                    if (animal.unlocked) {
                        animalElement.innerHTML = `
                            <div class="animal-icon">${animal.icon}</div>
                            <div class="animal-name">${animal.name}</div>
                            <div class="animal-cost">${animal.cost} <span>üí∏</span></div>
                            <div class="animal-income">+${boostedIncome} üí∏/den</div>
                            ${animalCount > 0 ? `<div class="animal-count">M√°≈°: ${animalCount}</div>` : ''}
                            <div class="animal-actions">
                                <button class="buy-animal">Koupit</button>
                                ${canSell ? `<button class="sell-animal">Prodat 1 za ${Math.floor(animal.cost / 2)} <span>üí∏</span></button>` : ''}
                            </div>
                        `;
                        
                        const buyButton = animalElement.querySelector('.buy-animal');
                        buyButton.addEventListener('click', (e) => {
                            e.stopPropagation();
                            buyAnimal(animal.id);
                        });
                        
                        if (canSell) {
                            const sellButton = animalElement.querySelector('.sell-animal');
                            sellButton.addEventListener('click', (e) => {
                                e.stopPropagation();
                                sellAnimal(animal.id);
                            });
                        }
                    } else {
                        animalElement.innerHTML = `
                            <div class="animal-icon">${animal.icon}</div>
                            <div class="animal-name">${animal.name}</div>
                            <div class="animal-locked">Level ${animal.unlockLevel}</div>
                        `;
                    }
                    
                    animalsElement.appendChild(animalElement);
                });
            }

            // N√°kup zv√≠≈ôete
            function buyAnimal(animalId) {
                const animal = animals.find(a => a.id === animalId);
                if (gameState.money >= animal.cost) {
                    gameState.money -= animal.cost;
                    
                    if (!gameState.animalCounts[animalId]) {
                        gameState.animalCounts[animalId] = 0;
                    }
                    gameState.animalCounts[animalId]++;
                    
                    addXP(animal.xp);
                    updateUI();
                    renderAnimals();
                    showSaveIndicator(`Koupeno: ${animal.name}`);
                    saveGame();
                } else {
                    showSaveIndicator('Nem√°≈° dostatek penƒõz!', true);
                }
            }

            // Prodej zv√≠≈ôete
            function sellAnimal(animalId) {
                const animal = animals.find(a => a.id === animalId);
                const sellPrice = Math.floor(animal.cost / 2);
                
                if (gameState.animalCounts[animalId] && gameState.animalCounts[animalId] > 0) {
                    gameState.animalCounts[animalId]--;
                    gameState.money += sellPrice;
                    
                    if (gameState.animalCounts[animalId] === 0) {
                        delete gameState.animalCounts[animalId];
                    }
                    
                    updateUI();
                    renderAnimals();
                    showSaveIndicator(`Prod√°no: 1x ${animal.name} za ${sellPrice} üí∏`);
                    saveGame();
                }
            }

            // Otev≈ôen√≠ modalu
            function openModal(type) {
                if (type === 'inventory') {
                    renderInventory();
                    inventoryModal.style.display = 'flex';
                } else if (type === 'box-shop') {
                    renderBoxShop();
                    boxShopModal.style.display = 'flex';
                } else if (type === 'upgrades') {
                    renderUpgrades();
                    upgradesModal.style.display = 'flex';
                } else if (type === 'economy') {
                    renderEconomy();
                    economyModal.style.display = 'flex';
                } else if (type === 'codes') {
                    renderUsedCodes();
                    codesModal.style.display = 'flex';
                }
            }

            // Vykreslen√≠ vylep≈°en√≠
            function renderUpgrades() {
                const upgradeItemsElement = document.getElementById('upgrade-items');
                upgradeItemsElement.innerHTML = '';
                
                upgrades.forEach(upgrade => {
                    const purchased = gameState.upgrades.includes(upgrade.id);
                    const canAfford = gameState.money >= upgrade.cost && !purchased;
                    
                    const upgradeElement = document.createElement('div');
                    upgradeElement.className = `upgrade-item ${purchased ? 'purchased' : ''}`;
                    
                    let statsText = '';
                    if (upgrade.effect === 'growthBoost') {
                        statsText = `+${(upgrade.value * 100)}% rychlost r≈Østu`;
                    } else if (upgrade.effect === 'sellBoost') {
                        statsText = `+${(upgrade.value * 100)}% cena prodeje`;
                    } else if (upgrade.effect === 'animalBoost') {
                        statsText = `+${(upgrade.value * 100)}% p≈ô√≠jem od zv√≠≈ôat`;
                    } else if (upgrade.effect === 'instantGrowth') {
                        statsText = 'INSTANTN√ç R≈ÆST PLODIN';
                    }
                    
                    upgradeElement.innerHTML = `
                        <div class="upgrade-icon">${upgrade.icon}</div>
                        <div class="upgrade-name">${upgrade.name}</div>
                        <div class="upgrade-description">${upgrade.description}</div>
                        <div class="upgrade-stats">${statsText}</div>
                        <div class="upgrade-cost">${purchased ? 'ZAKOUPENO' : `${upgrade.cost.toLocaleString()} <span>üí∏</span>`}</div>
                        ${!purchased ? `<button class="buy-upgrade" style="margin-top: 5px;" ${canAfford ? '' : 'disabled'}>Koupit</button>` : ''}
                    `;
                    
                    if (!purchased) {
                        const buyButton = upgradeElement.querySelector('.buy-upgrade');
                        buyButton.addEventListener('click', () => buyUpgrade(upgrade.id));
                    }
                    
                    upgradeItemsElement.appendChild(upgradeElement);
                });
            }

            // N√°kup vylep≈°en√≠
            function buyUpgrade(upgradeId) {
                const upgrade = upgrades.find(u => u.id === upgradeId);
                if (gameState.money >= upgrade.cost && !gameState.upgrades.includes(upgradeId)) {
                    gameState.money -= upgrade.cost;
                    gameState.upgrades.push(upgradeId);
                    
                    applyUpgradeEffect(upgrade);
                    
                    updateUI();
                    renderUpgrades();
                    showSaveIndicator(`Zakoupeno: ${upgrade.name}`);
                    saveGame();
                }
            }

            // Aplikace efektu vylep≈°en√≠
            function applyUpgradeEffect(upgrade) {
                if (upgrade.effect === 'growthBoost') {
                    gameState.growthMultiplier += upgrade.value;
                    showSaveIndicator(`Rychlost r≈Østu zv√Ω≈°ena o ${upgrade.value * 100}%!`);
                } else if (upgrade.effect === 'sellBoost') {
                    gameState.sellMultiplier += upgrade.value;
                    showSaveIndicator(`Cena prodeje zv√Ω≈°ena o ${upgrade.value * 100}%!`);
                } else if (upgrade.effect === 'animalBoost') {
                    gameState.animalIncomeMultiplier += upgrade.value;
                    showSaveIndicator(`P≈ô√≠jem od zv√≠≈ôat zv√Ω≈°en o ${upgrade.value * 100}%!`);
                } else if (upgrade.effect === 'instantGrowth') {
                    showSaveIndicator(`Magick√° p≈Øda odemyk√°na! Plodiny budou r≈Øst INSTANTNƒö!`);
                    
                    gameState.farm.forEach(plot => {
                        if (plot.state === 'planted') {
                            const crop = crops.find(c => c.id === plot.cropId);
                            if (crop && crop.rarity !== RARITY.EVENT) {
                                plot.progress = 100;
                                plot.state = 'ready';
                            }
                        }
                    });
                    renderFarm();
                }
                
                addXP(50);
            }

            // Vykreslen√≠ ekonomick√Ωch aktivit
            function renderEconomy() {
                const economyItemsElement = document.getElementById('economy-items');
                economyItemsElement.innerHTML = '';
                
                economyItems.forEach(economyItem => {
                    const purchased = gameState.economy.includes(economyItem.id);
                    const canAfford = gameState.money >= economyItem.cost && !purchased;
                    
                    const itemElement = document.createElement('div');
                    itemElement.className = `economy-item ${purchased ? 'purchased' : ''}`;
                    itemElement.innerHTML = `
                        <div class="economy-icon">${economyItem.icon}</div>
                        <div class="economy-name">${economyItem.name}</div>
                        <div class="economy-description">${economyItem.description}</div>
                        ${economyItem.income > 0 ? `<div class="economy-income">+${economyItem.income} üí∏/den</div>` : ''}
                        <div class="economy-cost">${purchased ? 'ZAKOUPENO' : `${economyItem.cost.toLocaleString()} <span>üí∏</span>`}</div>
                        ${!purchased ? `<button class="buy-economy" style="margin-top: 5px;" ${canAfford ? '' : 'disabled'}>${economyItem.income > 0 ? 'Investovat' : 'Koupit'}</button>` : ''}
                    `;
                    
                    if (!purchased) {
                        const buyButton = itemElement.querySelector('.buy-economy');
                        buyButton.addEventListener('click', () => buyEconomy(economyItem.id));
                    }
                    
                    economyItemsElement.appendChild(itemElement);
                });
            }

            // N√°kup ekonomick√© aktivity
            function buyEconomy(economyId) {
                const economyItem = economyItems.find(e => e.id === economyId);
                
                // Speci√°ln√≠ logika pro sd√≠len√Ω invent√°≈ô
                if (economyId === 7) { // Sd√≠len√Ω invent√°≈ô
                    if (gameState.money >= economyItem.cost && !gameState.economy.includes(economyId)) {
                        if (confirm(`Opravdu chce≈° koupit SD√çLEN√ù INVENT√Å≈ò za ${economyItem.cost.toLocaleString()} üí∏?\n\nV≈°echny profily budou sd√≠let invent√°≈ô!`)) {
                            gameState.money -= economyItem.cost;
                            gameState.economy.push(economyId);
                            
                            // Aktivovat sd√≠len√Ω invent√°≈ô
                            sharedInventory.enabled = true;
                            gameState.hasSharedInventory = true;
                            
                            // Zkop√≠rovat aktu√°ln√≠ invent√°≈ô do sd√≠len√©ho
                            Object.keys(gameState.inventory).forEach(key => {
                                if (!Object.keys(BOX_TYPES).includes(key)) {
                                    sharedInventory.items[key] = gameState.inventory[key];
                                }
                            });
                            
                            saveSharedInventory();
                            
                            addXP(economyItem.xp);
                            updateUI();
                            renderEconomy();
                            updateSharedInventoryNotice();
                            showSaveIndicator(`Zakoupeno: ${economyItem.name} - V≈°echny profily nyn√≠ sd√≠lej√≠ invent√°≈ô!`);
                            saveGame();
                        }
                    } else if (gameState.economy.includes(economyId)) {
                        showSaveIndicator('Sd√≠len√Ω invent√°≈ô u≈æ m√°≈°!', true);
                    } else {
                        showSaveIndicator(`Nem√°≈° dostatek üí∏! Pot≈ôebuje≈° ${economyItem.cost.toLocaleString()}`, true);
                    }
                    return;
                }
                
                // Bƒõ≈æn√© ekonomick√© investice
                if (gameState.money >= economyItem.cost && !gameState.economy.includes(economyId)) {
                    gameState.money -= economyItem.cost;
                    gameState.economy.push(economyId);
                    
                    addXP(economyItem.xp);
                    updateUI();
                    renderEconomy();
                    showSaveIndicator(`Zakoupeno: ${economyItem.name}`);
                    saveGame();
                }
            }

            // P≈ô√≠jem od zv√≠≈ôat a ekonomiky
            function collectIncome() {
                let totalIncome = 0;
                
                Object.keys(gameState.animalCounts).forEach(animalId => {
                    const animal = animals.find(a => a.id === parseInt(animalId));
                    if (animal) {
                        const baseIncome = animal.income * gameState.animalCounts[animalId];
                        const boostedIncome = baseIncome * gameState.animalIncomeMultiplier;
                        totalIncome += Math.round(boostedIncome);
                    }
                });
                
                gameState.economy.forEach(economyId => {
                    const economyItem = economyItems.find(e => e.id === economyId);
                    if (economyItem && economyItem.income > 0) {
                        totalIncome += economyItem.income;
                    }
                });
                
                if (totalIncome > 0) {
                    gameState.money += totalIncome;
                    updateUI();
                    saveGame();
                }
            }

            // Kontrola uplynul√©ho ƒçasu
            function checkElapsedTime() {
                const now = Date.now();
                const timeSinceLastAutoDay = now - gameState.lastAutoDay;
                
                if (timeSinceLastAutoDay >= AUTO_DAY_INTERVAL) {
                    const daysPassed = Math.floor(timeSinceLastAutoDay / AUTO_DAY_INTERVAL);
                    
                    if (daysPassed > 0) {
                        for (let i = 0; i < daysPassed; i++) {
                            processAutoDay();
                        }
                        
                        gameState.lastAutoDay = now;
                        updateUI();
                        renderFarm();
                        showTimeIndicator(`Bƒõhem tv√© nep≈ô√≠tomnosti ubƒõhlo ${daysPassed} dn√≠!`);
                        autoSave();
                    }
                }
            }

            // Automatick√Ω p≈ôechod na dal≈°√≠ den
            function autoNextDay() {
                processAutoDay();
                gameState.lastAutoDay = Date.now();
                updateUI();
                renderFarm();
                showTimeIndicator('Automaticky ubƒõhl den!');
                autoSave();
            }

            // Zpracov√°n√≠ automatick√©ho dne
            function processAutoDay() {
                gameState.day++;
                
                if (gameState.day % 30 === 0) {
                    updateSeason();
                }
                
                gameState.farm.forEach(plot => {
                    if (plot.state === 'planted') {
                        const crop = crops.find(c => c.id === plot.cropId);
                        if (crop) {
                            const hasMagicalSoil = gameState.upgrades.includes(15);
                            
                            if (crop.rarity === RARITY.EVENT) {
                                const baseGrowthRate = 100 / plot.growTime;
                                const seasonMultiplier = gameState.currentSeason.multiplier;
                                const upgradeMultiplier = gameState.growthMultiplier;
                                const totalMultiplier = seasonMultiplier * upgradeMultiplier;
                                const growthRate = baseGrowthRate * totalMultiplier;
                                
                                plot.progress += growthRate;
                            } else if (hasMagicalSoil) {
                                plot.progress = 100;
                                plot.state = 'ready';
                            } else {
                                const baseGrowthRate = 100 / plot.growTime;
                                const seasonMultiplier = gameState.currentSeason.multiplier;
                                const upgradeMultiplier = gameState.growthMultiplier;
                                const totalMultiplier = seasonMultiplier * upgradeMultiplier;
                                const growthRate = baseGrowthRate * totalMultiplier;
                                
                                plot.progress += growthRate;
                            }
                            
                            if (plot.progress >= 100) {
                                plot.state = 'ready';
                                plot.progress = 100;
                            }
                            
                            if (plot.state === 'ready' && gameState.day - plot.daysPlanted > plot.growTime + 3) {
                                plot.state = 'withered';
                            }
                        }
                    }
                });
                
                collectIncome();
            }

            // Zobrazen√≠ indik√°toru ƒçasu
            function showTimeIndicator(message) {
                timeIndicator.textContent = message;
                timeIndicator.classList.add('show');
                
                setTimeout(() => {
                    timeIndicator.classList.remove('show');
                }, 5000);
            }

            // Naƒçten√≠ pou≈æit√Ωch k√≥d≈Ø
            function loadUsedCodes() {
                const savedUsedCodes = localStorage.getItem(CODES_KEY);
                if (savedUsedCodes) {
                    gameState.usedCodes = JSON.parse(savedUsedCodes);
                    renderUsedCodes();
                }
            }

            // Naƒçten√≠ nekoneƒçn√Ωch k√≥d≈Ø
            function loadUnlimitedCodes() {
                const unlimited = localStorage.getItem(UNLIMITED_CODES_KEY);
                if (unlimited === 'true') {
                    gameState.unlimitedCodes = true;
                }
            }

            // Vykreslen√≠ pou≈æit√Ωch k√≥d≈Ø
            function renderUsedCodes() {
                usedCodesList.innerHTML = '';
                
                if (gameState.usedCodes.length === 0) {
                    usedCodesList.innerHTML = '<p>Zat√≠m jsi nepou≈æil ≈æ√°dn√© k√≥dy.</p>';
                    return;
                }
                
                gameState.usedCodes.forEach(codeName => {
                    const code = SPECIAL_CODES[codeName];
                    if (code) {
                        const codeElement = document.createElement('div');
                        codeElement.className = 'code-item';
                        codeElement.innerHTML = `
                            <span class="code-name">${code.name}</span>
                            <span class="code-reward">${code.reward}</span>
                        `;
                        usedCodesList.appendChild(codeElement);
                    }
                });
            }

            // Aktivace k√≥du
            function activateCode(codeValue) {
                const normalizedCode = codeValue.trim();
                
                if (!SPECIAL_CODES[normalizedCode]) {
                    showSaveIndicator('Neplatn√Ω k√≥d!', true);
                    return false;
                }
                
                if (!gameState.unlimitedCodes && gameState.usedCodes.includes(normalizedCode)) {
                    showSaveIndicator('Tento k√≥d ji≈æ byl pou≈æit!', true);
                    return false;
                }
                
                const code = SPECIAL_CODES[normalizedCode];
                const resultMessage = code.apply(gameState);
                
                if (!gameState.usedCodes.includes(normalizedCode)) {
                    gameState.usedCodes.push(normalizedCode);
                    localStorage.setItem(CODES_KEY, JSON.stringify(gameState.usedCodes));
                }
                
                // Speci√°ln√≠ logika pro k√≥d 2012DoPlo12
                if (normalizedCode === '2012DoPlo12') {
                    dailyGiftSettings.giftsPerDay = 10;
                    dailyGiftSettings.specialGiftActive = true;
                    saveDailyGiftSettings();
                }
                
                updateUI();
                renderCrops();
                renderAnimals();
                checkUnlocks();
                showSaveIndicator(resultMessage);
                saveGame();
                renderUsedCodes();
                codeInput.value = '';
                
                // Pokud je to k√≥d 2012DoPlo12, aktualizovat daily gifts UI
                if (normalizedCode === '2012DoPlo12') {
                    updateDailyGiftUI();
                }
                
                return true;
            }

            // P≈ôep√≠n√°n√≠ t√©matu
            function toggleTheme() {
                document.body.classList.toggle('dark-mode');
                if (document.body.classList.contains('dark-mode')) {
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                    localStorage.setItem(THEME_KEY, 'dark');
                } else {
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                    localStorage.setItem(THEME_KEY, 'light');
                }
            }

            // Nastaven√≠ event listener≈Ø
            function setupEventListeners() {
                themeToggle.addEventListener('click', toggleTheme);
                inventoryButton.addEventListener('click', () => openModal('inventory'));
                boxShopButton.addEventListener('click', () => openModal('box-shop'));
                upgradesButton.addEventListener('click', () => openModal('upgrades'));
                economyButton.addEventListener('click', () => openModal('economy'));
                codesButton.addEventListener('click', () => openModal('codes'));
                creatorButton.addEventListener('click', () => {
                    creatorModal.style.display = 'flex';
                });
                
                creatorYesButton.addEventListener('click', () => {
                    window.open('https://doplo12cz.github.io/dp12cz/', '_blank');
                    creatorModal.style.display = 'none';
                });
                
                creatorNoButton.addEventListener('click', () => {
                    creatorModal.style.display = 'none';
                });
                
                renameConfirmButton.addEventListener('click', renameProfile);
                renameCancelButton.addEventListener('click', () => {
                    renameProfileModal.style.display = 'none';
                    profileToRename = null;
                });
                
                // Filtry invent√°≈ôe
                inventoryFiltersElement.addEventListener('click', (e) => {
                    if (e.target.classList.contains('inventory-filter')) {
                        const filter = e.target.dataset.filter;
                        renderInventory(filter);
                    }
                });
                
                submitCodeButton.addEventListener('click', () => {
                    if (codeInput.value.trim() !== '') {
                        activateCode(codeInput.value);
                    }
                });
                
                codeInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        if (codeInput.value.trim() !== '') {
                            activateCode(codeInput.value);
                        }
                    }
                });
                
                profileNameInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        renameProfile();
                    }
                });
                
                // Zav√≠r√°n√≠ modal≈Ø
                document.querySelectorAll('.close-modal, .close-modal-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const modal = this.closest('.modal');
                        if (modal) {
                            modal.style.display = 'none';
                        }
                        
                        // Pokud je to modal pro otev≈ôen√≠ boxu, znovu vykreslit invent√°≈ô
                        if (modal && modal.id === 'open-box-modal') {
                            if (inventoryModal.style.display === 'flex') {
                                renderInventory(lastInventoryFilter);
                            }
                        }
                    });
                });
                
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', function(e) {
                        if (e.target === modal) {
                            modal.style.display = 'none';
                        }
                    });
                });
            }

            // Aktualizace UI
            function updateUI() {
                moneyElement.innerHTML = `${gameState.money.toLocaleString()} <span class="money-icon">üí∏</span>`;
                levelElement.textContent = gameState.level;
                dayElement.textContent = gameState.day;
                farmSizeElement.textContent = gameState.farmSize;
                
                const xpNeeded = gameState.level * 100;
                const xpPercentage = (gameState.xp / xpNeeded) * 100;
                xpProgressElement.style.width = `${xpPercentage}%`;
                xpTextElement.textContent = `${gameState.xp}/${xpNeeded} XP`;
                
                updateSeason();
                updateDailyGiftUI();
            }

            // Automatick√© ukl√°d√°n√≠
            function autoSave() {
                gameState.lastPlayed = Date.now();
                saveGame();
            }

            // Ulo≈æen√≠ hry
            function saveGame() {
                const saveKey = SAVE_KEY_PREFIX + gameState.currentProfile;
                localStorage.setItem(saveKey, JSON.stringify(gameState));
            }

            // Zobrazen√≠ indik√°toru ulo≈æen√≠
            function showSaveIndicator(message, isError = false) {
                saveIndicator.textContent = message;
                saveIndicator.style.background = isError ? 'rgba(244, 67, 54, 0.9)' : 'rgba(76, 175, 80, 0.9)';
                saveIndicator.classList.add('show');
                
                setTimeout(() => {
                    saveIndicator.classList.remove('show');
                }, 3000);
            }

            // Spu≈°tƒõn√≠ hry
            initGame();
        });
    </script>
</body>
</html>
