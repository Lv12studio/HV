<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gravity Race</title>
    <style>
        /* Předchozí styly zůstávají... */

        /* Timer display */
        #timerDisplay {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 2em;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            min-width: 120px;
        }

        /* Game over screen */
        #gameOverScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 1000;
        }

        .game-over-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 40px 30px;
            border-radius: 25px;
            text-align: center;
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            width: 100%;
            max-width: 400px;
        }

        .final-score {
            font-size: 4em;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <!-- Screen Container -->
    <div id="screenContainer">
        <!-- Main Menu Screen -->
        <div id="mainMenuScreen">
            <div class="menu-container">
                <h1>🚀 GRAVITY RACE</h1>
                <div class="menu-subtitle">Multiplayer vesmírný závod</div>
                
                <button class="menu-btn" id="createRoomBtn">Vytvořit místnost</button>
                <button class="menu-btn" id="joinRoomBtn">Připojit se k hře</button>
                <button class="menu-btn" id="singleplayerBtn">Time Attack</button>
            </div>
        </div>

        <!-- Ostatní obrazovky zůstávají stejné... -->

        <!-- Game Screen -->
        <div id="gameScreen">
            <canvas id="gameCanvas"></canvas>
            
            <div id="scoreDisplay">
                Skóre: <span id="score1">0</span>
            </div>
            
            <div id="timerDisplay">30</div>
            
            <div id="gameModeDisplay"></div>
            
            <!-- Mobile Controls -->
            <div id="mobileControls">
                <div class="joystick-container">
                    <div class="joystick-base"></div>
                    <div class="joystick-handle"></div>
                </div>
                
                <div class="action-buttons">
                    <div class="game-action-btn" id="gravityBtn">🌀<br>GRAVITACE</div>
                    <div class="game-action-btn" id="pulseBtn">💥<br>PULZ</div>
                </div>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="gameOverScreen">
            <div class="game-over-container">
                <h2>ČAS VYPRŠEL!</h2>
                <div class="final-score" id="finalScore">0</div>
                <p style="margin-bottom: 25px; font-size: 1.1em;">Celkové skóre</p>
                
                <button class="action-btn primary-btn" id="playAgainBtn">Hrát znovu</button>
                <button class="action-btn back-btn" id="backToMenuFromGame">Hlavní menu</button>
            </div>
        </div>
    </div>

    <script>
        // Přidáme game over screen elementy
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScore = document.getElementById('finalScore');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const backToMenuFromGame = document.getElementById('backToMenuFromGame');
        const timerDisplay = document.getElementById('timerDisplay');

        // Game state
        let gameTime = 30;
        let gameTimer = null;
        let playerScore = 0;
        let isGameActive = false;

        // Singleplayer - Time Attack
        function startSingleplayerGame() {
            currentRoomCode = 'TIME_' + Math.random().toString(36).substring(2, 6).toUpperCase();
            mainMenuScreen.style.display = 'none';
            gameScreen.style.display = 'flex';
            
            // Změna UI pro singleplayer
            document.getElementById('scoreDisplay').innerHTML = 'Skóre: <span id="score1">0</span>';
            document.getElementById('gameModeDisplay').textContent = 'Time Attack - 30 vteřin';
            
            initializeGame('singleplayer');
        }

        function initializeGame(mode) {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // Reset game state
            playerScore = 0;
            gameTime = 30;
            isGameActive = true;
            
            document.getElementById('score1').textContent = '0';
            timerDisplay.textContent = gameTime;
            
            if (mode === 'singleplayer') {
                startGameTimer();
            }
            
            // Herní objekty
            const player = {
                x: canvas.width / 2,
                y: canvas.height / 2,
                radius: 15,
                color: '#4ecdc4',
                speed: 4
            };
            
            const stars = [];
            
            // Vytvoření hvězd
            function createStars() {
                stars.length = 0;
                for (let i = 0; i < 15; i++) {
                    stars.push({
                        x: Math.random() * (canvas.width - 100) + 50,
                        y: Math.random() * (canvas.height - 100) + 50,
                        radius: 8,
                        collected: false
                    });
                }
            }
            
            createStars();
            
            // Ovládání
            let keys = {};
            let joystickActive = false;
            let joystickX = 0;
            let joystickY = 0;
            
            // Keyboard controls
            window.addEventListener('keydown', (e) => {
                keys[e.key] = true;
            });
            
            window.addEventListener('keyup', (e) => {
                keys[e.key] = false;
            });
            
            // Touch controls pro joystick
            const joystick = document.querySelector('.joystick-container');
            const joystickHandle = document.querySelector('.joystick-handle');
            
            let touchId = null;
            
            joystick.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (!touchId) {
                    touchId = e.changedTouches[0].identifier;
                    joystickActive = true;
                }
            });
            
            joystick.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (!joystickActive) return;
                
                const touch = Array.from(e.changedTouches).find(t => t.identifier === touchId);
                if (touch) {
                    const rect = joystick.getBoundingClientRect();
                    const centerX = rect.left + rect.width / 2;
                    const centerY = rect.top + rect.height / 2;
                    
                    const deltaX = touch.clientX - centerX;
                    const deltaY = touch.clientY - centerY;
                    const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                    const maxDistance = rect.width / 2 - 35;
                    
                    if (distance > maxDistance) {
                        joystickX = (deltaX / distance) * maxDistance;
                        joystickY = (deltaY / distance) * maxDistance;
                    } else {
                        joystickX = deltaX;
                        joystickY = deltaY;
                    }
                    
                    joystickHandle.style.transform = `translate(calc(-50% + ${joystickX}px), calc(-50% + ${joystickY}px))`;
                }
            });
            
            joystick.addEventListener('touchend', (e) => {
                e.preventDefault();
                if (Array.from(e.changedTouches).find(t => t.identifier === touchId)) {
                    joystickActive = false;
                    joystickX = 0;
                    joystickY = 0;
                    joystickHandle.style.transform = 'translate(-50%, -50%)';
                    touchId = null;
                }
            });
            
            // Herní smyčka
            function gameLoop() {
                if (!isGameActive) return;
                
                // Clear canvas
                ctx.fillStyle = '#000011';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Update player position
                if (joystickActive) {
                    player.x += (joystickX / 20) * player.speed;
                    player.y += (joystickY / 20) * player.speed;
                } else {
                    if (keys['ArrowLeft'] || keys['a']) player.x -= player.speed;
                    if (keys['ArrowRight'] || keys['d']) player.x += player.speed;
                    if (keys['ArrowUp'] || keys['w']) player.y -= player.speed;
                    if (keys['ArrowDown'] || keys['s']) player.y += player.speed;
                }
                
                // Boundary check
                player.x = Math.max(player.radius, Math.min(canvas.width - player.radius, player.x));
                player.y = Math.max(player.radius, Math.min(canvas.height - player.radius, player.y));
                
                // Draw stars
                ctx.fillStyle = '#ffff00';
                stars.forEach(star => {
                    if (!star.collected) {
                        ctx.beginPath();
                        ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                        ctx.fill();
                        
                        // Check collision
                        const dist = Math.sqrt((player.x - star.x) ** 2 + (player.y - star.y) ** 2);
                        if (dist < player.radius + star.radius) {
                            star.collected = true;
                            playerScore += 10;
                            document.getElementById('score1').textContent = playerScore;
                            
                            // Create new star after delay
                            setTimeout(() => {
                                star.collected = false;
                                star.x = Math.random() * (canvas.width - 100) + 50;
                                star.y = Math.random() * (canvas.height - 100) + 50;
                            }, 500);
                        }
                    }
                });
                
                // Draw player
                ctx.fillStyle = player.color;
                ctx.beginPath();
                ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw player glow
                ctx.shadowColor = player.color;
                ctx.shadowBlur = 20;
                ctx.beginPath();
                ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
                
                requestAnimationFrame(gameLoop);
            }
            
            gameLoop();
        }
        
        function startGameTimer() {
            gameTimer = setInterval(() => {
                gameTime--;
                timerDisplay.textContent = gameTime;
                
                if (gameTime <= 0) {
                    endGame();
                }
            }, 1000);
        }
        
        function endGame() {
            isGameActive = false;
            clearInterval(gameTimer);
            
            finalScore.textContent = playerScore;
            gameOverScreen.style.display = 'flex';
        }
        
        // Game over buttons
        playAgainBtn.addEventListener('click', () => {
            gameOverScreen.style.display = 'none';
            startSingleplayerGame();
        });
        
        backToMenuFromGame.addEventListener('click', () => {
            gameOverScreen.style.display = 'none';
            gameScreen.style.display = 'none';
            mainMenuScreen.style.display = 'flex';
        });

        // Ostatní event listeners zůstávají stejné...
    </script>
</body>
</html>
