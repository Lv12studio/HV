<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harvest Valley | Farm√°≈ôsk√° Hra</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: manipulation;
        }

        :root {
            --bg-primary: linear-gradient(135deg, #87CEEB, #98FB98);
            --bg-secondary: rgba(255, 255, 255, 0.95);
            --text-primary: #2d5016;
            --text-secondary: #4a7c1f;
            --accent-color: #a3d977;
            --border-color: #a5d6a7;
            --button-bg: linear-gradient(135deg, #4caf50, #2e7d32);
            --plot-bg: #d7ccc8;
            --plot-planted: #8bc34a;
            --plot-ready: #ffd54f;
            --plot-withered: #795548;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }

        .dark-mode {
            --bg-primary: linear-gradient(135deg, #FF0000, #00FF01);
            --bg-secondary: rgba(40, 40, 40, 0.95);
            --text-primary: #c8e6c9;
            --text-secondary: #a5d6a7;
            --accent-color: #4a7c1f;
            --border-color: #4a7c1f;
            --button-bg: linear-gradient(135deg, #FF0000, #00FF00);
            --plot-bg: #FF0000;
            --plot-planted: #689f38;
            --plot-ready: #fbc02d;
            --plot-withered: #4e342e;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 100%;
            width: 100%;
            text-align: center;
        }

        header {
            margin-bottom: 20px;
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            position: relative;
        }

        .theme-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-primary);
            transition: transform 0.3s ease;
        }

        .theme-toggle:hover {
            transform: rotate(30deg);
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            color: var(--text-primary);
            text-shadow: 2px 2px 0 var(--accent-color);
        }

        .subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .season-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .season-icon {
            font-size: 1.5rem;
        }

        .auto-time-info {
            background: #e3f2fd;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-top: 5px;
            border: 2px solid #2196f3;
        }

        .dark-mode .auto-time-info {
            background: #1a2f3f;
            border-color: #1976d2;
        }

        /* OPTIMALIZOVAN√â: Adventn√≠ kalend√°≈ô - v√Ωkonnƒõj≈°√≠ */
        .advent-container {
            width: 100%;
            max-width: 600px;
            margin: 15px auto;
            position: relative;
        }

        .advent-minimized {
            position: absolute;
            top: 0;
            right: 0;
            background: linear-gradient(135deg, #ff4444, #ff6b00);
            color: white;
            border: 3px solid gold;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 100;
            transition: all 0.3s ease;
            animation: christmasGlow 2s infinite alternate;
        }

        .advent-minimized:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .advent-minimized .advent-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: red;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            border: 2px solid white;
            animation: pulse 1s infinite;
        }

        .advent-calendar {
            background: linear-gradient(135deg, #ff0000, #00aa00, #0000ff);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            border: 5px solid gold;
            position: relative;
            overflow: hidden;
            display: none; /* Skryt√Ω, zobraz√≠ se jen v prosinci */
            animation: christmasGlow 3s infinite alternate; /* Zjednodu≈°en√° animace */
        }

        .dark-mode .advent-calendar {
            background: linear-gradient(135deg, #8b0000, #006400, #00008b);
            border-color: #ffd700;
        }

        .advent-calendar::before {
            content: "üéÑ";
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 2rem;
            opacity: 0.3;
        }

        .advent-calendar::after {
            content: "üéÖ";
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 2rem;
            opacity: 0.3;
        }

        .advent-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .advent-header h3 {
            color: white;
            text-shadow: 2px 2px 0 #000;
            font-size: 1.5rem;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 15px;
            border-radius: 20px;
        }

        .advent-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .advent-minimize-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .advent-minimize-btn:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(1.1);
        }

        .advent-countdown {
            background: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            color: #ff0000;
            font-size: 1rem;
            border: 2px solid gold;
        }

        .dark-mode .advent-countdown {
            background: #2d4a2d;
            color: #ffcc00;
        }

        .advent-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        @media (max-width: 480px) {
            .advent-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .advent-day {
            aspect-ratio: 1;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid rgba(255, 215, 0, 0.5);
            position: relative;
            overflow: hidden;
        }

        .dark-mode .advent-day {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.2));
            border-color: rgba(255, 215, 0, 0.7);
        }

        .advent-day.locked {
            background: linear-gradient(135deg, rgba(100, 100, 100, 0.3), rgba(70, 70, 70, 0.2));
            cursor: not-allowed;
            opacity: 0.6;
            border-color: rgba(150, 150, 150, 0.5);
        }

        .dark-mode .advent-day.locked {
            background: linear-gradient(135deg, rgba(50, 50, 50, 0.3), rgba(30, 30, 30, 0.2));
        }

        .advent-day.unlocked {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 140, 0, 0.2));
            border-color: #ffd700;
        }

        .dark-mode .advent-day.unlocked {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.4), rgba(255, 140, 0, 0.3));
        }

        .advent-day.claimed {
            background: linear-gradient(135deg, rgba(0, 255, 0, 0.3), rgba(0, 200, 0, 0.2));
            border-color: #00ff00;
        }

        .dark-mode .advent-day.claimed {
            background: linear-gradient(135deg, rgba(0, 200, 0, 0.4), rgba(0, 150, 0, 0.3));
        }

        .advent-day:hover:not(.locked) {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.5);
        }

        /* ULTRA LUCK POUZE PRO 24.12. */
        .advent-day.ultra-luck {
            border-width: 4px;
            border-style: dashed;
            border-color: #ff0000;
            animation: ultraLuckGlow 2s infinite alternate;
        }

        .advent-number {
            font-size: 1.5rem;
            color: white;
            font-weight: bold;
            text-shadow: 2px 2px 0 #000;
        }

        .advent-day.locked .advent-number {
            color: #aaa;
        }

        .advent-day.unlocked .advent-number {
            color: #ffd700;
        }

        .advent-reward {
            font-size: 0.8rem;
            color: white;
            text-align: center;
            margin-top: 5px;
            text-shadow: 1px 1px 0 #000;
        }

        .advent-day.locked .advent-reward {
            color: #aaa;
        }

        .advent-today {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ff0000;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            border: 2px solid white;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        @keyframes christmasGlow {
            0% {
                box-shadow: 0 0 10px #ff0000;
                border-color: #ff0000;
            }
            50% {
                box-shadow: 0 0 20px #ffd700;
                border-color: #ffd700;
            }
            100% {
                box-shadow: 0 0 10px #00ff00;
                border-color: #00ff00;
            }
        }

        @keyframes ultraLuckGlow {
            0% {
                box-shadow: 0 0 10px #ff0000;
                border-color: #ff0000;
            }
            100% {
                box-shadow: 0 0 20px #ffd700;
                border-color: #ffd700;
            }
        }

        /* Zbytek CSS styl≈Ø... */
        .game-container {
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 15px;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
            background: #e8f5e9;
            padding: 10px;
            border-radius: 10px;
            border: 3px solid var(--border-color);
        }

        .dark-mode .stats {
            background: #2d4a2d;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 8px 12px;
            border-radius: 10px;
            min-width: 80px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .dark-mode .stat-item {
            background: #3a3a3a;
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 3px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text-primary);
        }

        .farm-container {
            background: #c8e6c9;
            border-radius: 10px;
            padding: 15px;
            border: 5px solid #8bc34a;
            margin: 0 auto 15px;
            max-width: 100%;
        }

        .dark-mode .farm-container {
            background: #2d4a2d;
            border-color: #4a7c1f;
        }

        .farm {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 0 auto;
            max-width: 100%;
            justify-content: center;
        }

        .plot {
            width: 85px;
            height: 85px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            transition: all 0.3s ease;
            background: var(--plot-bg);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
            padding: 5px;
        }

        .plot:hover {
            transform: scale(1.05);
        }

        .plot.empty {
            background: var(--plot-bg);
        }

        .plot.planted {
            background: var(--plot-planted);
        }

        .plot.ready {
            background: var(--plot-ready);
            animation: pulse 1s infinite;
        }

        .plot.withered {
            background: var(--plot-withered);
        }

        .plot.new {
            background: #ffecb3;
            border: 2px dashed #ff9800;
        }

        .dark-mode .plot.new {
            background: #5d4037;
            border-color: #ff9800;
        }

        .crops {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .crop-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 10px;
            border-radius: 10px;
            min-width: 90px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
            border: 2px solid #ffd54f;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dark-mode .crop-item {
            background: #3a3a3a;
            color: var(--text-primary);
        }

        .crop-item.selected {
            border-color: #e53935;
            background: #fff3e0;
            transform: scale(1.05);
        }

        .dark-mode .crop-item.selected {
            background: #5d4037;
        }

        .crop-item.locked {
            border-color: #9e9e9e;
            background: #f5f5f5;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .dark-mode .crop-item.locked {
            background: #2a2a2a;
        }

        .crop-item:hover:not(.locked) {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        }

        .crop-icon {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .crop-name {
            font-size: 0.85rem;
            font-weight: bold;
            color: var(--text-primary);
        }

        .crop-cost {
            font-size: 0.75rem;
            color: #e53935;
        }

        .crop-time {
            font-size: 0.75rem;
            color: #1976d2;
        }

        .crop-locked {
            font-size: 0.75rem;
            color: #757575;
            font-style: italic;
        }

        .favorite-toggle {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #ccc;
            transition: all 0.3s ease;
            margin-top: 5px;
        }

        .favorite-toggle.favorited {
            color: #ffd700;
        }

        .favorite-toggle:hover {
            transform: scale(1.2);
        }

        .crop-item.favorited {
            border-color: #ffd700;
            background: #fffde7;
        }

        .dark-mode .crop-item.favorited {
            background: #5d4037;
        }

        .animals {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .animal-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 10px;
            border-radius: 10px;
            min-width: 90px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
            border: 2px solid #81c784;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dark-mode .animal-item {
            background: #3a3a3a;
            color: var(--text-primary);
        }

        .animal-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        }

        .animal-icon {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .animal-name {
            font-size: 0.85rem;
            font-weight: bold;
            color: var(--text-primary);
        }

        .animal-cost {
            font-size: 0.75rem;
            color: #e53935;
        }

        .animal-income {
            font-size: 0.75rem;
            color: #43a047;
        }

        .animal-actions {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }

        .animal-actions button {
            padding: 5px 8px;
            font-size: 0.7rem;
        }

        .sell-animal {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .animal-count {
            font-size: 0.7rem;
            color: #1976d2;
            margin-top: 2px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            background: var(--button-bg);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .market {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .upgrades {
            background: linear-gradient(135deg, #2196f3, #0d47a1);
        }

        .save {
            background: linear-gradient(135deg, #9c27b0, #673ab7);
        }

        .economy {
            background: linear-gradient(135deg, #ff5722, #d84315);
        }

        .reset {
            background: linear-gradient(135deg, #f44336, #b71c1c);
        }

        .selected-crop {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            border: 2px dashed #4caf50;
            font-size: 0.9rem;
        }

        .dark-mode .selected-crop {
            background: #2d4a2d;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: modalAppear 0.4s ease;
            position: relative;
            overflow-y: auto;
        }

        .dark-mode .modal-content {
            background: #3a3a3a;
            color: var(--text-primary);
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #757575;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            background: #f5f5f5;
            color: #e53935;
        }

        .dark-mode .close-modal:hover {
            background: #4a4a4a;
        }

        .modal h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: var(--text-primary);
            padding-right: 30px;
        }

        .modal p {
            margin-bottom: 20px;
            font-size: 1.1rem;
            line-height: 1.5;
            color: var(--text-secondary);
        }

        .instructions {
            background: #e8f5e9;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            text-align: left;
            font-size: 0.9rem;
            border: 2px dashed #81c784;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .dark-mode .instructions {
            background: #2d4a2d;
        }

        .instructions h3 {
            color: var(--text-primary);
            margin-bottom: 8px;
            text-align: center;
        }

        .instructions ul {
            list-style-type: none;
            padding-left: 0;
        }

        .instructions li {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .instructions li::before {
            content: "üå±";
            margin-right: 8px;
        }

        footer {
            margin-top: 20px;
            text-align: center;
            color: var(--text-primary);
            font-size: 0.8rem;
            width: 100%;
            max-width: 600px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }

        .dark-mode .progress-bar {
            background: #4a4a4a;
        }

        .progress {
            height: 100%;
            background: #4caf50;
            border-radius: 5px;
            transition: width 0.3s;
        }

        .xp-bar {
            width: 100%;
            height: 15px;
            background: #e0e0e0;
            border-radius: 10px;
            margin: 5px 0;
            overflow: hidden;
            position: relative;
        }

        .dark-mode .xp-bar {
            background: #4a4a4a;
        }

        .xp-progress {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .xp-text {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            color: var(--text-primary);
        }

        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            transform: translateY(100px);
            transition: transform 0.3s ease;
            z-index: 1000;
            display: none;
        }

        .save-indicator.show {
            transform: translateY(0);
        }

        .time-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(33, 150, 243, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
        }

        .time-indicator.show {
            display: block;
        }

        @keyframes modalAppear {
            from { opacity: 0; transform: translateY(-30px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .season-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 8px;
        }

        .season-spring { background: #c8e6c9; color: #2e7d32; }
        .season-summer { background: #fff9c4; color: #f57f17; }
        .season-autumn { background: #ffcc80; color: #ef6c00; }
        .season-winter { background: #e3f2fd; color: #1565c0; }

        .dark-mode .season-spring { background: #2d4a2d; color: #c8e6c9; }
        .dark-mode .season-summer { background: #5d4037; color: #ffd54f; }
        .dark-mode .season-autumn { background: #5d4037; color: #ffb74d; }
        .dark-mode .season-winter { background: #1a2f3f; color: #bbdefb; }

        .farm-expansion {
            background: #fff8e1;
            padding: 8px;
            border-radius: 8px;
            margin: 5px 0;
            border: 2px solid #ffd54f;
            font-size: 0.9rem;
            display: none;
        }

        .dark-mode .farm-expansion {
            background: #5d4037;
        }

        .upgrade-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
            border: 2px solid #2196f3;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dark-mode .upgrade-item {
            background: #3a3a3a;
            color: var(--text-primary);
        }

        .upgrade-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        }

        .upgrade-item.purchased {
            border-color: #4caf50;
            background: #e8f5e9;
        }

        .dark-mode .upgrade-item.purchased {
            background: #2d4a2d;
        }

        .upgrade-icon {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .upgrade-name {
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--text-primary);
        }

        .upgrade-cost {
            font-size: 0.8rem;
            color: #e53935;
        }

        .upgrade-description {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: center;
            margin: 5px 0;
        }

        .upgrade-stats {
            font-size: 0.7rem;
            color: #666;
            margin-top: 3px;
        }

        .dark-mode .upgrade-stats {
            color: #aaa;
        }

        .market-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
            border: 2px solid #ff9800;
        }

        .dark-mode .market-item {
            background: #3a3a3a;
            color: var(--text-primary);
        }

        .save-slot {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
            border: 2px solid #9c27b0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dark-mode .save-slot {
            background: #3a3a3a;
            color: var(--text-primary);
        }

        .save-slot:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        }

        .save-slot.empty {
            border-color: #9e9e9e;
            background: #f5f5f5;
        }

        .dark-mode .save-slot.empty {
            background: #2a2a2a;
        }

        .save-slot-info {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .economy-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
            border: 2px solid #ff5722;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dark-mode .economy-item {
            background: #3a3a3a;
            color: var(--text-primary);
        }

        .economy-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.15);
        }

        .economy-item.purchased {
            border-color: #4caf50;
            background: #e8f5e9;
        }

        .dark-mode .economy-item.purchased {
            background: #2d4a2d;
        }

        .economy-icon {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .economy-name {
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--text-primary);
        }

        .economy-cost {
            font-size: 0.8rem;
            color: #e53935;
        }

        .economy-description {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: center;
            margin: 5px 0;
        }

        .economy-income {
            font-size: 0.7rem;
            color: #43a047;
            margin-top: 3px;
        }

        .market-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            justify-content: center;
        }

        .market-filter {
            padding: 8px 15px;
            border: 2px solid #ff9800;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .market-filter.active {
            background: #ff9800;
            color: white;
        }

        .dark-mode .market-filter {
            background: #3a3a3a;
            color: var(--text-primary);
        }

        .dark-mode .market-filter.active {
            background: #ff9800;
            color: white;
        }

        @media (max-width: 480px) {
            .farm {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .plot {
                width: 75px;
                height: 75px;
                font-size: 1.4rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .crops, .animals {
                gap: 8px;
            }
            
            .crop-item, .animal-item {
                min-width: 80px;
                padding: 8px;
            }
            
            .controls {
                gap: 8px;
            }
            
            button {
                padding: 10px 15px;
                font-size: 0.8rem;
            }
            
            .modal-content {
                max-width: 95%;
                padding: 20px 15px;
            }
            
            .time-indicator {
                left: 10px;
                bottom: 10px;
                font-size: 0.7rem;
                padding: 8px 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button class="theme-toggle" id="theme-toggle">
                <i class="fas fa-moon"></i>
            </button>
            <h1>Harvest Valley V√°noƒçn√≠ farma<i class="fas fa-tractor"></i></h1>
            <p class="subtitle">Sta≈à se mistrem farm√°≈ôem! Pƒõstuj, skl√≠zej a roz≈°i≈ôuj svou farmu.</p>
            <div class="season-info">
                <span>Roƒçn√≠ obdob√≠:</span>
                <span class="season-indicator" id="season">Naƒç√≠t√°n√≠...</span>
                <span class="season-icon" id="season-icon">üéÅ</span>
            </div>
            <div class="auto-time-info">
                <i class="fas fa-clock"></i> Ka≈æd√Ωch 10 minut automaticky ubƒõhne den
            </div>
        </header>

        <!-- OPTIMALIZOVAN√ù: Adventn√≠ kalend√°≈ô s ULTRA LUCK pouze 24.12. -->
        <div class="advent-container">
            <div class="advent-minimized" id="advent-minimized" style="display: none;">
                <i class="fas fa-gift" style="font-size: 1.5rem;"></i>
                <div class="advent-badge" id="advent-badge">0</div>
            </div>
            
            <div class="advent-calendar" id="advent-calendar">
                <div class="advent-header">
                    <h3><i class="fas fa-gift"></i> V√ÅNOƒåN√ç KALEND√Å≈ò 2025</h3>
                    <div class="advent-controls">
                        <div class="advent-minimize-btn" id="advent-minimize-btn" title="Minimalizovat">
                            <i class="fas fa-minus"></i>
                        </div>
                        <div class="advent-countdown" id="advent-countdown"></div>
                    </div>
                </div>
                <p style="color: white; text-align: center; margin-bottom: 10px; text-shadow: 1px 1px 2px black; font-size: 1.1rem;">
                    <i class="fas fa-star" style="color: gold;"></i> 
                    <strong>24. PROSINCE = ULTRA LUCK!</strong> 
                    <i class="fas fa-star" style="color: gold;"></i><br>
                    <small style="color: #ffd700;">Ostatn√≠ dny = norm√°ln√≠ odmƒõny</small>
                </p>
                <div class="advent-grid" id="advent-grid">
                    <!-- Adventn√≠ dny se vygeneruj√≠ JavaScriptem -->
                </div>
            </div>
        </div>

        <div class="game-container">
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-label">PEN√çZE</div>
                    <div class="stat-value" id="money">100</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">LEVEL</div>
                    <div class="stat-value" id="level">1</div>
                    <div class="xp-bar">
                        <div class="xp-progress" id="xp-progress" style="width: 0%"></div>
                        <div class="xp-text" id="xp-text">0/100 XP</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">DEN</div>
                    <div class="stat-value" id="day">1</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">POLE</div>
                    <div class="stat-value" id="farm-size">9</div>
                </div>
            </div>

            <div class="selected-crop">
                <strong>Vybr√°na plodina:</strong> 
                <span id="selected-crop-name">≈Ω√°dn√°</span>
                <span id="selected-crop-icon"></span>
            </div>

            <!-- Tlaƒç√≠tka p≈ôesunuta nad pole -->
            <div class="controls">
                <button id="next-day">
                    <i class="fas fa-sun"></i> Dal≈°√≠ Den
                </button>
                <button id="market" class="market">
                    <i class="fas fa-store"></i> Tr≈æi≈°tƒõ
                </button>
                <button id="upgrades" class="upgrades">
                    <i class="fas fa-tools"></i> N√°stroje
                </button>
                <button id="economy" class="economy">
                    <i class="fas fa-chart-line"></i> Ekonomika
                </button>
                <button id="save-game" class="save">
                    <i class="fas fa-save"></i> Ulo≈æit
                </button>
            </div>

            <h3><i class="fas fa-seedling"></i> Tv√° Farm√°≈ôsk√° Pole</h3>
            <div class="farm-container">
                <div class="farm" id="farm"></div>
            </div>

            <h3><i class="fas fa-shopping-basket"></i> Sem√≠nka a Sazenice</h3>
            <div class="crops" id="crops"></div>

            <h3><i class="fas fa-paw"></i> Zv√≠≈ôec√≠ pomocn√≠ci</h3>
            <div class="animals" id="animals"></div>
        </div>

        <div class="instructions">
            <h3>Jak hr√°t:</h3>
            <ul>
                <li>Nejprve vyber plodinu kliknut√≠m na ni v obchodƒõ</li>
                <li>Pak klikni na pr√°zdn√© pole k vysazen√≠ vybran√© plodiny</li>
                <li>Poƒçkej, a≈æ plodina vyroste (ukazuje progress bar)</li>
                <li>Skliƒè zral√© plodiny (≈ælut√° pole) a prodej je na tr≈æi≈°ti</li>
                <li>Po≈ôizuj si zv√≠≈ôec√≠ pomocn√≠ky pro pravideln√Ω p≈ô√≠jem</li>
                <li>Investuj do ekonomick√Ωch aktivit pro pasivn√≠ p≈ô√≠jem</li>
                <li>Pou≈æ√≠vej tlaƒç√≠tko "Dal≈°√≠ Den" k postupu v ƒçase</li>
                <li><strong>Ka≈æd√Ωch 10 minut automaticky ubƒõhne den (online i offline)!</strong></li>
                <li><strong>Roƒçn√≠ obdob√≠ ovliv≈àuj√≠ r≈Øst plodin podle re√°ln√©ho ƒçasu! (nap≈ô√≠klad: ƒçervenec: 2x r≈Øst, prosinec: 0,7x r≈Øst)</strong></li>
                <li><strong>24. PROSINCE = ULTRA LUCK ODƒöMNA!</strong></li>
            </ul>
        </div>
    </div>

    <div class="save-indicator" id="save-indicator">
        <i class="fas fa-check"></i> Hra ulo≈æena!
    </div>

    <div class="time-indicator" id="time-indicator">
        <i class="fas fa-clock"></i> Automaticky ubƒõhl den!
    </div>

    <div class="modal" id="market-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-store"></i> Farm√°≈ôsk√© Tr≈æi≈°tƒõ</h2>
            <p>Prodej sv√© √∫rody a vydƒõlej pen√≠ze!</p>
            <div id="market-items"></div>
            <button class="close-modal-btn">Zav≈ô√≠t</button>
        </div>
    </div>

    <div class="modal" id="upgrades-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-tools"></i> Farm√°≈ôsk√© N√°stroje</h2>
            <p>Vylep≈°i svou farmu pro vy≈°≈°√≠ v√Ωnosy!</p>
            <div id="upgrade-items"></div>
            <button class="close-modal-btn">Zav≈ô√≠t</button>
        </div>
    </div>

    <div class="modal" id="economy-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-chart-line"></i> Ekonomick√© Investice</h2>
            <p>Investuj do ekonomick√Ωch aktivit pro pasivn√≠ p≈ô√≠jem!</p>
            <div id="economy-items"></div>
            <button class="close-modal-btn">Zav≈ô√≠t</button>
        </div>
    </div>

    <div class="modal" id="save-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-save"></i> Spr√°va Ulo≈æen√≠</h2>
            <p>Vyber slot pro ulo≈æen√≠ nebo naƒçten√≠ hry:</p>
            <div id="save-slots"></div>
            <button class="close-modal-btn">Zav≈ô√≠t</button>
        </div>
    </div>

    <div class="modal" id="level-up-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-trophy"></i> Level Up!</h2>
            <p>Gratulujeme! Postoupil jsi na level <span id="new-level">2</span>!</p>
            <p id="level-up-benefits"></p>
            <button class="close-modal-btn">Super!</button>
        </div>
    </div>

    <div class="modal" id="load-game-modal">
        <div class="modal-content">
            <h2><i class="fas fa-folder-open"></i> Naƒç√≠st Hru</h2>
            <p>Na≈°li jsme ulo≈æenou hru. Chce≈° ji naƒç√≠st?</p>
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                <button id="load-game-yes" style="background: #4caf50;">Ano, naƒç√≠st</button>
                <button id="load-game-no" style="background: #f44336;">Ne, zaƒç√≠t novou</button>
            </div>
        </div>
    </div>

    <div class="modal" id="reset-confirm-modal">
        <div class="modal-content">
            <h2><i class="fas fa-redo"></i> Resetovat Farma</h2>
            <p>Opravdu chce≈° resetovat svou farmu?</p>
            <p><strong>Ztrat√≠≈°:</strong> V≈°echny plodiny, zv√≠≈ôata, vylep≈°en√≠ a ekonomick√© investice</p>
            <p><strong>Zachov√°≈°:</strong> Level 5, XP a save slot</p>
            <p><strong>Z√≠sk√°≈°:</strong> 10 000 Kƒç a 100 XP</p>
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                <button id="reset-confirm-yes" style="background: #f44336;">Ano, resetovat</button>
                <button id="reset-confirm-no" style="background: #4caf50;">Ne, vr√°tit se</button>
            </div>
        </div>
    </div>

    <!-- OPTIMALIZOVAN√ù: Modal pro adventn√≠ odmƒõny -->
    <div class="modal" id="advent-modal">
        <div class="modal-content" style="max-width: 500px; text-align: center;">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-gift"></i> ADVENTN√ç ODƒöMNA!</h2>
            <div id="advent-reward-content">
                <!-- Obsah se napln√≠ JavaScriptem -->
            </div>
            <button class="close-modal-btn" style="margin-top: 20px; background: linear-gradient(135deg, #4caf50, #2e7d32); padding: 15px 30px;">
                <i class="fas fa-check"></i> SUPER! D√çKY!
            </button>
        </div>
    </div>

    <footer>
        <p>Harvest Valley - Farm√°≈ôsk√° strategie &copy; 2023</p>
        <p><small>Hra funguje offline a automaticky ukl√°d√° postup</small></p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Hern√≠ konstanty
            const INITIAL_FARM_SIZE = 9; // 3x3 m≈ô√≠≈æka
            const SAVE_KEY_PREFIX = 'harvest_valley_save_';
            const THEME_KEY = 'harvest_valley_theme';
            const AUTO_DAY_INTERVAL = 10 * 60 * 1000; // 10 minut v milisekund√°ch
            const CURRENT_SAVE_SLOT_KEY = 'harvest_valley_current_slot';
            const MAX_SAVE_SLOTS = 5;
            const MAX_SECRET_SEEDS = 99999999999;

            // OPTIMALIZOVAN√â: Adventn√≠ kalend√°≈ô konstanty
            const ADVENT_YEAR = 2025;
            const ADVENT_MONTH = 11; // Prosinec je 11 (0-indexed)
            const ADVENT_START_DAY = 1;
            const ADVENT_END_DAY = 24;
            const CHRISTMAS_DAY = 24; // ULTRA LUCK pouze 24. prosince
            const ADVENT_SAVE_KEY = 'harvest_valley_advent_2025';
            const ADVENT_MINIMIZED_KEY = 'harvest_valley_advent_minimized_2025';
            
            // Re√°ln√° roƒçn√≠ obdob√≠ podle mƒõs√≠c≈Ø
            const REAL_SEASONS = {
                0: { name: 'Zima', icon: '‚ùÑÔ∏è', multiplier: 0.8, class: 'season-winter' },     // Leden
                1: { name: 'Zima', icon: '‚ùÑÔ∏è', multiplier: 1.0, class: 'season-winter' },     // √önor
                2: { name: 'Jaro', icon: 'üå±', multiplier: 1.2, class: 'season-spring' },     // B≈ôezen
                3: { name: 'Jaro', icon: 'üå∏', multiplier: 1.4, class: 'season-spring' },     // Duben
                4: { name: 'Jaro', icon: 'üåº', multiplier: 1.5, class: 'season-spring' },     // Kvƒõten
                5: { name: 'L√©to', icon: '‚òÄÔ∏è', multiplier: 1.8, class: 'season-summer' },     // ƒåerven
                6: { name: 'L√©to', icon: 'üåû', multiplier: 2.0, class: 'season-summer' },     // ƒåervenec
                7: { name: 'L√©to', icon: 'üî•', multiplier: 1.9, class: 'season-summer' },     // Srpen
                8: { name: 'Podzim', icon: 'üçÇ', multiplier: 1.3, class: 'season-autumn' },   // Z√°≈ô√≠
                9: { name: 'Podzim', icon: 'üçÅ', multiplier: 1.1, class: 'season-autumn' },   // ≈ò√≠jen
                10: { name: 'Podzim', icon: 'üåßÔ∏è', multiplier: 1.1, class: 'season-autumn' },  // Listopad
                11: { name: 'Zima', icon: '‚õÑ', multiplier: 1.0, class: 'season-winter' }     // Prosinec
            };

            // Stav hry
            let gameState = {
                money: 100,
                xp: 0,
                level: 1,
                day: 1,
                farm: [],
                inventory: {},
                animals: [],
                upgrades: [],
                economy: [],
                selectedCrop: null,
                farmSize: INITIAL_FARM_SIZE,
                currentSeason: getCurrentRealSeason(),
                lastPlayed: Date.now(),
                growthMultiplier: 1.0,
                lastAutoDay: Date.now(),
                sellMultiplier: 1.0,
                currentSaveSlot: 1,
                maxSaveSlots: 3,
                secretSeedsPlanted: 0,
                secretSeedsBought: 0,
                favoriteCrops: [],
                animalCounts: {}
            };

            // OPTIMALIZOVAN√â: Adventn√≠ stav
            let adventState = {
                year: ADVENT_YEAR,
                claimedDays: [],
                lastClaimedDay: null,
                minimized: true
            };

            // Dostupn√© plodiny
            const crops = [
                { id: 1, name: 'Mrkev', icon: 'ü•ï', cost: 10, growTime: 3, sellPrice: 20, xp: 5, unlocked: true, unlockLevel: 1 },
                { id: 2, name: 'Brambory', icon: 'ü•î', cost: 15, growTime: 4, sellPrice: 30, xp: 8, unlocked: false, unlockLevel: 2 },
                { id: 3, name: 'Kuku≈ôice', icon: 'üåΩ', cost: 20, growTime: 5, sellPrice: 40, xp: 12, unlocked: false, unlockLevel: 3 },
                { id: 4, name: 'Jahody', icon: 'üçì', cost: 25, growTime: 4, sellPrice: 50, xp: 15, unlocked: false, unlockLevel: 4 },
                { id: 5, name: 'D√Ωnƒõ', icon: 'üéÉ', cost: 40, growTime: 6, sellPrice: 80, xp: 20, unlocked: false, unlockLevel: 5 },
                { id: 6, name: 'Brokolice', icon: 'ü•¶', cost: 35, growTime: 5, sellPrice: 60, xp: 18, unlocked: false, unlockLevel: 6 },
                { id: 7, name: 'Papriky', icon: 'ü´ë', cost: 45, growTime: 6, sellPrice: 90, xp: 22, unlocked: false, unlockLevel: 7 },
                { id: 8, name: 'Meloun', icon: 'üçâ', cost: 60, growTime: 8, sellPrice: 120, xp: 30, unlocked: false, unlockLevel: 8 },
                { id: 9, name: 'Ananas', icon: 'üçç', cost: 80, growTime: 10, sellPrice: 200, xp: 40, unlocked: false, unlockLevel: 9 },
                { id: 10, name: 'Draƒç√≠ ovoce', icon: 'üêâ', cost: 500, growTime: 15, sellPrice: 1000, xp: 100, unlocked: false, unlockLevel: 10 },
                { id: 11, name: 'Zlat√° ≈ôepa', icon: 'üåü', cost: 1000, growTime: 20, sellPrice: 2500, xp: 200, unlocked: false, unlockLevel: 12 },
                { id: 12, name: 'K≈ôi≈°≈•√°lov√© jablko', icon: 'üçé', cost: 5000, growTime: 30, sellPrice: 10000, xp: 500, unlocked: false, unlockLevel: 15 },
                { id: 13, name: 'Mandarinka', icon: 'üçä', cost: 10000, growTime: 50, sellPrice: 20000, xp: 1000, unlocked: false, unlockLevel: 50 },
                { id: 14, name: 'Kiwi', icon: 'ü•ù', cost: 50000, growTime: 70, sellPrice: 50000, xp: 5000, unlocked: false, unlockLevel: 100 },
                { id: 15, name: 'Mango', icon: 'ü•≠', cost: 100000, growTime: 100, sellPrice: 200000, xp: 10000, unlocked: false, unlockLevel: 150 },
                { id: 16, name: 'Magick√© sem√≠nko', icon: 'üîÆ', cost: 500000, growTime: 200, sellPrice: 500000, xp: 50000, unlocked: false, unlockLevel: 200 },
                { id: 50, name: 'Halloweensk√° lebka', icon: '‚ò†Ô∏è', cost: 50, growTime: 50, sellPrice: 5000, xp: 5, unlocked: true, unlockLevel: 1000000000, isSecret: true },
                { id: 51, name: 'V√°noƒçn√≠ stromeƒçek', icon: 'üéÑ', cost: 50, growTime: 50, sellPrice: 5000, xp: 5, unlocked: true, unlockLevel: 1, isSecret: false }
            ];

            // Dostupn√° zv√≠≈ôata
            const animals = [
                { id: 1, name: 'Slepice', icon: 'üêî', cost: 50, income: 5, xp: 10, unlocked: true, unlockLevel: 1 },
                { id: 2, name: 'Kr√°l√≠k', icon: 'üêá', cost: 80, income: 8, xp: 15, unlocked: false, unlockLevel: 2 },
                { id: 3, name: 'Ovce', icon: 'üêë', cost: 120, income: 12, xp: 20, unlocked: false, unlockLevel: 3 },
                { id: 4, name: 'Koza', icon: 'üêê', cost: 180, income: 15, xp: 25, unlocked: false, unlockLevel: 4 },
                { id: 5, name: 'Kr√°va', icon: 'üêÑ', cost: 250, income: 20, xp: 30, unlocked: false, unlockLevel: 5 },
                { id: 6, name: 'Prase', icon: 'üêñ', cost: 200, income: 18, xp: 28, unlocked: false, unlockLevel: 6 },
                { id: 7, name: 'K≈Ø≈à', icon: 'üêé', cost: 400, income: 25, xp: 35, unlocked: false, unlockLevel: 7 },
                { id: 8, name: 'Velbloud', icon: 'üê´', cost: 500, income: 30, xp: 40, unlocked: false, unlockLevel: 8 },
                { id: 9, name: 'Slon', icon: 'üêò', cost: 1000, income: 50, xp: 60, unlocked: false, unlockLevel: 9 },
                { id: 10, name: 'Jednoro≈æec', icon: 'ü¶Ñ', cost: 5000, income: 200, xp: 300, unlocked: false, unlockLevel: 10 },
                { id: 11, name: 'F√©nix', icon: 'üî•', cost: 10000, income: 500, xp: 600, unlocked: false, unlockLevel: 12 },
                { id: 12, name: 'Drak', icon: 'üê≤', cost: 50000, income: 2000, xp: 800, unlocked: false, unlockLevel: 15 },
                { id: 13, name: 'Santa', icon: 'üßë‚ÄçüéÑ', cost: 250, income: 100, xp: 1, unlocked: true, unlockLevel: 1, }
            ];

            // Vylep≈°en√≠
            const upgrades = [
                { id: 1, name: 'Lep≈°√≠ konve', icon: 'üö∞', cost: 100, description: 'Rychlej≈°√≠ r≈Øst plodin o 10%', effect: 'growthBoost', value: 0.1, purchased: false },
                { id: 2, name: 'Kvalitn√≠ hnojivo', icon: 'üí©', cost: 200, description: 'Zvy≈°uje cenu prodeje o 15%', effect: 'sellBoost', value: 0.15, purchased: false },
                { id: 3, name: 'Automatick√° z√°vlaha', icon: 'üöø', cost: 300, description: 'Rychlej≈°√≠ r≈Øst plodin o 20%', effect: 'growthBoost', value: 0.2, purchased: false },
                { id: 4, name: 'Sklen√≠k', icon: 'üè≠', cost: 500, description: 'Rychlej≈°√≠ r≈Øst plodin o 30%', effect: 'growthBoost', value: 0.3, purchased: false },
                { id: 5, name: 'Rychlorostouc√≠ semena', icon: '‚ö°', cost: 400, description: 'Rychlej≈°√≠ r≈Øst plodin o 25%', effect: 'growthBoost', value: 0.25, purchased: false },
                { id: 6, name: 'Pokroƒçil√© hnojivo', icon: 'üß™', cost: 600, description: 'Rychlej≈°√≠ r≈Øst plodin o 35%', effect: 'growthBoost', value: 0.35, purchased: false },
                { id: 7, name: 'Zahradn√≠ sk≈ô√≠tci', icon: 'üßö', cost: 800, description: 'Rychlej≈°√≠ r≈Øst plodin o 40%', effect: 'growthBoost', value: 0.4, purchased: false },
                { id: 8, name: 'Z√°zraƒçn√° voda', icon: 'üíß', cost: 1000, description: 'Rychlej≈°√≠ r≈Øst plodin o 50%', effect: 'growthBoost', value: 0.5, purchased: false },
                { id: 9, name: 'Expertn√≠ zemƒõdƒõlec', icon: 'üë®‚Äçüåæ', cost: 1200, description: 'Zvy≈°uje cenu prodeje o 25%', effect: 'sellBoost', value: 0.25, purchased: false },
                { id: 10, name: 'Pr√©miov√° semena', icon: 'üå∞', cost: 1500, description: 'Rychlej≈°√≠ r≈Øst plodin o 60%', effect: 'growthBoost', value: 0.6, purchased: false },
                { id: 11, name: 'Robotick√Ω farm√°≈ô', icon: 'ü§ñ', cost: 2000, description: 'Rychlej≈°√≠ r≈Øst plodin o 75%', effect: 'growthBoost', value: 0.75, purchased: false },
                { id: 12, name: 'Super zahradn√≠k', icon: 'ü™è', cost: 50000, description: 'Zvy≈°uje cenu prodeje o 150%', effect: 'sellBoost', value: 1.5, purchased: false },
                { id: 13, name: 'Magick√° p≈Øda', icon: '‚ú®', cost: 100000, description: 'Rychlej≈°√≠ r≈Øst plodin o 100%', effect: 'growthBoost', value: 1000000.0, purchased: false },
                { id: 14, name: 'Bohat√° p≈Øda', icon: 'üë®‚Äçüåæ', cost: 100000, description: 'Zvy≈°uje cenu prodeje o 200%', effect: 'sellBoost', value: 2.0, purchased: false }
            ];

            // Ekonomick√© investice
            const economyItems = [
                { id: 1, name: 'St√°nek s limon√°dou', icon: 'üçã', cost: 200, income: 10, xp: 20, description: 'Mal√Ω p≈ô√≠jem z prodeje limon√°dy', purchased: false },
                { id: 2, name: 'Farm√°≈ôsk√Ω trh', icon: 'üõí', cost: 500, income: 25, xp: 40, description: 'St√°l√Ω p≈ô√≠jem z prodeje na trhu', purchased: false },
                { id: 3, name: 'Zahradn√≠ kav√°rna', icon: '‚òï', cost: 1000, income: 50, xp: 60, description: 'P≈ô√≠jem z posezen√≠ v kav√°rnƒõ', purchased: false },
                { id: 4, name: 'Agroturistika', icon: 'üè°', cost: 2000, income: 100, xp: 80, description: 'P≈ô√≠jem z turist≈Ø na farmƒõ', purchased: false },
                { id: 5, name: 'Bioobchod', icon: 'üè™', cost: 4000, income: 200, xp: 120, description: 'P≈ô√≠jem z prodeje bio produkt≈Ø', purchased: false },
                { id: 6, name: 'Zemƒõdƒõlsk√° firma', icon: 'üè¢', cost: 8000, income: 400, xp: 200, description: 'Velk√Ω p≈ô√≠jem z velkoobchodu', purchased: false },
                { id: 7, name: 'Investiƒçn√≠ portfolio', icon: 'üíº', cost: 5000000, income: 0, xp: 1000, description: 'Odemyk√° dal≈°√≠ save sloty (a≈æ 5)', purchased: false },
                { id: 8, name: 'Reset farmy', icon: 'üîÑ', cost: 5000000, income: 0, xp: 200, description: 'Resetuje farmu, ale zachov√°v√° level 5 a d√°v√° 10 000 Kƒç', purchased: false }
            ];

            // DOM elementy
            const moneyElement = document.getElementById('money');
            const levelElement = document.getElementById('level');
            const dayElement = document.getElementById('day');
            const xpProgressElement = document.getElementById('xp-progress');
            const xpTextElement = document.getElementById('xp-text');
            const farmElement = document.getElementById('farm');
            const cropsElement = document.getElementById('crops');
            const animalsElement = document.getElementById('animals');
            const selectedCropNameElement = document.getElementById('selected-crop-name');
            const selectedCropIconElement = document.getElementById('selected-crop-icon');
            const farmSizeElement = document.getElementById('farm-size');
            const seasonElement = document.getElementById('season');
            const seasonIconElement = document.getElementById('season-icon');
            const themeToggle = document.getElementById('theme-toggle');
            const saveIndicator = document.getElementById('save-indicator');
            const timeIndicator = document.getElementById('time-indicator');
            const nextDayButton = document.getElementById('next-day');
            const marketButton = document.getElementById('market');
            const upgradesButton = document.getElementById('upgrades');
            const economyButton = document.getElementById('economy');
            const saveGameButton = document.getElementById('save-game');
            const marketModal = document.getElementById('market-modal');
            const upgradesModal = document.getElementById('upgrades-modal');
            const economyModal = document.getElementById('economy-modal');
            const saveModal = document.getElementById('save-modal');
            const levelUpModal = document.getElementById('level-up-modal');
            const loadGameModal = document.getElementById('load-game-modal');
            const resetConfirmModal = document.getElementById('reset-confirm-modal');
            const loadGameYesButton = document.getElementById('load-game-yes');
            const loadGameNoButton = document.getElementById('load-game-no');
            const resetConfirmYesButton = document.getElementById('reset-confirm-yes');
            const resetConfirmNoButton = document.getElementById('reset-confirm-no');

            // OPTIMALIZOVAN√â: DOM elementy pro adventn√≠ kalend√°≈ô
            const adventContainer = document.getElementById('advent-container');
            const adventCalendarElement = document.getElementById('advent-calendar');
            const adventMinimizedElement = document.getElementById('advent-minimized');
            const adventMinimizeBtn = document.getElementById('advent-minimize-btn');
            const adventGridElement = document.getElementById('advent-grid');
            const adventCountdownElement = document.getElementById('advent-countdown');
            const adventBadgeElement = document.getElementById('advent-badge');
            const adventModal = document.getElementById('advent-modal');
            const adventRewardContentElement = document.getElementById('advent-reward-content');

            // Inicializace hry
            function initGame() {
                loadGame();
                updateUI();
                renderFarm();
                renderCrops();
                renderAnimals();
                updateSeason();
                setupEventListeners();
                
                checkUnlocks();
                
                // OPTIMALIZOVAN√â: Inicializace adventn√≠ho kalend√°≈ôe
                initAdventCalendar();
                
                setInterval(autoSave, 30000);
                setInterval(collectIncome, 60000);
                setInterval(autoNextDay, AUTO_DAY_INTERVAL);
                checkElapsedTime();
            }

            // OPTIMALIZOVAN√â: Inicializace adventn√≠ho kalend√°≈ôe
            function initAdventCalendar() {
                loadAdventState();
                
                const today = new Date();
                const currentYear = today.getFullYear();
                const currentMonth = today.getMonth();
                const currentDay = today.getDate();
                
                // Zobraz kalend√°≈ô pouze v prosinci 2025
                if (currentYear === ADVENT_YEAR && currentMonth === ADVENT_MONTH) {
                    updateAdventCountdown(currentDay);
                    renderAdventCalendar(currentDay);
                    
                    // Zobraz minimalizovanou nebo norm√°ln√≠ verzi
                    if (adventState.minimized) {
                        adventCalendarElement.style.display = 'none';
                        adventMinimizedElement.style.display = 'flex';
                    } else {
                        adventCalendarElement.style.display = 'block';
                        adventMinimizedElement.style.display = 'none';
                    }
                    
                    updateAdventBadge(currentDay);
                }
            }

            // Naƒçten√≠ adventn√≠ho stavu
            function loadAdventState() {
                const savedAdvent = localStorage.getItem(ADVENT_SAVE_KEY);
                const savedMinimized = localStorage.getItem(ADVENT_MINIMIZED_KEY);
                
                if (savedAdvent) {
                    try {
                        const parsed = JSON.parse(savedAdvent);
                        if (parsed.year === ADVENT_YEAR) {
                            adventState = parsed;
                        }
                    } catch (e) {
                        console.error('Chyba p≈ôi naƒç√≠t√°n√≠ adventn√≠ho stavu:', e);
                    }
                }
                
                if (savedMinimized === 'true') {
                    adventState.minimized = true;
                }
            }

            // Ulo≈æen√≠ adventn√≠ho stavu
            function saveAdventState() {
                localStorage.setItem(ADVENT_SAVE_KEY, JSON.stringify(adventState));
                localStorage.setItem(ADVENT_MINIMIZED_KEY, adventState.minimized.toString());
            }

            // Aktualizace countdownu
            function updateAdventCountdown(currentDay) {
                if (currentDay <= ADVENT_END_DAY) {
                    const daysLeft = ADVENT_END_DAY - currentDay;
                    adventCountdownElement.textContent = `${daysLeft} dn√≠ do V√°noc`;
                } else {
                    adventCountdownElement.textContent = '≈†≈§ASTN√â V√ÅNOCE! üéÑ';
                }
            }

            // Aktualizace badge (poƒçet dostupn√Ωch odmƒõn)
            function updateAdventBadge(currentDay) {
                let availableCount = 0;
                for (let day = 1; day <= ADVENT_END_DAY; day++) {
                    if (day <= currentDay && !adventState.claimedDays.includes(day)) {
                        availableCount++;
                    }
                }
                
                if (availableCount > 0) {
                    adventBadgeElement.textContent = availableCount;
                    adventBadgeElement.style.display = 'flex';
                } else {
                    adventBadgeElement.style.display = 'none';
                }
            }

            // OPTIMALIZOVAN√â: Vykreslen√≠ adventn√≠ho kalend√°≈ôe
            function renderAdventCalendar(currentDay) {
                adventGridElement.innerHTML = '';
                
                for (let day = 1; day <= ADVENT_END_DAY; day++) {
                    const dayElement = document.createElement('div');
                    const isLocked = day > currentDay;
                    const isClaimed = adventState.claimedDays.includes(day);
                    const isChristmas = day === CHRISTMAS_DAY;
                    
                    // POUZE 24. prosince je speci√°ln√≠
                    let className = 'advent-day';
                    if (isLocked) className += ' locked';
                    if (isClaimed) className += ' claimed';
                    if (!isLocked && !isClaimed) className += ' unlocked';
                    if (isChristmas) className += ' ultra-luck'; // POUZE tady
                    
                    dayElement.className = className;
                    dayElement.dataset.day = day;
                    
                    // Zjednodu≈°en√Ω obsah pro lep≈°√≠ v√Ωkon
                    dayElement.innerHTML = `
                        <div class="advent-number">${day}</div>
                        ${isChristmas ? '<div class="advent-reward" style="color: gold; font-weight: bold;">ULTRA LUCK!</div>' : 
                                       '<div class="advent-reward">Norm√°ln√≠ odmƒõna</div>'}
                    `;
                    
                    if (!isLocked && !isClaimed) {
                        dayElement.addEventListener('click', () => claimAdventReward(day));
                    }
                    
                    adventGridElement.appendChild(dayElement);
                }
            }

            // Minimalizace adventn√≠ho kalend√°≈ôe
            function toggleAdventMinimize() {
                adventState.minimized = !adventState.minimized;
                
                if (adventState.minimized) {
                    adventCalendarElement.style.display = 'none';
                    adventMinimizedElement.style.display = 'flex';
                } else {
                    adventCalendarElement.style.display = 'block';
                    adventMinimizedElement.style.display = 'none';
                }
                
                saveAdventState();
            }

            // Rozbalen√≠ adventn√≠ho kalend√°≈ôe z minimalizovan√© ikony
            function expandAdventCalendar() {
                adventState.minimized = false;
                adventCalendarElement.style.display = 'block';
                adventMinimizedElement.style.display = 'none';
                saveAdventState();
            }

            // OPTIMALIZOVAN√â: Z√≠sk√°n√≠ adventn√≠ odmƒõny
            function claimAdventReward(day) {
                if (adventState.claimedDays.includes(day)) {
                    showSaveIndicator('Tento den u≈æ jsi vyzvedl!', true);
                    return;
                }
                
                // Z√≠sk√°n√≠ odmƒõny podle dne
                const reward = getAdventReward(day);
                
                // Aplikace odmƒõny
                applyAdventReward(reward);
                
                // Ulo≈æen√≠ stavu
                adventState.claimedDays.push(day);
                adventState.lastClaimedDay = day;
                saveAdventState();
                
                // Zobrazen√≠ modalu
                showAdventRewardModal(day, reward);
                
                // Aktualizace kalend√°≈ôe a badge
                const today = new Date().getDate();
                renderAdventCalendar(today);
                updateAdventBadge(today);
            }

            // OPTIMALIZOVAN√â: Z√≠sk√°n√≠ adventn√≠ odmƒõny - POUZE 24.12. ULTRA LUCK
            function getAdventReward(day) {
                // POUZE 24. prosince - ULTRA LUCK
                if (day === CHRISTMAS_DAY) {
                    return {
                        type: 'christmas_mega',
                        icon: 'üéÑ',
                        name: 'V√ÅNOƒåN√ç MEGA ODƒöMNA',
                        day: day
                    };
                }
                
                // Ostatn√≠ dny - NORM√ÅLN√ç odmƒõny (zjednodu≈°en√©)
                const normalRewards = [
                    { type: 'money', min: 100, max: 1500, weight: 150 },
                    { type: 'xp', min: 50, max: 2000, weight: 500 },
                    { type: 'any_crop', weight: 85 }
                ];
                
                // Jednoduch√Ω v√Ωbƒõr odmƒõny
                const totalWeight = normalRewards.reduce((sum, r) => sum + r.weight, 0);
                let random = Math.random() * totalWeight;
                
                for (const reward of normalRewards) {
                    if (random < reward.weight) {
                        const simpleReward = { ...reward };
                        
                        if (simpleReward.type === 'money') {
                            simpleReward.amount = Math.floor(simpleReward.min + Math.random() * (simpleReward.max - simpleReward.min));
                        } else if (simpleReward.type === 'xp') {
                            simpleReward.amount = Math.floor(simpleReward.min + Math.random() * (simpleReward.max - simpleReward.min));
                        } else if (simpleReward.type === 'common_crop') {
                            // Pouze bƒõ≈æn√© plodiny
                            const commonCrops = crops.filter(c => !c.isSecret && c.cost <= 100);
                            simpleReward.crop = commonCrops[Math.floor(Math.random() * commonCrops.length)];
                            simpleReward.amount = 1;
                        }
                        
                        return simpleReward;
                    }
                    random -= reward.weight;
                }
                
                // Fallback
                return { type: 'money', amount: 100 };
            }

            // OPTIMALIZOVAN√â: Aplikace adventn√≠ odmƒõny
            function applyAdventReward(reward) {
                if (reward.type === 'christmas_mega') {
                    // MEGA ULTRA LUCK 24. PROSINCE!
                    
                    // 1. Odemkni V≈†ECHNY plodiny!
                    crops.forEach(crop => {
                        if (!crop.isSecret) {
                            crop.unlocked = false;
                        }
                    });
                    
                    // 2. Mega pen√≠ze
                    const megaMoney = 10000 + Math.floor(Math.random() * 90000);
                    gameState.money += megaMoney;
                    
                    // 3. Mega XP
                    const megaXP = 5000 + Math.floor(Math.random() * 45000);
                    addXP(megaXP);
                    
                    // 4. V≈°echny vylep≈°en√≠ ZDARMA
                    upgrades.forEach(upgrade => {
                        if (!gameState.upgrades.includes(upgrade.id)) {
                            gameState.upgrades.push(upgrade.id);
                            applyUpgradeEffect(upgrade);
                        }
                    });
                    
                    // 6. Speci√°ln√≠ v√°noƒçn√≠ plodina
                    if (!gameState.inventory[99]) {
                        gameState.inventory[99] = 10; // 10 kus≈Ø
                    } else {
                        gameState.inventory[99] += 10;
                    }
                    
                    showSaveIndicator('üéÑ V√ÅNOƒåN√ç MEGA ULTRA LUCK! Z√≠skal jsi V≈†ECHNO! üéÑ', false);
                    
                } else if (reward.type === 'money') {
                    gameState.money += reward.amount;
                    showSaveIndicator(`Z√≠sk√°v√°≈° ${reward.amount} Kƒç`);
                    
                } else if (reward.type === 'xp') {
                    addXP(reward.amount);
                    showSaveIndicator(`Z√≠sk√°v√°≈° ${reward.amount} XP`);
                    
                } else if (reward.type === 'common_crop') {
                    const crop = reward.crop;
                    if (!gameState.inventory[crop.id]) {
                        gameState.inventory[crop.id] = 0;
                    }
                    gameState.inventory[crop.id] += reward.amount;
                    showSaveIndicator(`Z√≠sk√°v√°≈° ${reward.amount}x ${crop.name}`);
                }
                
                updateUI();
                renderFarm();
                renderCrops();
            }

            // OPTIMALIZOVAN√â: Zobrazen√≠ adventn√≠ho modalu
            function showAdventRewardModal(day, reward) {
                let modalContent = '';
                
                if (day === CHRISTMAS_DAY) {
                    // EXTRA ZJEDNODU≈†EN√ù modal pro 24.12.
                    modalContent = `
                        <div style="background: linear-gradient(135deg, gold, orange); padding: 20px; border-radius: 10px; margin: 20px 0; border: 5px solid red;">
                            <h3 style="color: red; font-size: 2rem;">üéÖ V√ÅNOƒåN√ç ULTRA LUCK! üéÖ</h3>
                            <p style="font-size: 1.2rem; color: #000; font-weight: bold;">
                                DEN 24. PROSINCE - MEGA ODƒöMNA!
                            </p>
                            <div style="background: white; padding: 15px; border-radius: 10px; margin: 15px 0; text-align: left;">
                                <p><strong>‚úÖ Mega pen√≠ze</strong></p>
                                <p><strong>‚úÖ Mega XP</strong></p>
                                <p><strong>‚úÖ V≈°echna vylep≈°en√≠</strong></p>
                                <p><strong>‚úÖ V√°noƒçn√≠ speci√°l</strong></p>
                            </div>
                            <p style="color: green; font-size: 1.3rem; font-weight: bold;">
                                ≈†≈§ASTN√â V√ÅNOCE! üéÅ
                            </p>
                        </div>
                    `;
                } else {
                    // Norm√°ln√≠ modal pro ostatn√≠ dny
                    const rewardText = reward.type === 'money' ? `${reward.amount} Kƒç` :
                                      reward.type === 'xp' ? `${reward.amount} XP` :
                                      `${reward.amount}x ${reward.crop.name}`;
                    
                    modalContent = `
                        <div style="background: #4CAF50; padding: 20px; border-radius: 10px; margin: 20px 0;">
                            <h3 style="color: white;">Adventn√≠ odmƒõna - Den ${day}</h3>
                            <div style="font-size: 2rem; margin: 15px 0;">
                                ${reward.type === 'money' ? 'üí∞' : 
                                  reward.type === 'xp' ? '‚≠ê' : 
                                  reward.crop?.icon || 'üéÅ'}
                            </div>
                            <p style="font-size: 1.5rem; color: white; font-weight: bold;">
                                ${rewardText}
                            </p>
                        </div>
                    `;
                }
                
                adventRewardContentElement.innerHTML = modalContent;
                adventModal.style.display = 'flex';
            }

            // Kontrola uplynul√©ho ƒçasu od posledn√≠ho ulo≈æen√≠
            function checkElapsedTime() {
                const now = Date.now();
                const timeSinceLastAutoDay = now - gameState.lastAutoDay;
                
                if (timeSinceLastAutoDay >= AUTO_DAY_INTERVAL) {
                    const daysPassed = Math.floor(timeSinceLastAutoDay / AUTO_DAY_INTERVAL);
                    
                    if (daysPassed > 0) {
                        for (let i = 0; i < daysPassed; i++) {
                            processAutoDay();
                        }
                        
                        gameState.lastAutoDay = now;
                        updateUI();
                        renderFarm();
                        showTimeIndicator(`Bƒõhem tv√© nep≈ô√≠tomnosti ubƒõhlo ${daysPassed} dn√≠!`);
                        autoSave();
                    }
                }
            }

            // Automatick√Ω p≈ôechod na dal≈°√≠ den
            function autoNextDay() {
                processAutoDay();
                gameState.lastAutoDay = Date.now();
                updateUI();
                renderFarm();
                showTimeIndicator('Automaticky ubƒõhl den!');
                autoSave();
            }

            // Zpracov√°n√≠ automatick√©ho dne
            function processAutoDay() {
                gameState.day++;
                
                if (gameState.day % 30 === 0) {
                    updateSeason();
                }
                
                gameState.farm.forEach(plot => {
                    if (plot.state === 'planted') {
                        const crop = crops.find(c => c.id === plot.cropId);
                        if (crop) {
                            const baseGrowthRate = 100 / plot.growTime;
                            const seasonMultiplier = gameState.currentSeason.multiplier;
                            const upgradeMultiplier = gameState.growthMultiplier;
                            const totalMultiplier = seasonMultiplier * upgradeMultiplier;
                            const growthRate = baseGrowthRate * totalMultiplier;
                            
                            plot.progress += growthRate;
                            
                            if (plot.progress >= 100) {
                                plot.state = 'ready';
                                plot.progress = 100;
                            }
                            
                            if (plot.state === 'ready' && gameState.day - plot.daysPlanted > plot.growTime + 3) {
                                plot.state = 'withered';
                            }
                        }
                    }
                });
                
                collectIncome();
            }

            // P≈ô√≠jem od zv√≠≈ôat a ekonomiky
            function collectIncome() {
                let totalIncome = 0;
                
                Object.keys(gameState.animalCounts).forEach(animalId => {
                    const animal = animals.find(a => a.id === parseInt(animalId));
                    if (animal) {
                        totalIncome += animal.income * gameState.animalCounts[animalId];
                    }
                });
                
                gameState.economy.forEach(economyId => {
                    const economyItem = economyItems.find(e => e.id === economyId);
                    if (economyItem) {
                        totalIncome += economyItem.income;
                    }
                });
                
                if (totalIncome > 0) {
                    gameState.money += totalIncome;
                    updateUI();
                }
            }

            // Zobrazen√≠ indik√°toru ƒçasu
            function showTimeIndicator(message) {
                timeIndicator.textContent = message;
                timeIndicator.classList.add('show');
                
                setTimeout(() => {
                    timeIndicator.classList.remove('show');
                }, 5000);
            }

            // Naƒçten√≠ hry z localStorage
            function loadGame() {
                const savedTheme = localStorage.getItem(THEME_KEY);
                const currentSlot = localStorage.getItem(CURRENT_SAVE_SLOT_KEY) || '1';
                gameState.currentSaveSlot = parseInt(currentSlot);
                
                if (savedTheme === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                }
                
                const saveKey = SAVE_KEY_PREFIX + gameState.currentSaveSlot;
                const savedGame = localStorage.getItem(saveKey);
                
                if (!savedGame) {
                    initializeNewGame();
                    return;
                }
                
                try {
                    const parsedGame = JSON.parse(savedGame);
                    
                    if (parsedGame && typeof parsedGame.money === 'number') {
                        if (!parsedGame.favoriteCrops) parsedGame.favoriteCrops = [];
                        if (!parsedGame.animalCounts) parsedGame.animalCounts = {};
                        if (!parsedGame.secretSeedsBought) parsedGame.secretSeedsBought = 0;
                        
                        loadGameModal.style.display = 'flex';
                    } else {
                        initializeNewGame();
                    }
                } catch (e) {
                    console.error('Chyba p≈ôi naƒç√≠t√°n√≠ hry:', e);
                    initializeNewGame();
                }
            }

            // Inicializace nov√© hry
            function initializeNewGame() {
                gameState = {
                    money: 100,
                    xp: 0,
                    level: 1,
                    day: 1,
                    farm: Array(INITIAL_FARM_SIZE).fill().map(() => ({ state: 'empty', progress: 0 })),
                    inventory: {},
                    animals: [],
                    upgrades: [],
                    economy: [],
                    selectedCrop: null,
                    farmSize: INITIAL_FARM_SIZE,
                    currentSeason: getCurrentRealSeason(),
                    lastPlayed: Date.now(),
                    growthMultiplier: 1.0,
                    lastAutoDay: Date.now(),
                    sellMultiplier: 1.0,
                    currentSaveSlot: gameState.currentSaveSlot || 1,
                    maxSaveSlots: 3,
                    secretSeedsPlanted: 0,
                    secretSeedsBought: 0,
                    favoriteCrops: [],
                    animalCounts: {}
                };
                saveGame();
            }

            // Nastaven√≠ event listener≈Ø
            function setupEventListeners() {
                themeToggle.addEventListener('click', toggleTheme);
                
                nextDayButton.addEventListener('click', () => {
                    nextDay();
                    showSaveIndicator('Manu√°lnƒõ ubƒõhl den!');
                });
                
                marketButton.addEventListener('click', () => openModal('market'));
                upgradesButton.addEventListener('click', () => openModal('upgrades'));
                economyButton.addEventListener('click', () => openModal('economy'));
                saveGameButton.addEventListener('click', () => openModal('save'));
                
                loadGameYesButton.addEventListener('click', loadSavedGame);
                loadGameNoButton.addEventListener('click', startNewGame);
                
                resetConfirmYesButton.addEventListener('click', resetFarm);
                resetConfirmNoButton.addEventListener('click', () => {
                    resetConfirmModal.style.display = 'none';
                });
                
                // OPTIMALIZOVAN√â: Event listenery pro adventn√≠ kalend√°≈ô
                adventMinimizeBtn.addEventListener('click', toggleAdventMinimize);
                adventMinimizedElement.addEventListener('click', expandAdventCalendar);
                
                document.querySelectorAll('.close-modal, .close-modal-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        document.querySelectorAll('.modal').forEach(modal => {
                            modal.style.display = 'none';
                        });
                    });
                });
                
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', function(e) {
                        if (e.target === modal) {
                            modal.style.display = 'none';
                        }
                    });
                });
            }

            // P≈ôep√≠n√°n√≠ svƒõtl√©ho/tmav√©ho re≈æimu
            function toggleTheme() {
                document.body.classList.toggle('dark-mode');
                if (document.body.classList.contains('dark-mode')) {
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                    localStorage.setItem(THEME_KEY, 'dark');
                } else {
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                    localStorage.setItem(THEME_KEY, 'light');
                }
            }

            // Naƒçten√≠ ulo≈æen√© hry
            function loadSavedGame() {
                const saveKey = SAVE_KEY_PREFIX + gameState.currentSaveSlot;
                const savedGame = localStorage.getItem(saveKey);
                if (savedGame) {
                    try {
                        const parsedGame = JSON.parse(savedGame);
                        gameState = parsedGame;
                        
                        if (gameState.growthMultiplier === undefined) gameState.growthMultiplier = 1.0;
                        if (gameState.lastAutoDay === undefined) gameState.lastAutoDay = Date.now();
                        if (gameState.sellMultiplier === undefined) gameState.sellMultiplier = 1.0;
                        if (gameState.economy === undefined) gameState.economy = [];
                        if (gameState.currentSaveSlot === undefined) gameState.currentSaveSlot = 1;
                        if (gameState.maxSaveSlots === undefined) gameState.maxSaveSlots = 3;
                        if (gameState.secretSeedsPlanted === undefined) gameState.secretSeedsPlanted = 0;
                        if (gameState.favoriteCrops === undefined) gameState.favoriteCrops = [];
                        if (gameState.animalCounts === undefined) gameState.animalCounts = {};
                        if (gameState.secretSeedsBought === undefined) gameState.secretSeedsBought = 0;
                        
                        loadGameModal.style.display = 'none';
                        updateUI();
                        renderFarm();
                        renderCrops();
                        renderAnimals();
                        updateSeason();
                        checkUnlocks();
                        showSaveIndicator('Hra naƒçtena!');
                    } catch (e) {
                        console.error('Chyba p≈ôi naƒç√≠t√°n√≠ hry:', e);
                        initializeNewGame();
                    }
                }
            }

            // Zaƒç√≠t novou hru
            function startNewGame() {
                initializeNewGame();
                loadGameModal.style.display = 'none';
                updateUI();
                renderFarm();
                renderCrops();
                renderAnimals();
                updateSeason();
            }

            // Reset farmy
            function resetFarm() {
                const currentSaveSlot = gameState.currentSaveSlot;
                const maxSaveSlots = gameState.maxSaveSlots;
                
                gameState = {
                    money: 10000,
                    xp: 100,
                    level: 5,
                    day: 1,
                    farm: Array(INITIAL_FARM_SIZE).fill().map(() => ({ state: 'empty', progress: 0 })),
                    inventory: {},
                    animals: [],
                    upgrades: [],
                    economy: [],
                    selectedCrop: null,
                    farmSize: INITIAL_FARM_SIZE,
                    currentSeason: getCurrentRealSeason(),
                    lastPlayed: Date.now(),
                    growthMultiplier: 1.0,
                    lastAutoDay: Date.now(),
                    sellMultiplier: 1.0,
                    currentSaveSlot: currentSaveSlot,
                    maxSaveSlots: maxSaveSlots,
                    secretSeedsPlanted: 0,
                    secretSeedsBought: 0,
                    favoriteCrops: [],
                    animalCounts: {}
                };
                
                resetConfirmModal.style.display = 'none';
                updateUI();
                renderFarm();
                renderCrops();
                renderAnimals();
                checkUnlocks();
                showSaveIndicator('Farma resetov√°na! Z√≠skal jsi 10 000 Kƒç, 100 XP a level 5!');
                saveGame();
            }

            // Z√≠sk√°n√≠ aktu√°ln√≠ho re√°ln√©ho roƒçn√≠ho obdob√≠
            function getCurrentRealSeason() {
                const now = new Date();
                const month = now.getMonth();
                return REAL_SEASONS[month];
            }

            // Aktualizace roƒçn√≠ho obdob√≠
            function updateSeason() {
                const season = getCurrentRealSeason();
                gameState.currentSeason = season;
                seasonElement.textContent = season.name;
                seasonElement.className = `season-indicator ${season.class}`;
                seasonIconElement.textContent = season.icon;
            }

            // Vykreslen√≠ farmy
            function renderFarm() {
                farmElement.innerHTML = '';
                for (let i = 0; i < gameState.farmSize; i++) {
                    const plot = document.createElement('div');
                    plot.className = `plot ${gameState.farm[i]?.state || 'empty'}`;
                    plot.dataset.index = i;
                    
                    if (gameState.farm[i]?.state === 'empty') {
                        plot.innerHTML = '<i class="fas fa-seedling"></i>';
                    } else if (gameState.farm[i]?.state === 'planted') {
                        const crop = crops.find(c => c.id === gameState.farm[i].cropId);
                        plot.innerHTML = `
                            <div>${crop?.icon || 'üå±'}</div>
                            <div class="progress-bar">
                                <div class="progress" style="width: ${gameState.farm[i].progress}%"></div>
                            </div>
                        `;
                    } else if (gameState.farm[i]?.state === 'ready') {
                        const crop = crops.find(c => c.id === gameState.farm[i].cropId);
                        plot.innerHTML = `<div>${crop?.icon || 'üå±'}</div><small>SKLIDIT</small>`;
                    } else if (gameState.farm[i]?.state === 'withered') {
                        plot.innerHTML = '<div>üåµ</div><small>USCHL√â</small>';
                    }
                    
                    plot.addEventListener('click', () => handlePlotClick(i));
                    farmElement.appendChild(plot);
                }
            }

            // Kliknut√≠ na pole
            function handlePlotClick(index) {
                const plot = gameState.farm[index];
                
                if (plot.state === 'empty' && gameState.selectedCrop) {
                    const crop = crops.find(c => c.id === gameState.selectedCrop);
                    
                    if (crop.isSecret && crop.id === 50) {
                        // Lebka nem√° ≈æ√°dn√Ω limit n√°kupu
                    }
                    
                    if (gameState.money >= crop.cost) {
                        gameState.money -= crop.cost;
                        plot.state = 'planted';
                        plot.cropId = crop.id;
                        plot.progress = 0;
                        
                        if (crop.isSecret) {
                            gameState.secretSeedsPlanted++;
                            gameState.secretSeedsBought++;
                        }
                        
                        const baseGrowTime = crop.growTime;
                        const seasonMultiplier = gameState.currentSeason.multiplier;
                        const upgradeMultiplier = gameState.growthMultiplier;
                        const totalMultiplier = seasonMultiplier * upgradeMultiplier;
                        
                        plot.growTime = Math.max(1, Math.round(baseGrowTime / totalMultiplier));
                        plot.daysPlanted = gameState.day;
                        
                        updateUI();
                        renderFarm();
                        renderCrops();
                        showSaveIndicator(`Vysazeno: ${crop.name}`);
                    } else {
                        showSaveIndicator('Nem√°≈° dostatek penƒõz!', true);
                    }
                } else if (plot.state === 'ready') {
                    const crop = crops.find(c => c.id === plot.cropId);
                    if (crop) {
                        if (!gameState.inventory[crop.id]) {
                            gameState.inventory[crop.id] = 0;
                        }
                        gameState.inventory[crop.id]++;
                        
                        addXP(crop.xp);
                        
                        if (crop.isSecret) {
                            gameState.secretSeedsPlanted--;
                        }
                        
                        plot.state = 'empty';
                        plot.progress = 0;
                        delete plot.cropId;
                        
                        updateUI();
                        renderFarm();
                        showSaveIndicator(`Sklizeno: ${crop.name}`);
                    }
                } else if (plot.state === 'withered') {
                    const crop = crops.find(c => c.id === plot.cropId);
                    
                    if (crop && crop.isSecret) {
                        gameState.secretSeedsPlanted--;
                    }
                    
                    plot.state = 'empty';
                    plot.progress = 0;
                    delete plot.cropId;
                    updateUI();
                    renderFarm();
                    showSaveIndicator('Uschl√° plodina odstranƒõna');
                }
            }

            // P≈ôechod na dal≈°√≠ den (manu√°ln√≠)
            function nextDay() {
                gameState.day++;
                gameState.lastAutoDay = Date.now();
                
                if (gameState.day % 30 === 0) {
                    updateSeason();
                }
                
                let anyGrowth = false;
                gameState.farm.forEach(plot => {
                    if (plot.state === 'planted') {
                        const crop = crops.find(c => c.id === plot.cropId);
                        if (crop) {
                            const baseGrowthRate = 100 / plot.growTime;
                            const seasonMultiplier = gameState.currentSeason.multiplier;
                            const upgradeMultiplier = gameState.growthMultiplier;
                            const totalMultiplier = seasonMultiplier * upgradeMultiplier;
                            const growthRate = baseGrowthRate * totalMultiplier;
                            
                            plot.progress += growthRate;
                            
                            if (plot.progress >= 100) {
                                plot.state = 'ready';
                                plot.progress = 100;
                            }
                            
                            if (plot.state === 'ready' && gameState.day - plot.daysPlanted > plot.growTime + 3) {
                                plot.state = 'withered';
                            }
                            
                            anyGrowth = true;
                        }
                    }
                });
                
                collectIncome();
                
                updateUI();
                renderFarm();
                
                autoSave();
            }

            // P≈ôid√°n√≠ XP
            function addXP(amount) {
                gameState.xp += amount;
                const xpNeeded = gameState.level * 100;
                
                if (gameState.xp >= xpNeeded) {
                    gameState.level++;
                    gameState.xp = gameState.xp - xpNeeded;
                    showLevelUpModal();
                }
                
                updateUI();
                checkUnlocks();
            }

            // Zobrazen√≠ modalu pro level up
            function showLevelUpModal() {
                const newLevelElement = document.getElementById('new-level');
                const benefitsElement = document.getElementById('level-up-benefits');
                
                newLevelElement.textContent = gameState.level;
                
                let benefits = '';
                if (gameState.level === 2) {
                    benefits = 'Odemkl jsi brambory a kr√°l√≠ky!';
                } else if (gameState.level === 3) {
                    benefits = 'Odemkl jsi kuku≈ôici a ovce!';
                } else if (gameState.level === 4) {
                    benefits = 'Odemkl jsi jahody a kozy!';
                } else if (gameState.level === 5) {
                    benefits = 'Odemkl jsi d√Ωnƒõ a kr√°vu!';
                } else if (gameState.level === 6) {
                    benefits = 'Odemkl jsi brokolici a prase!';
                } else if (gameState.level === 7) {
                    benefits = 'Odemkl jsi papriky a konƒõ!';
                } else if (gameState.level === 8) {
                    benefits = 'Odemkl jsi meloun a velblouda!';
                } else if (gameState.level === 9) {
                    benefits = 'Odemkl jsi ananas a slona!';
                } else if (gameState.level === 10) {
                    benefits = 'Odemkl jsi draƒç√≠ ovoce a jednoro≈æce!';
                } else if (gameState.level === 12) {
                    benefits = 'Odemkl jsi zlatou ≈ôepu a f√©nixa!';
                } else if (gameState.level === 15) {
                    benefits = 'Odemkl jsi k≈ôi≈°≈•√°lov√© jablko a draka!';
                } else if (gameState.level === 200) {
                    benefits = 'Odemkl jsi MAGICK√â SEM√çNKO!';
                } else {
                    benefits = 'Z√≠sk√°v√°≈° bonusov√© pen√≠ze a nov√© mo≈ænosti!';
                }
                
                benefitsElement.textContent = benefits;
                levelUpModal.style.display = 'flex';
            }

            // Kontrola odemƒçen√≠ plodin a zv√≠≈ôat
            function checkUnlocks() {
                crops.forEach(crop => {
                    crop.unlocked = gameState.level >= crop.unlockLevel;
                });
                
                animals.forEach(animal => {
                    animal.unlocked = gameState.level >= animal.unlockLevel;
                });
                
                renderCrops();
                renderAnimals();
            }

            // Vykreslen√≠ plodin
            function renderCrops() {
                cropsElement.innerHTML = '';
                crops.forEach(crop => {
                    if (crop.isSecret && gameState.level < 1000000000) {
                        return;
                    }
                    
                    const cropElement = document.createElement('div');
                    const isFavorited = gameState.favoriteCrops.includes(crop.id);
                    
                    cropElement.className = `crop-item ${crop.unlocked ? '' : 'locked'} ${gameState.selectedCrop === crop.id ? 'selected' : ''} ${isFavorited ? 'favorited' : ''}`;
                    
                    if (crop.unlocked) {
                        const canBuySecret = !crop.isSecret || (crop.isSecret && crop.id === 50) || (crop.isSecret && gameState.secretSeedsBought < MAX_SECRET_SEEDS);
                        const canPlantSecret = !crop.isSecret || (crop.isSecret && crop.id === 50) || (crop.isSecret && gameState.secretSeedsPlanted < MAX_SECRET_SEEDS);
                        
                        cropElement.innerHTML = `
                            <div class="crop-icon">${crop.icon}</div>
                            <div class="crop-name">${crop.name}</div>
                            <div class="crop-cost">${crop.cost} Kƒç</div>
                            <div class="crop-time">${crop.growTime} dn√≠</div>
                            ${crop.isSecret && crop.id === 50 ? `<div class="crop-locked">SPECI√ÅLN√ç SECRET</div>` : ''}
                            <button class="favorite-toggle ${isFavorited ? 'favorited' : ''}">
                                <i class="fas ${isFavorited ? 'fa-star' : 'fa-star'}"></i>
                            </button>
                        `;
                        
                        if (canBuySecret && canPlantSecret) {
                            cropElement.addEventListener('click', (e) => {
                                if (!e.target.closest('.favorite-toggle')) {
                                    selectCrop(crop.id);
                                }
                            });
                            
                            const favoriteButton = cropElement.querySelector('.favorite-toggle');
                            favoriteButton.addEventListener('click', (e) => {
                                e.stopPropagation();
                                toggleFavoriteCrop(crop.id);
                            });
                        } else {
                            cropElement.classList.add('locked');
                            cropElement.style.cursor = 'not-allowed';
                            if (crop.isSecret && crop.id !== 50) {
                                cropElement.title = `M≈Ø≈æe≈° koupit maxim√°lnƒõ ${MAX_SECRET_SEEDS} secret sem√≠nek za celou hru`;
                            }
                        }
                    } else {
                        cropElement.innerHTML = `
                            <div class="crop-icon">${crop.icon}</div>
                            <div class="crop-name">${crop.name}</div>
                            <div class="crop-locked">Level ${crop.unlockLevel}</div>
                        `;
                    }
                    
                    cropsElement.appendChild(cropElement);
                });
            }

            // P≈ôepnut√≠ obl√≠ben√© plodiny
            function toggleFavoriteCrop(cropId) {
                const index = gameState.favoriteCrops.indexOf(cropId);
                if (index === -1) {
                    gameState.favoriteCrops.push(cropId);
                    showSaveIndicator('P≈ôid√°no do obl√≠ben√Ωch');
                } else {
                    gameState.favoriteCrops.splice(index, 1);
                    showSaveIndicator('Odebr√°no z obl√≠ben√Ωch');
                }
                renderCrops();
                saveGame();
            }

            // V√Ωbƒõr plodiny
            function selectCrop(cropId) {
                gameState.selectedCrop = cropId;
                const crop = crops.find(c => c.id === cropId);
                selectedCropNameElement.textContent = crop.name;
                selectedCropIconElement.textContent = crop.icon;
                renderCrops();
            }

            // Vykreslen√≠ zv√≠≈ôat
            function renderAnimals() {
                animalsElement.innerHTML = '';
                animals.forEach(animal => {
                    const animalElement = document.createElement('div');
                    const animalCount = gameState.animalCounts[animal.id] || 0;
                    const canSell = animalCount > 0;
                    
                    animalElement.className = `animal-item ${animal.unlocked ? '' : 'locked'}`;
                    
                    if (animal.unlocked) {
                        animalElement.innerHTML = `
                            <div class="animal-icon">${animal.icon}</div>
                            <div class="animal-name">${animal.name}</div>
                            <div class="animal-cost">${animal.cost} Kƒç</div>
                            <div class="animal-income">+${animal.income} Kƒç/den</div>
                            ${animalCount > 0 ? `<div class="animal-count">M√°≈°: ${animalCount}</div>` : ''}
                            <div class="animal-actions">
                                <button class="buy-animal">Koupit</button>
                                ${canSell ? `<button class="sell-animal">Prodat 1 za ${Math.floor(animal.cost / 2)} Kƒç</button>` : ''}
                            </div>
                        `;
                        
                        const buyButton = animalElement.querySelector('.buy-animal');
                        buyButton.addEventListener('click', (e) => {
                            e.stopPropagation();
                            buyAnimal(animal.id);
                        });
                        
                        if (canSell) {
                            const sellButton = animalElement.querySelector('.sell-animal');
                            sellButton.addEventListener('click', (e) => {
                                e.stopPropagation();
                                sellAnimal(animal.id);
                            });
                        }
                    } else {
                        animalElement.innerHTML = `
                            <div class="animal-icon">${animal.icon}</div>
                            <div class="animal-name">${animal.name}</div>
                            <div class="animal-locked">Level ${animal.unlockLevel}</div>
                        `;
                    }
                    
                    animalsElement.appendChild(animalElement);
                });
            }

            // N√°kup zv√≠≈ôete
            function buyAnimal(animalId) {
                const animal = animals.find(a => a.id === animalId);
                if (gameState.money >= animal.cost) {
                    gameState.money -= animal.cost;
                    
                    if (!gameState.animalCounts[animalId]) {
                        gameState.animalCounts[animalId] = 0;
                    }
                    gameState.animalCounts[animalId]++;
                    
                    addXP(animal.xp);
                    updateUI();
                    renderAnimals();
                    showSaveIndicator(`Koupeno: ${animal.name}`);
                } else {
                    showSaveIndicator('Nem√°≈° dostatek penƒõz!', true);
                }
            }

            // Prodej zv√≠≈ôete
            function sellAnimal(animalId) {
                const animal = animals.find(a => a.id === animalId);
                const sellPrice = Math.floor(animal.cost / 2);
                
                if (gameState.animalCounts[animalId] && gameState.animalCounts[animalId] > 0) {
                    gameState.animalCounts[animalId]--;
                    gameState.money += sellPrice;
                    
                    if (gameState.animalCounts[animalId] === 0) {
                        delete gameState.animalCounts[animalId];
                    }
                    
                    updateUI();
                    renderAnimals();
                    showSaveIndicator(`Prod√°no: 1x ${animal.name} za ${sellPrice} Kƒç`);
                    saveGame();
                }
            }

            // Otev≈ôen√≠ modalu
            function openModal(type) {
                if (type === 'market') {
                    renderMarket();
                    marketModal.style.display = 'flex';
                } else if (type === 'upgrades') {
                    renderUpgrades();
                    upgradesModal.style.display = 'flex';
                } else if (type === 'economy') {
                    renderEconomy();
                    economyModal.style.display = 'flex';
                } else if (type === 'save') {
                    renderSaveSlots();
                    saveModal.style.display = 'flex';
                }
            }

            // Vykreslen√≠ tr≈æi≈°tƒõ
            function renderMarket() {
                const marketItemsElement = document.getElementById('market-items');
                marketItemsElement.innerHTML = '';
                
                let hasItems = false;
                
                const filterContainer = document.createElement('div');
                filterContainer.className = 'market-filters';
                
                const showAllButton = document.createElement('button');
                showAllButton.textContent = 'V≈°echny plodiny';
                showAllButton.className = 'market-filter active';
                showAllButton.addEventListener('click', () => {
                    document.querySelectorAll('.market-filter').forEach(btn => btn.classList.remove('active'));
                    showAllButton.classList.add('active');
                    renderMarketItems(false);
                });
                
                const showFavoritesButton = document.createElement('button');
                showFavoritesButton.textContent = 'Obl√≠ben√©';
                showFavoritesButton.className = 'market-filter';
                showFavoritesButton.addEventListener('click', () => {
                    document.querySelectorAll('.market-filter').forEach(btn => btn.classList.remove('active'));
                    showFavoritesButton.classList.add('active');
                    renderMarketItems(true);
                });
                
                filterContainer.appendChild(showAllButton);
                filterContainer.appendChild(showFavoritesButton);
                marketItemsElement.appendChild(filterContainer);
                
                function renderMarketItems(showOnlyFavorites) {
                    const itemsContainer = document.getElementById('market-items-container');
                    if (itemsContainer) {
                        itemsContainer.remove();
                    }
                    
                    const newItemsContainer = document.createElement('div');
                    newItemsContainer.id = 'market-items-container';
                    marketItemsElement.appendChild(newItemsContainer);
                    
                    let hasFilteredItems = false;
                    
                    Object.keys(gameState.inventory).forEach(cropId => {
                        const quantity = gameState.inventory[cropId];
                        if (quantity > 0) {
                            const crop = crops.find(c => c.id === parseInt(cropId));
                            const isFavorited = gameState.favoriteCrops.includes(parseInt(cropId));
                            
                            if (showOnlyFavorites && !isFavorited) {
                                return;
                            }
                            
                            hasFilteredItems = true;
                            hasItems = true;
                            
                            const sellPrice = Math.round(crop.sellPrice * gameState.sellMultiplier);
                            const totalPrice = sellPrice * quantity;
                            
                            const itemElement = document.createElement('div');
                            itemElement.className = `market-item ${isFavorited ? 'favorited' : ''}`;
                            
                            const canSell = !isFavorited;
                            
                            itemElement.innerHTML = `
                                <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                                    <div style="display: flex; align-items: center;">
                                        <div class="upgrade-icon">${crop.icon}</div>
                                        <div style="margin-left: 10px;">
                                            <div class="upgrade-name">${crop.name} ${isFavorited ? '‚≠ê' : ''}</div>
                                            <div class="upgrade-description">Mno≈æstv√≠: ${quantity}</div>
                                            ${isFavorited ? '<div class="upgrade-description" style="color: #ffd700; font-weight: bold;">OBL√çBEN√â - nelze prodat</div>' : ''}
                                        </div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div class="upgrade-cost">Cena: ${totalPrice} Kƒç</div>
                                        ${canSell ? `<button class="sell-button" style="margin-top: 5px;">Prodat</button>` : '<button class="sell-button" style="margin-top: 5px; opacity: 0.5; cursor: not-allowed;" disabled>Nelze prodat</button>'}
                                    </div>
                                </div>
                            `;
                            
                            if (canSell) {
                                const sellButton = itemElement.querySelector('.sell-button');
                                sellButton.addEventListener('click', () => sellCrop(parseInt(cropId), quantity));
                            }
                            
                            newItemsContainer.appendChild(itemElement);
                        }
                    });
                    
                    if (!hasFilteredItems) {
                        newItemsContainer.innerHTML = showOnlyFavorites ? 
                            '<p>Nem√°≈° ≈æ√°dn√© obl√≠ben√© plodiny k prodeji.</p>' : 
                            '<p>Nem√°≈° ≈æ√°dn√© plodiny k prodeji.</p>';
                    }
                }
                
                renderMarketItems(false);
                
                if (!hasItems) {
                    marketItemsElement.innerHTML = '<p>Nem√°≈° ≈æ√°dn√© plodiny k prodeji.</p>';
                }
            }

            // Prodej plodiny
            function sellCrop(cropId, quantity) {
                const crop = crops.find(c => c.id === cropId);
                const sellPrice = Math.round(crop.sellPrice * gameState.sellMultiplier);
                const totalPrice = sellPrice * quantity;
                
                gameState.money += totalPrice;
                delete gameState.inventory[cropId];
                
                updateUI();
                renderMarket();
                showSaveIndicator(`Prod√°no: ${quantity}x ${crop.name} za ${totalPrice} Kƒç`);
            }

            // Vykreslen√≠ vylep≈°en√≠
            function renderUpgrades() {
                const upgradeItemsElement = document.getElementById('upgrade-items');
                upgradeItemsElement.innerHTML = '';
                
                upgrades.forEach(upgrade => {
                    const purchased = gameState.upgrades.includes(upgrade.id);
                    const canAfford = gameState.money >= upgrade.cost && !purchased;
                    
                    const upgradeElement = document.createElement('div');
                    upgradeElement.className = `upgrade-item ${purchased ? 'purchased' : ''}`;
                    upgradeElement.innerHTML = `
                        <div class="upgrade-icon">${upgrade.icon}</div>
                        <div class="upgrade-name">${upgrade.name}</div>
                        <div class="upgrade-description">${upgrade.description}</div>
                        ${upgrade.effect === 'growthBoost' ? `<div class="upgrade-stats">+${(upgrade.value * 100)}% rychlost r≈Østu</div>` : ''}
                        ${upgrade.effect === 'sellBoost' ? `<div class="upgrade-stats">+${(upgrade.value * 100)}% cena prodeje</div>` : ''}
                        <div class="upgrade-cost">${purchased ? 'ZAKOUPENO' : `${upgrade.cost} Kƒç`}</div>
                        ${!purchased ? `<button class="buy-upgrade" style="margin-top: 5px;" ${canAfford ? '' : 'disabled'}>Koupit</button>` : ''}
                    `;
                    
                    if (!purchased) {
                        const buyButton = upgradeElement.querySelector('.buy-upgrade');
                        buyButton.addEventListener('click', () => buyUpgrade(upgrade.id));
                    }
                    
                    upgradeItemsElement.appendChild(upgradeElement);
                });
            }

            // N√°kup vylep≈°en√≠
            function buyUpgrade(upgradeId) {
                const upgrade = upgrades.find(u => u.id === upgradeId);
                if (gameState.money >= upgrade.cost && !gameState.upgrades.includes(upgradeId)) {
                    gameState.money -= upgrade.cost;
                    gameState.upgrades.push(upgradeId);
                    
                    applyUpgradeEffect(upgrade);
                    
                    updateUI();
                    renderUpgrades();
                    showSaveIndicator(`Zakoupeno: ${upgrade.name}`);
                }
            }

            // Aplikace efektu vylep≈°en√≠
            function applyUpgradeEffect(upgrade) {
                if (upgrade.effect === 'growthBoost') {
                    gameState.growthMultiplier += upgrade.value;
                    showSaveIndicator(`Rychlost r≈Østu zv√Ω≈°ena o ${upgrade.value * 100}%!`);
                } else if (upgrade.effect === 'sellBoost') {
                    gameState.sellMultiplier += upgrade.value;
                    showSaveIndicator(`Cena prodeje zv√Ω≈°ena o ${upgrade.value * 100}%!`);
                }
                
                addXP(50);
            }

            // Vykreslen√≠ ekonomick√Ωch aktivit
            function renderEconomy() {
                const economyItemsElement = document.getElementById('economy-items');
                economyItemsElement.innerHTML = '';
                
                economyItems.forEach(economyItem => {
                    const purchased = gameState.economy.includes(economyItem.id);
                    const canAfford = gameState.money >= economyItem.cost && !purchased;
                    
                    const itemElement = document.createElement('div');
                    itemElement.className = `economy-item ${purchased ? 'purchased' : ''}`;
                    itemElement.innerHTML = `
                        <div class="economy-icon">${economyItem.icon}</div>
                        <div class="economy-name">${economyItem.name}</div>
                        <div class="economy-description">${economyItem.description}</div>
                        ${economyItem.income > 0 ? `<div class="economy-income">+${economyItem.income} Kƒç/den</div>` : ''}
                        <div class="economy-cost">${purchased ? 'ZAKOUPENO' : `${economyItem.cost} Kƒç`}</div>
                        ${!purchased ? `<button class="buy-economy" style="margin-top: 5px;" ${canAfford ? '' : 'disabled'}>${economyItem.income > 0 ? 'Investovat' : 'Koupit'}</button>` : ''}
                    `;
                    
                    if (!purchased) {
                        const buyButton = itemElement.querySelector('.buy-economy');
                        buyButton.addEventListener('click', () => buyEconomy(economyItem.id));
                    }
                    
                    economyItemsElement.appendChild(itemElement);
                });
            }

            // N√°kup ekonomick√© aktivity
            function buyEconomy(economyId) {
                const economyItem = economyItems.find(e => e.id === economyId);
                if (gameState.money >= economyItem.cost && !gameState.economy.includes(economyId)) {
                    gameState.money -= economyItem.cost;
                    gameState.economy.push(economyId);
                    
                    if (economyId === 7) {
                        gameState.maxSaveSlots = MAX_SAVE_SLOTS;
                        showSaveIndicator('Odemyk√°no 5 save slot≈Ø!');
                    }
                    
                    if (economyId === 8) {
                        resetConfirmModal.style.display = 'flex';
                        return;
                    }
                    
                    addXP(economyItem.xp);
                    updateUI();
                    renderEconomy();
                    showSaveIndicator(`Zakoupeno: ${economyItem.name}`);
                }
            }

            // Vykreslen√≠ save slot≈Ø
            function renderSaveSlots() {
                const saveSlotsElement = document.getElementById('save-slots');
                saveSlotsElement.innerHTML = '';
                
                for (let i = 1; i <= gameState.maxSaveSlots; i++) {
                    const saveKey = SAVE_KEY_PREFIX + i;
                    const savedGame = localStorage.getItem(saveKey);
                    let slotInfo = 'Pr√°zdn√Ω slot';
                    
                    if (savedGame) {
                        try {
                            const gameData = JSON.parse(savedGame);
                            slotInfo = `Level ${gameData.level}, Den ${gameData.day}, ${gameData.money} Kƒç`;
                        } catch (e) {
                            slotInfo = 'Po≈°kozen√Ω save';
                        }
                    }
                    
                    const slotElement = document.createElement('div');
                    slotElement.className = `save-slot ${savedGame ? '' : 'empty'} ${gameState.currentSaveSlot === i ? 'selected' : ''}`;
                    slotElement.innerHTML = `
                        <div class="upgrade-name">Slot ${i}</div>
                        <div class="save-slot-info">${slotInfo}</div>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button class="save-to-slot" data-slot="${i}">Ulo≈æit</button>
                            <button class="load-from-slot" data-slot="${i}" ${savedGame ? '' : 'disabled'}>Naƒç√≠st</button>
                            <button class="delete-slot" data-slot="${i}" ${savedGame ? '' : 'disabled'}>Smazat</button>
                        </div>
                    `;
                    
                    const saveButton = slotElement.querySelector('.save-to-slot');
                    const loadButton = slotElement.querySelector('.load-from-slot');
                    const deleteButton = slotElement.querySelector('.delete-slot');
                    
                    saveButton.addEventListener('click', () => saveToSlot(i));
                    loadButton.addEventListener('click', () => loadFromSlot(i));
                    deleteButton.addEventListener('click', () => deleteSlot(i));
                    
                    saveSlotsElement.appendChild(slotElement);
                }
                
                if (gameState.maxSaveSlots < MAX_SAVE_SLOTS) {
                    const infoElement = document.createElement('div');
                    infoElement.className = 'farm-expansion';
                    infoElement.innerHTML = `<i class="fas fa-info-circle"></i> M≈Ø≈æe≈° odemknout a≈æ ${MAX_SAVE_SLOTS} save slot≈Ø koup√≠ "Investiƒçn√≠ho portfolia" v ekonomick√Ωch investic√≠ch!`;
                    saveSlotsElement.appendChild(infoElement);
                }
            }

            // Ulo≈æen√≠ do slotu
            function saveToSlot(slot) {
                gameState.currentSaveSlot = slot;
                localStorage.setItem(CURRENT_SAVE_SLOT_KEY, slot.toString());
                saveGame();
                renderSaveSlots();
                showSaveIndicator(`Ulo≈æeno do slotu ${slot}!`);
            }

            // Naƒçten√≠ ze slotu
            function loadFromSlot(slot) {
                const saveKey = SAVE_KEY_PREFIX + slot;
                const savedGame = localStorage.getItem(saveKey);
                
                if (savedGame) {
                    try {
                        const parsedGame = JSON.parse(savedGame);
                        gameState = parsedGame;
                        gameState.currentSaveSlot = slot;
                        localStorage.setItem(CURRENT_SAVE_SLOT_KEY, slot.toString());
                        
                        if (gameState.growthMultiplier === undefined) gameState.growthMultiplier = 1.0;
                        if (gameState.lastAutoDay === undefined) gameState.lastAutoDay = Date.now();
                        if (gameState.sellMultiplier === undefined) gameState.sellMultiplier = 1.0;
                        if (gameState.economy === undefined) gameState.economy = [];
                        if (gameState.maxSaveSlots === undefined) gameState.maxSaveSlots = 3;
                        if (gameState.secretSeedsPlanted === undefined) gameState.secretSeedsPlanted = 0;
                        if (gameState.favoriteCrops === undefined) gameState.favoriteCrops = [];
                        if (gameState.animalCounts === undefined) gameState.animalCounts = {};
                        if (gameState.secretSeedsBought === undefined) gameState.secretSeedsBought = 0;
                        
                        updateUI();
                        renderFarm();
                        renderCrops();
                        renderAnimals();
                        updateSeason();
                        checkUnlocks();
                        saveModal.style.display = 'none';
                        showSaveIndicator(`Naƒçteno ze slotu ${slot}!`);
                    } catch (e) {
                        console.error('Chyba p≈ôi naƒç√≠t√°n√≠ hry:', e);
                        showSaveIndicator('Chyba p≈ôi naƒç√≠t√°n√≠!', true);
                    }
                }
            }

            // Smaz√°n√≠ slotu
            function deleteSlot(slot) {
                if (confirm(`Opravdu chce≈° smazat ulo≈æen√≠ ve slotu ${slot}?`)) {
                    const saveKey = SAVE_KEY_PREFIX + slot;
                    localStorage.removeItem(saveKey);
                    renderSaveSlots();
                    showSaveIndicator(`Slot ${slot} smaz√°n!`);
                }
            }

            // Aktualizace UI
            function updateUI() {
                moneyElement.textContent = gameState.money;
                levelElement.textContent = gameState.level;
                dayElement.textContent = gameState.day;
                farmSizeElement.textContent = gameState.farmSize;
                
                const xpNeeded = gameState.level * 100;
                const xpPercentage = (gameState.xp / xpNeeded) * 100;
                xpProgressElement.style.width = `${xpPercentage}%`;
                xpTextElement.textContent = `${gameState.xp}/${xpNeeded} XP`;
                
                updateSeason();
            }

            // Automatick√© ukl√°d√°n√≠
            function autoSave() {
                gameState.lastPlayed = Date.now();
                saveGame();
            }

            // Ulo≈æen√≠ hry
            function saveGame() {
                const saveKey = SAVE_KEY_PREFIX + gameState.currentSaveSlot;
                localStorage.setItem(saveKey, JSON.stringify(gameState));
                
                saveAdventState();
            }

            // Zobrazen√≠ indik√°toru ulo≈æen√≠
            function showSaveIndicator(message, isError = false) {
                saveIndicator.textContent = message;
                saveIndicator.style.background = isError ? 'rgba(244, 67, 54, 0.9)' : 'rgba(76, 175, 80, 0.9)';
                saveIndicator.classList.add('show');
                
                setTimeout(() => {
                    saveIndicator.classList.remove('show');
                }, 3000);
            }

            // Spu≈°tƒõn√≠ hry
            initGame();
        });
    </script>
</body>
</html>
